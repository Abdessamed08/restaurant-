<!DOCTYPE html>
<html lang="es">
<head>
	<!-- Reservas -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<link rel="alternate" hreflang="es" href="https://maido.mesa247.pe/reservas/maido?language=es">
	<link rel="alternate" hreflang="en" href="https://maido.mesa247.pe/reservas/maido?language=en">
	<meta charset="utf-8">
	<link rel="canonical" href="maido.html" />
	<!-- Metatags -->
	<meta name="description" content="Reserva en Maido "/>
	<meta name="robots" content="noindex, nofollow">
	<meta name="keywords" content="Maido, restaurante, reserva" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="HandheldFriendly" content="true">
	<meta property="og:site_name" content="MESA 24/7" />
	<meta property="og:type" content="website" />
	<meta property="fb:admins" content="0" />
	<meta property="og:url" content="https://maido.mesa247.pe/reservas/maido" />
	<meta property="og:title" content="Reserva en Maido " />
	<meta property="og:image" content="https://img.mesa247.pe/archivos/w-logo-maido-1567438004.png" />
	<link rel="profile" href="https://gmpg.org/xfn/11"/>
    <!-- CSRF Token -->
    <meta name="csrf-token" content="tTjvXzWirgvy0oG1CLIxBedCl2TMFpIBCzad473u">
	<!-- Favicon -->
		<link href="https://img.mesa247.pe/archivos/w-logo-maido-1567438004.png" rel="shortcut icon" type="image/x-icon" />
		<title>Reserva en Maido </title>
	<link href="https://maido.mesa247.pe/reservas/css/app.css?id=1b54d593da3445221c35" rel="stylesheet" type="text/css" >
	<meta name="locale" content="es">
	<meta name="theme-color" content="#B73844">
		<link href="https://maido.mesa247.pe/reservas/css/fontawesome.css" rel="stylesheet" type="text/css" >
		
<style>
.main{
	min-height: 600px !important;
	margin-bottom: 0px;
}
body.market-place .main-image .main-mask{
	background: transparent !important;
}
#reservation .reservation header.style-1{
	background: #000000;
}
.main-image {
    background-image: url("https://img.mesa247.pe/archivos/w-bg-maido-cocina-nikkei-1678410550.jpeg") !important;
}
#reservation .overlay-bg{
	background: rgba(0, 0, 0, 0.1);
}
#reservation .reservation nav ul{
	background: rgb(255, 255, 255);
}
#reservation .reservation nav ul li.arrow-nav{
	background: rgb(255, 255, 255);
}
#reservation .reservation nav ul li a.current{
	border-bottom: 5px solid rgb(190, 190, 190);
}
#reservation .reservation section .section-date .vc-container .vc-title{
	color: rgb(190, 190, 190);
}
#reservation .reservation section .section-date .vc-arrow{
	color: rgb(190, 190, 190);
}
#reservation .reservation section .section-date .vc-container .vc-weekday{
	color: rgb(190, 190, 190);
}
#reservation .reservation nav ul li.current .indicator{
    background:  #000000;
    border: 2px solid  #000000;
}
#reservation .reservation nav ul li.done .indicator{
    background:  #000000;
    border: 2px solid  #000000;
}
#reservation .reservation nav ul li a .indicator-line.line-on.active{
	background:  #000000;
}
#reservation .person-link:hover{
	background: #000000 !important;
}
#reservation .hour-link:hover{
	background: #000000 !important;
}
#reservation .zone-link:hover{
	background: #000000 !important;
}
#reservation .consumption-type-link:hover{
	background: #000000 !important;
}
#reservation .reservation section .section-people .people::-webkit-scrollbar-thumb{
	background-color: #B73844 !important;
}
#reservation .reservation section .section-hour .hours::-webkit-scrollbar-thumb{
	background-color: #B73844 !important;
}
#reservation .reservation section .section-zones .zones::-webkit-scrollbar-thumb{
	background-color: #B73844 !important;
}
#reservation .reservation section .section-consumption-types .consumption-types::-webkit-scrollbar-thumb{
	background-color: #B73844 !important;
}
#reservation .reservation section .section-information .information:not(.alter) input{
	color:  #ffffff !important;
	/*border: 2px solid  rgb(190, 190, 190);*/
	border-color: #FFFFFF;
}
/*#reservation .reservation section .section-information select{
	border: 2px solid  rgb(190, 190, 190);
}*/
#reservation .reservation section .section-information .information:not(.alter) textarea {
	color:  #ffffff !important;
	/*border: 2px solid  rgb(190, 190, 190);*/
	border-color: #FFFFFF;
}
#reservation .reservation section .section-information .btn-booking{
	background:  #000000 !important;
	border: 2px solid #FFFFFF !important;
	border-color: #FFFFFF !important;
}
#reservation .reservation .btn-popup{
	background:  #000000 !important;
	border: 2px solid #FFFFFF !important;
	border-color: #FFFFFF !important;
}
#reservation .reservation section .section-information input::placeholder {
	color: #ffffff !important;
}
#reservation .reservation section .section-information input:-ms-input-placeholder {
	color: #ffffff !important;
}
#reservation .reservation section .section-information input::-ms-input-placeholder {
	color: #ffffff !important;
}
#reservation .reservation section .section-information textarea::placeholder {
	color: #ffffff !important;
}
#reservation .reservation section .section-information textarea:-ms-input-placeholder {
	color: #ffffff !important;
}
#reservation .reservation section .section-information textarea::-ms-input-placeholder {
	color: #ffffff !important;
}
#reservation .custom-control-input:checked~.custom-control-label:before{
	border: 2px solid #ffffff !important;
	background-color: #000000 !important;
}
#reservation .alter .custom-control-input:checked~.custom-control-label:before{
	border: 2px solid #000000 !important;
}
#reservation.custom-checkbox .custom-control-input:checked ~ .custom-control-label::before{
	color: #B73844 !important;
}
#reservation .reservation header .language .dropdown>li{
	background-color: #B73844 !important;
}
#reservation .reservation section .section-people .people .person a{
	background: rgba(0,0,0,0.3) !important;
	color: #000000 !important;
	border: 1px solid #000000 !important;
}
#reservation .reservation section .section-hour .hours a{
	background: rgba(0,0,0,0.3) !important;
	color: #000000 !important;
	border: 1px solid #000000 !important;
}
#reservation .reservation section .section-zones .zones .zone .zone-link{
	background: rgba(0,0,0,0.3) !important;
	color: #000000 !important;
	border: 2px solid #000000 !important;
}
#reservation .reservation section .section-consumption-types .consumption-types .consumption-type a{
	color: #000000 !important;
	border: 2px solid #000000 !important;
}
#reservation .vc-container .vc-day-content:not(.is-disabled){
	background: rgba(0,0,0,0.3) !important;
	color: #000000 !important;
}
#reservation .reservation section .section-date .vc-container .vc-bars{
	border: 1px solid #000000 !important;
}
#reservation .reservation section .section-people .people .person a{
	background: transparent !important;
    color: #fff !important;
    border: 1px solid #fff !important;
}
#reservation .reservation section .section-hour .hours a{
	background: transparent !important;
	color: #fff !important;
	border: 1px solid #fff !important;
}
#reservation .reservation section .section-zones .zones .zone .zone-link{
	background: transparent !important;
	color: #fff !important;
	border: 2px solid #fff !important;
}
#reservation .reservation section .section-consumption-types .consumption-types .consumption-type a{
	background: transparent; !important;
	color: #fff !important;
	border: 2px solid #fff !important;
}
#reservation .vc-container .vc-day-content:not(.is-disabled){
	background: transparent !important;
	color: #fff !important;
}
#reservation .reservation section .section-date .vc-container .vc-bars{
	border: 1px solid #fff !important;
}
#reservation .reservation section .section-information .information:not(.alter) {
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .information:not(.alter) .guarantee-info {
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .information:not(.alter) .payment-info {
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .special-dishes-info:not(.alter) {
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .the-menu-validation-wrapper:not(.alter) .invoicing-info {
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-date .waitlist-options{
	background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .summary:not(.alter) {
	background-color: rgba(0,0,0,0.3) !important;
}

#reservation .reservation section .section-information .guarantee-info {
  background-color: rgba(0,0,0,0.3) !important;
}
#reservation .reservation section .section-information .payment-info {
  background-color: rgba(0,0,0,0.3) !important;
} 

#reservation .vc-container .vc-day-content:not(.is-disabled):hover{
	background: #000000 !important;
}
#reservation .vc-container .vc-day-content:not(.is-disabled):hover{
	background: #000000 !important;
}
#reservation .reservation section .button-fixed .buttons .btn-go-to-last-step{
	background-color: #000000 !important;
	border-color: #FFFFFF !important;
	border: 2px solid #FFFFFF;
}
#reservation .reservation section .section-information .buttons .btn-go-to-last-step{
	background-color: #000000 !important;
	border-color: #FFFFFF !important;
	border: 2px solid #FFFFFF;
}
#reservation .reservation section .section-information ::-webkit-input-placeholder {
    color: #A0A0A5;
}
#reservation .reservation section .section-information ::-moz-placeholder {
    color: #A0A0A5;
}
#reservation .reservation section .section-information :-ms-input-placeholder {
    color: #A0A0A5;
}
#reservation .reservation section .section-information ::-ms-input-placeholder {
    color: #A0A0A5;
}
#reservation .reservation section .section-information ::placeholder {
  color: #A0A0A5;
}
#reservation .reservation section .section-people .people .person a:hover{
	background-color: #000000 !important;
}
#reservation .reservation section .section-hour .hours a:hover{
	background-color: #000000  !important;
}
#reservation .reservation section .section-zones .zones .zone .zone-link:hover {
	background-color: #000000  !important;
}
.day-section {
    margin-bottom: 10px;
}

.day-title {
    color: #fff !important;
    font-size: 18px !important;
    font-weight: 100 !important;
    margin-bottom: 15px !important;
    padding-bottom: 8px !important;
	padding-top: 10px !important;
}
#reservation .reservation section .section-zones .zones .cover-zones .zone-card:hover .action-wrapper .btn-zone, 
#reservation .reservation section .section-zones .zones .cover-zones .zone-card:hover .action-wrapper.only-button .btn-zone {
	background-color: #000000;
	color: #FFFFFF;
}

#reservation .reservation section .section-consumption-types .consumption-types .consumption-type a:hover{
	background-color: #000000  !important;
}
#reservation .reservation section .section-information .special-dishes-info .category-title .title-name .title {
	color: #B73844;
}
.no-hours {
    width: 100%;
    display: flex;
    justify-content: center;
}
.no-hours span {
    color: #fff;
    font-size: 20px;
    font-weight: 600;
}
</style>





<!-- Start Head scripts -->











    <!-- From DB aggrupation -->
	<script type='text/javascript'>
/* Global site tag (gtag.js) - Google Analytics */
var gajs = document.createElement('script');
gajs.type = 'text/javascript';
gajs.async = true;
gajs.src = 'https://www.googletagmanager.com/gtag/js?id=UA-176410192-1';
document.head.insertAdjacentElement('afterbegin', gajs)

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-176410192-1');
</script>
    <!-- End From DB aggrupation -->


	<!-- End Head scripts -->



</head>
<body>
<!-- Start Footer Scripts (on body) -->


	
<!-- Start Footer scripts -->
<!-- End Footer scripts -->
<!-- End Footer Scripts (on body) -->

<!-- Start Body scripts -->








<!-- End Body scripts -->



	<div id="app">
	</div>
	<div class="main-image">
		<div class="main-mask"></div>
	</div>

	
	<div class="main">
	<div id="reservation" v-cloak>
		<div class="overlay-bg"></div>
		<div :class="['loading-mask', {'layout-fixed': step == 10}]" v-show="loading">
			<div class="loading-spinner">
				
        <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg" />
				<p class="loading-text" v-html="loadingMessage"></p>
			</div>
		</div>
		<div class="reservation">
			<div id="special-popup" v-if="showSpecialPopup">
				<div class="dialog"><p v-html="special_popup_message"></p>
					<a class="btn-close" @click="closeSpecialPopup"><i class="icon-button-close"></i></a>
				</div>
			</div>
			<header :class="layoutStyle == 1 ? 'style-1':''" id="page-header">
				<div class="logo">
					<a href="maido.html"><img src="https://img.mesa247.pe/archivos/w-logo-maido-1567438004.png"></a>
				</div>
				<div class="info">
					<address>Ca. San Martín No. 399, Miraflores | 5113135100 </address>
				</div>
				<div class="language">
					<a @click="displayLangList = !displayLangList">
						<i class="icon-world"></i><span class="current-lang">es</span>
					</a>
					<ul class="dropdown" :class="{ visible: displayLangList }" >
						<li value="es" @click="changeLanguage('es')" :class="{active : language === 'es'}" v-if="language !== 'es'">ES</li>
						<li value="en" @click="changeLanguage('en')" :class="{active : language === 'en'}" v-if="language !== 'en'">EN</li>
											</ul>
				</div>
			</header>
			<nav id="section-navbar" v-show="step <= 9 || (showBeforeTheMenu && !completeTheMenuValidation)">
				<ul id="section-navbar-ul">
					<li class="arrow-nav">
						<a @click="goToPreviousStep" v-if="step > firstStep">
							<i class="icon-arrow-left-alt"></i>
						</a>
					</li>
					<li v-show="widget.start_order == '3'" :class="getTabState(1)">
						<a id="nav-opt-1" @click="selectStep(1)" v-html="getTabLabel(1)" v-if="step > 1"></a>
						<a id="nav-opt-1" v-html="getTabLabel(1)" v-else-if="step == 1"></a>
						<a id="nav-opt-1" v-html="getTabLabel(1)" v-else></a>
					</li>
					<li v-show="widget.start_order == '3' && !bridgeZonesEnabled" :class="getTabState(2)">
						<a id="nav-opt-2" @click="selectStep(2)" v-html="getTabLabel(2)" v-if="step > 2"></a>
						<a id="nav-opt-2" v-html="getTabLabel(2)" v-else-if="step == 2"></a>
						<a id="nav-opt-2" v-html="getTabLabel(2)" v-else></a>
					</li>
					<li v-show="widget.start_order !== '2'" :class="getTabState(3)">
						<a id="nav-opt-3" @click="selectStep(3)" v-html="getTabLabel(3)" v-if="step > 3"></a>
						<a id="nav-opt-3" v-html="getTabLabel(3)" v-else-if="step == 3"></a>
						<a id="nav-opt-3" v-html="getTabLabel(3)" v-else></a>
					</li>
					<li :class="getTabState(4)">
						<a id="nav-opt-4" @click="selectStep(4)" v-html="getTabLabel(4)" v-if="step > 4"></a>
						<a id="nav-opt-4" v-html="getTabLabel(4)" v-else-if="step == 4"></a>
						<a id="nav-opt-4" v-html="getTabLabel(4)" v-else></a>
					</li>
					<li :class="getTabState(5)">
						<a id="nav-opt-5" @click="selectStep(5)" v-html="getTabLabel(5)" v-if="step > 5"></a>
						<a id="nav-opt-5" v-html="getTabLabel(5)" v-else-if="step == 5"></a>
						<a id="nav-opt-5" v-html="getTabLabel(5)" v-else></a>
					</li>
					<li v-show="widget.start_order == '2'" :class="getTabState(6)">
						<a id="nav-opt-6" @click="selectStep(6)" v-html="getTabLabel(6)" v-if="step > 6"></a>
						<a id="nav-opt-6" v-html="getTabLabel(6)" v-else-if="step == 6"></a>
						<a id="nav-opt-6" v-html="getTabLabel(6)" v-else></a>
					</li>
					<li v-show="useZones == 1 && useConsumptionTypes == 1 && widget.start_order != '3'" :class="getTabState(7)">
						<a id="nav-opt-7" @click="selectStep(7)" v-html="getTabLabel(7)" v-if="step > 7"></a>
						<a id="nav-opt-7" v-html="getTabLabel(7)" v-else-if="step == 7"></a>
						<a id="nav-opt-7" v-html="getTabLabel(7)" v-else></a>
					</li>
					<li :class="getTabState(8)">
						<a id="nav-opt-9" @click="selectStep(9)" v-html="getTabLabel(9)" v-if="step > 8"></a>
						<a id="nav-opt-9" v-html="getTabLabel(9)" v-else-if="step == 8"></a>
						<a id="nav-opt-9"v-html="getTabLabel(9)" v-else></a>
					</li>
				</ul>
			</nav>

			
			<section>
				<div class="container">
					<div v-if="widget.start_order == '3'">
	                    <div v-if="optionsOrder == 0">
							<div class="section-zones" v-show="zones.length > 0 && step == 1">
								<h4>
									Seleccione la ubicación
								</h4>

								<div v-if="checkCoverZones()" id="zone" class="zones">
									<div class="cover-zones">
										<a v-for="(zone,idx) in zones" v-if="zone.name_247 !='' && zone.name_247 != null" :class="['zone-card', {'marked': zone.available != 1}]" href="javascript:void(0);" @click="zone.available == 1 ? selectZoneInfo(zone.id) : false">
											<div v-if="!!zone.photo" class="zone-bg" :style="`background-image: url('${zone.photo}')`">
												<div class="bg-overlay"></div>
												<div class="action-wrapper">
													<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
												</div>
											</div>
											<div v-else class="action-wrapper only-button">
												<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
											</div>
										</a>
									</div>
								</div>
								<div v-else id="zone" :class="['zones', {'more-details': checkDetailZones()}]">
									<div class="zone" v-for="(zone, idx) in zones">
										<button v-if="!!zone.name_247" @click="zone.available == 1 ? selectZoneInfo(zone.id) : false" type="button" :class="['zone-link', {'marked': zone.available != 1}]">
											<span class="title" v-html="zone.name_247"></span>	
											<span v-if="!!zone.detail" class="detail" v-html="zone.detail"></span>	
										</button>
									</div>
								</div>
											                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
									<span v-html="getWidgetFooterDescription"></span>
								</div>
							</div>
							<div class="section-consumption-types" v-show="consumption_types.length > 0 && step == 2">
								<div class="section-step-header">
									<h3>
									Seleccione el tipo de consumo
									</h3>
																	</div>
	                            <div id="consumption_type" class="consumption-types" >
	                                <div v-if="!!typc.name && (local_id != 873 || (local_id == 873 && typc.available == 1))" class="consumption-type" v-for="(typc,idx) in consumption_types">
	                                    <button type="button"
										:class="['btn btn-consumption-type', {'marked': typc.available != 1}]"
										@click="typc.available == 1 && typc.id != 1703 ? selectConsumptionTypeInfo(typc.id, $event) : false">
										 	<div v-if="!!typc.photo_desktop || !!typc.photo_mobile" class="consumption-type-image">
												<img v-if="!!typc.photo_desktop" class="bg-image desktop-version" :src="typc.photo_desktop" :alt="`Imagen de ${typc.name}`">	
												<img v-if="!!typc.photo_mobile" class="bg-image mobile-version" :src="typc.photo_mobile" :alt="`Imagen de ${typc.name}`">	
											</div>
										 	<div class="consumption-type-description">
												<span class="title" v-html="typc.name"></span>

												<template v-if="typc.format == 1">
													<span v-if="!!typc.detail" class="detail" v-html="typc.detail"></span>
												</template>

												<template v-else>
													<span v-if="typc.showDetail && !!typc.detail" v-html="typc.detail" class="detail"></span>
													<span v-else-if="!!typc.resumen" v-html="typc.resumen" class="detail"></span>
													<a v-if="!!typc.detail && !typc.showDetail" 
														target="_blank"
														class="format-link" 
														@click.prevent="typc.showDetail = !typc.showDetail"
													>
														Para mayor información haz click aquí
													</a>
												</template>
											</div>
	                                    </button>
	                                </div>
	                            </div>
			                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
									<span v-html="getWidgetFooterDescription"></span>
								</div>
							</div>
	                    </div>
	                    <div v-else>
							<div class="section-consumption-types" v-show="consumption_types.length > 0 && step == 1">
								<div class="section-step-header">
									<h3>
									Seleccione el tipo de consumo
									</h3>
																	</div>
	                            <div id="consumption_type" class="consumption-types" >
	                                <div v-if="!!typc.name && (local_id != 873 || (local_id == 873 && typc.available == 1))" class="consumption-type" v-for="(typc,idx) in consumption_types">
	                                    <button type="button"
										:class="['btn btn-consumption-type', {'marked': typc.available != 1}]"
										@click="typc.available == 1 && typc.id != 1703 ? selectConsumptionTypeInfo(typc.id, $event) : false">
										 	<div v-if="!!typc.photo_desktop || !!typc.photo_mobile" class="consumption-type-image">
												<img v-if="!!typc.photo_desktop" class="bg-image desktop-version" :src="typc.photo_desktop" :alt="`Imagen de ${typc.name}`">	
												<img v-if="!!typc.photo_mobile" class="bg-image mobile-version" :src="typc.photo_mobile" :alt="`Imagen de ${typc.name}`">	
											</div>
										 	<div class="consumption-type-description">
												<span class="title" v-html="typc.name"></span>

												<template v-if="typc.format == 1">
													<span v-if="!!typc.detail" class="detail" v-html="typc.detail"></span>
												</template>

												<template v-else>
													<span v-if="typc.showDetail && !!typc.detail" v-html="typc.detail" class="detail"></span>
													<span v-else-if="!!typc.resumen" v-html="typc.resumen" class="detail"></span>
													<a v-if="!!typc.detail && !typc.showDetail" 
														target="_blank"
														class="format-link" 
														@click.prevent="typc.showDetail = !typc.showDetail"
													>
														Para mayor información haz click aquí
													</a>
												</template>
											</div>
	                                    </button>
	                                </div>
	                            </div>
											                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
									<span v-html="getWidgetFooterDescription"></span>
								</div>
							</div>
							<div class="section-zones" v-show="zones.length > 0 && step == 2 && !bridgeZonesEnabled">
								<h4>
									Seleccione la ubicación
								</h4>

								<div v-if="checkCoverZones()" id="zone" class="zones">
									<div class="cover-zones">
										<a v-for="(zone,idx) in zones" v-if="zone.name_247 !='' && zone.name_247 != null" :class="['zone-card', {'marked': zone.available != 1}]" href="javascript:void(0);" @click="zone.available == 1 ? selectZoneInfo(zone.id) : false">
											<div v-if="!!zone.photo" class="zone-bg" :style="`background-image: url('${zone.photo}')`">
												<div class="bg-overlay"></div>
												<div class="action-wrapper">
													<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
												</div>
											</div>
											<div v-else class="action-wrapper only-button">
												<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
											</div>
										</a>
									</div>
								</div>
								<div v-else id="zone" :class="['zones', {'more-details': checkDetailZones()}]">
									<div class="zone" v-for="(zone, idx) in zones">
										<button v-if="!!zone.name_247" @click="zone.available == 1 ? selectZoneInfo(zone.id) : false" type="button" :class="['zone-link', {'marked': zone.available != 1}]">
											<span class="title" v-html="zone.name_247"></span>	
											<span v-if="!!zone.detail" class="detail" v-html="zone.detail"></span>	
										</button>
									</div>
								</div>
			                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
									<span v-html="getWidgetFooterDescription"></span>
								</div>
							</div>
	                    </div>
					</div>
					<div v-if="widget.start_order != '2'">
						<div class="section-people" v-show="step == 3">
			                <div class="loading-people" v-show="loadingPeople">
			                    <div class="loading-mask">
			                        <div class="loading-spinner">
			                            
                                  <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg" />
			                            <p class="loading-text"  v-html="loadingMessage"></p></div>
			                    </div>
			                </div>
		                    <h4 v-show="!loadingPeople">
								Elija la cantidad de personas
							</h4>
							<div class="people" v-if="firstStep != 3" v-show="!loadingPeople">
								<div v-if="people.length === 0" class="mt-3 note-section-wrapper">
									<p>No hay sitios en este momento</p>
								</div>
								<div v-else>
									<div v-if="(reservation.consumption_type == 896 && person <= 6) || reservation.consumption_type != 896" class="person" v-for="(person, idx) in people">
										<a :class=" reservation.pax == person ? 'person-link active' : 'person-link' " href="javascript:void(0);" v-html="person" @click="selectPeopleNumber(person)"></a>
									</div>
								</div>
							</div>
	                        <div class="people" v-else v-show="!loadingPeople">
	                        	<div v-if="people.length === 0" class="mt-3 note-section-wrapper">
	                        		<p>No hay sitios en este momento</p>
	                        	</div>
	                        	<div v-else>
	                        		<div v-if="person <= 6 || !showMorePeople" class="person" v-for="(person, idx) in people">
	                        	 		<a  :class=" reservation.pax == person ? 'person-link active' : 'person-link' " href="javascript:void(0);" v-html="person" @click="selectPeopleNumber(person)"></a>
	                        		</div>
									<div v-if="showMorePeople && people.length > 6 " class="person">
										<a  class="person-link" href="javascript:void(0);" @click="morePeople()"><i class="icon-additional-services"></i></a>
	                        		</div>
																		<div class="mt-4 note-section-wrapper">
										<p>* Bebés y niños deben ser incluidos en la cantidad de personas.</p>
									</div>
										                        	</div>
	                        </div>
								                        <div v-if="!!getWidgetFooterDescription" class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
						</div>
					</div>
					<!-- select a date -->
					<div class="section-date" v-show="step == 4">
						<div class="loading-date" v-show="loadingDate">
		                    <div class="loading-mask">
		                        <div class="loading-spinner">
		                            
                                <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg" />
		                            <p class="loading-text"></p></div>
		                    </div>
		                </div>
						<h4 v-show="!loadingDate">
							Seleccione una fecha
						</h4>
						<div id="date" class="row" v-show="!loadingDate" :class="{'input-error': errors.reservation.date}" >
							<v-date-picker
									:attributes="attrs"
									locale="es"
									color="blue"
									:columns="$screens({ default: 1, lg: 2})"
																		:min-date="new Date('2025-10-01 01:00')"
									:max-date="new Date('2025-12-31')"
																		:available-dates="available_dates"
									is-expanded
									v-model="reservation.date"
									:model-config="modelConfig"
									:from-date="reservationFromDate"
									@dayclick='setDate'/>
						</div>
						<div v-if="oldSafariVersion" v-show="!loadingDate" class="alert alert-dismissible fade show alert-primary" role="alert">
							<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
							<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
							<path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
							</svg>
							<span>Está usando una versión antigua del navegador Safari. Por esto, es posible que nuestro sitio web no le funcione correctamente. Le recomendamos actualizar su navegador o usar otro más actualizado para una mejor experiencia.</span>
						</div>
													<div v-show="!loadingDate" class="mb-3 note-section-wrapper">
								<p>* Domingo cerrado</p>
							</div>
												<div class="waitlist-options" v-show="showWaitlistOptions && !loadingDate">
							<div v-if="schedulesWithWaitlist == 0">
								<div class="option custom-control custom-switch">
								  <input type="checkbox" class="custom-control-input" checked="checked" disabled >
								  <label class="custom-control-label">Días disponibles (sin incluir lista de espera)</label>
								</div>
								<div class="option custom-control custom-switch" @click="loadAvailableDates(1)">
								  <input type="checkbox" class="custom-control-input">
								   <label class="custom-control-label" >Días disponibles (con lista de espera)</label>
								</div>
							</div>
							<div v-else>
								<div class="option custom-control custom-switch" @click="loadAvailableDates(2)">
								  <input type="checkbox" class="custom-control-input">
								  <label class="custom-control-label">Días disponibles (sin incluir lista de espera)</label>
								</div>
								<div class="option custom-control custom-switch">
								  <input type="checkbox" class="custom-control-input" checked="checked" disabled>
								  <label class="custom-control-label">Días disponibles (con lista de espera)</label>
								</div>
							</div>
						</div>
						<div style="display: none;">
							<div v-if="no_quotes_availables" class="alert alert-dismissible fade show alert-primary" role="alert">
		                        <span>No hay cupos disponibles</span>
		                    </div>
	                	</div>
	                	<div v-if="!!getWidgetFooterDescription && !loadingDate && ![1057,11,873].includes(local_id)" class="description-widget">
							<span v-html="getWidgetFooterDescription"></span>
						</div>
					</div>
					<div class="section-hour" v-show="step == 5">
		                <div class="loading-hour" v-show="loadingHour">
		                    <div class="loading-mask">
		                        <div class="loading-spinner">
		                            
                                <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg"/>
		                            <p class="loading-text"  v-html="loadingMessage"></p></div>
		                    </div>
		                </div>
						<h4>
							Elija una hora
						</h4>
                      <div class="no-hours" v-if="hours.length == 0 || !checkAvailableHours()" v-cloak>
                        <span>No hay horarios disponibles</span>
                      </div>
						<div id="hour" class="hours" v-cloak>
							<!-- Solo mostrar separación por días para locales específicos -->
							<div v-if="(local_id == 402 || local_id == 2663) && showNextDay">
								<!-- Horarios de hoy -->
								<div v-if="hours.filter(h => !h.isNextDay && (h.available == 1 || h.waitlist =='1')).length > 0" class="day-section">
									<h4 class="day-title">{{ selectedDate }}</h4>
									<div :class=" dateWithWaitlist ? 'hour width-33':'hour width-12'" 
										v-for="(hour, idx) in hours" 
										v-if="!hour.isNextDay && (hour.available == 1 || hour.waitlist =='1')">
										<a
										class="hour-link"
										href="javascript:void(0);" 
										v-html="hour.hour_text" 
										@click="selectAnHour(hour)" 
										v-if="hour.available == 1"></a>
										<a :class="hour.waitlist =='1' ? 'hour-link marked-alt ' :'hour-link marked '" @click="selectAnHourWithWaitlist(hour)" v-else-if="hour.waitlist =='1'">
										<span v-html="hour.hour_text" ></span> (Waitlist) 
										</a>
									</div>
								</div>

								<!-- Horarios de mañana -->
								<div v-if="hours.filter(h => h.isNextDay && (h.available == 1 || h.waitlist =='1')).length > 0" class="day-section">
									<h4 class="day-title">{{ moment(reservation.date).add(1, 'day').format('dddd, D [de] MMMM').split(' ').map((word, index) => index === 2 ? word : word.charAt(0).toUpperCase() + word.slice(1)).join(' ') }}</h4>
									<div :class=" dateWithWaitlist ? 'hour width-33':'hour width-12'" 
										v-for="(hour, idx) in hours" 
										v-if="hour.isNextDay && (hour.available == 1 || hour.waitlist =='1')">
										<a
										class="hour-link"
										href="javascript:void(0);" 
										v-html="hour.hour + ' AM'" 
										@click="selectAnHour(hour)" 
										v-if="hour.available == 1"></a>
										<a :class="hour.waitlist =='1' ? 'hour-link marked-alt ' :'hour-link marked '" @click="selectAnHourWithWaitlist(hour)" v-else-if="hour.waitlist =='1'">
										<span v-html="hour.hour" ></span> (Waitlist) 
										</a>
									</div>
								</div>
							</div>

							<!-- Para otros locales, mostrar horarios sin separación (comportamiento original) -->
							<div v-else>
								<div :class=" dateWithWaitlist ? 'hour width-33':'hour width-12'" 
									v-for="(hour, idx) in hours" 
									v-if="hour.available == 1 || hour.waitlist =='1'">
									<a
									class="hour-link"
									href="javascript:void(0);" 
									v-html="hour.hour_text" 
									@click="selectAnHour(hour)" 
									v-if="hour.available == 1"></a>
									<a :class="hour.waitlist =='1' ? 'hour-link marked-alt ' :'hour-link marked '" @click="selectAnHourWithWaitlist(hour)" v-else-if="hour.waitlist =='1'">
									<span v-html="hour.hour_text" ></span> (Waitlist) 
									</a>
								</div>
							</div>
						</div>
						<div v-if="!!getWidgetFooterDescription && ![1057,11,873].includes(local_id)" class="description-widget">
							<span v-html="getWidgetFooterDescription"></span>
						</div>
						<a href="javascript:location.reload();" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
					</div>

					<!-- Select People # 2-->
					<div v-if="widget.start_order == '2'">
						<div class="section-people" v-show="step == 6">
			                <div class="loading-people" v-show="loadingPeople">
			                    <div class="loading-mask">
			                        <div class="loading-spinner">
			                            
                                <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg"/>
			                            <p class="loading-text"  v-html="loadingMessage"></p></div>
			                    </div>
			                </div>
		                    <h4>Elija la cantidad de personas</h4>
							<div class="people">
								<div v-if="people.length === 0" class="mt-3 note-section-wrapper">
									<p>No hay sitios en este momento</p>
								</div>
								<div v-else>
									<div class="person" v-for="(person, idx) in people">
										<a class="person-link" href="javascript:void(0);" v-html="person > 1 ? person + ` Personas` : person + ` Persona` " @click="selectPeopleNumberAlt(person)"></a>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Zones and Consumption Types -->
                    <div v-if="optionsOrder == 0  && (step == 7 || step == 8)">
						<div class="section-zones" v-show="reservation.pax != null && reservation.pax != '' && reservation.date != null && reservation.date != '' && hours.length > 0 && reservation.hour != null && useZones == 1 && optionsOrder == 0 && selectManualZone && zones.length > 1 && step == 7">
							<h4>
								Seleccione la ubicación
							</h4>

                            <div v-if="checkCoverZones()" id="zone" class="zones">
								<div class="cover-zones">
									<a v-for="(zone,idx) in zones" v-if="zone.name_247 !='' && zone.name_247 != null" :class="['zone-card', {'marked': zone.available != 1}]" href="javascript:void(0);" @click="zone.available == 1 ? selectZone(zone.id) : false">
										<div v-if="!!zone.photo" class="zone-bg" :style="`background-image: url('${zone.photo}')`">
											<div class="bg-overlay"></div>
											<div class="action-wrapper">
												<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
											</div>
										</div>
										<div v-else class="action-wrapper only-button">
											<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
										</div>
									</a>
								</div>
							</div>
                            <div v-else id="zone" :class="['zones', {'more-details': checkDetailZones()}]">
								<div class="zone" v-for="(zone, idx) in zones">
									<button v-if="!!zone.name_247" @click="zone.available == 1 ? selectZone(zone.id) : false" type="button" :class="['zone-link', {'marked': zone.available != 1}]">
										<span class="title" v-html="zone.name_247"></span>	
										<span v-if="!!zone.detail" class="detail" v-html="zone.detail"></span>	
									</button>
								</div>
							</div>
		                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
						</div>
						<div class="section-consumption-types" v-show="reservation.pax != null && reservation.pax != '' && reservation.date != null && reservation.date != '' && hours.length > 0 && reservation.hour != null && reservation.zone_id != null && consumption_types.length > 0 && selectManualConsumptionType  && useConsumptionTypes == 1 && step == 8">
							<div class="section-step-header">
								<h3>
								Seleccione el tipo de consumo
								</h3>
															</div>
                            <div id="consumption_type" class="consumption-types" >
								<div v-if="!!typc.name && (local_id != 873 || (local_id == 873 && typc.available == 1))" class="consumption-type" v-for="(typc,idx) in consumption_types">
									<button type="button"
									:class="['btn btn-consumption-type', {'marked': typc.available != 1}]"
									@click="typc.available == 1 && typc.id != 1703 ? selectConsumptionType(typc.id, $event) : false">
										<div v-if="!!typc.photo_desktop || !!typc.photo_mobile" class="consumption-type-image">
											<img v-if="!!typc.photo_desktop" class="bg-image desktop-version" :src="typc.photo_desktop" :alt="`Imagen de ${typc.name}`">	
											<img v-if="!!typc.photo_mobile" class="bg-image mobile-version" :src="typc.photo_mobile" :alt="`Imagen de ${typc.name}`">	
										</div>
										<div class="consumption-type-description">
                                            <span class="title" v-html="typc.name"></span>

                                            <template v-if="typc.format == 1">
                                                <span v-if="!!typc.detail" class="detail" v-html="typc.detail"></span>
                                            </template>

                                            <template v-else>
                                                <span v-if="typc.showDetail && !!typc.detail" v-html="typc.detail" class="detail"></span>
                                                <span v-else-if="!!typc.resumen" v-html="typc.resumen" class="detail"></span>
                                                <a v-if="!!typc.detail && !typc.showDetail" 
                                                    target="_blank"
                                                    class="format-link" 
                                                    @click.prevent="typc.showDetail = !typc.showDetail"
                                                >
                                                    Para mayor información haz click aquí
                                                </a>
                                            </template>
                                        </div>
									</button>
								</div>
							</div>
		                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
							<a href="javascript:location.reload();" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
						</div>
                    </div>
                    <div v-else>
						<div class="section-consumption-types" v-show="reservation.pax != null && reservation.pax != '' && reservation.date != null && reservation.date != '' && hours.length > 0 && reservation.hour != null && consumption_types.length > 0 && selectManualConsumptionType && useConsumptionTypes == 1 && step == 7">
							<div class="section-step-header">
								<h3>
								Seleccione el tipo de consumo
								</h3>
															</div>
                            <div id="consumption_type" class="consumption-types" >
								<div v-if="!!typc.name && (local_id != 873 || (local_id == 873 && typc.available == 1))" class="consumption-type" v-for="(typc,idx) in consumption_types">
									<button type="button"
									:class="['btn btn-consumption-type', {'marked': typc.available != 1}]"
									@click="typc.available == 1 && typc.id != 1703 ? selectConsumptionType(typc.id, $event) : false">
										<div v-if="!!typc.photo_desktop || !!typc.photo_mobile" class="consumption-type-image">
											<img v-if="!!typc.photo_desktop" class="bg-image desktop-version" :src="typc.photo_desktop" :alt="`Imagen de ${typc.name}`">	
											<img v-if="!!typc.photo_mobile" class="bg-image mobile-version" :src="typc.photo_mobile" :alt="`Imagen de ${typc.name}`">	
										</div>
										<div class="consumption-type-description">
                                            <span class="title" v-html="typc.name"></span>

                                            <template v-if="typc.format == 1">
                                                <span v-if="!!typc.detail" class="detail" v-html="typc.detail"></span>
                                            </template>

                                            <template v-else>
                                                <span v-if="typc.showDetail && !!typc.detail" v-html="typc.detail" class="detail"></span>
                                                <span v-else-if="!!typc.resumen" v-html="typc.resumen" class="detail"></span>
                                                <a v-if="!!typc.detail && !typc.showDetail" 
                                                    target="_blank"
                                                    class="format-link" 
                                                    @click.prevent="typc.showDetail = !typc.showDetail"
                                                >
                                                    Para mayor información haz click aquí
                                                </a>
                                            </template>
                                        </div>
									</button>
								</div>
							</div>
		                	<div v-if="!!getWidgetFooterDescription && ![11,873].includes(local_id)" class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
							<a href="javascript:location.reload();" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
						</div>
						<div class="section-zones" v-show="reservation.pax != null && reservation.pax != '' && reservation.date != null && reservation.date != '' && hours.length > 0 && reservation.hour != null && useZones == 1 && selectManualZone && reservation.consumption_type != null && zones.length > 1 && step == 8">
							<h4>
								Seleccione la ubicación
							</h4>

							<div v-if="checkCoverZones()" id="zone" class="zones">
								<div class="cover-zones">
									<a v-for="(zone,idx) in zones" v-if="zone.name_247 !='' && zone.name_247 != null" :class="['zone-card', {'marked': zone.available != 1}]" href="javascript:void(0);" @click="zone.available == 1 ? selectZone(zone.id) : false">
										<div v-if="!!zone.photo" class="zone-bg" :style="`background-image: url('${zone.photo}')`">
											<div class="bg-overlay"></div>
											<div class="action-wrapper">
												<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
											</div>
										</div>
										<div v-else class="action-wrapper only-button">
											<button type="button" class="btn-zone" v-html="zone.name_247"></button>	
										</div>
									</a>
								</div>
							</div>
							<div v-else id="zone" :class="['zones', {'more-details': checkDetailZones()}]">
								<div class="zone" v-for="(zone, idx) in zones">
									<button v-if="!!zone.name_247" @click="zone.available == 1 ? selectZone(zone.id) : false" type="button" :class="['zone-link', {'marked': zone.available != 1}]">
										<span class="title" v-html="zone.name_247"></span>	
										<span v-if="!!zone.detail" class="detail" v-html="zone.detail"></span>	
									</button>
								</div>
							</div>
		                	<div v-if="!!getWidgetFooterDescription" class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
						</div>
                    </div>
                    <div class="section-information pb-3" v-show="step == 9">
						<div class="loading-data" v-show="loadingData">
		                    <div class="loading-mask">
		                        <div class="loading-spinner">
		                            
                                <img src="https://img.mesa247.pe/archivos/mesa247/rolling-white.svg"/>
		                            <p class="loading-text"  v-html="loadingMessage"></p></div>
		                    </div>
		                </div>
                    	<div v-show="!loadingData" class="row" id="help-us-customize">
                    		<h4>
								Ayúdenos a personalizar su experiencia
							</h4>
                    	</div>
                    	<div v-show="!loadingData" id="dynamic-fields">
			                <div class="row" v-if="dynamic_inputs.length > 0 ">
				                <div class="information">
				                	<h3>
																		Completa tus datos y haz clic en &quot;Ir al útimo paso&quot;
																		</h3>
						        	<!-- Dynamic fields information -->
									<div class="dynamic-field" v-for="(dynamic_input,idx) in dynamic_inputs" :key="idx">
										<div class="title" v-html="dynamic_input.Titulo"></div>
		                            	<div class="value">
		                            		<div class="form-group" v-if="dynamic_input.TipoCampo =='text'">
												<input type="text" maxlength="30" :class="dynamicInputsValidation[dynamic_input.Id] ? 'form-control input-error':'form-control'"  v-model="dynamicFields[dynamic_input.Id]" :name="'dynamicFields-'+dynamic_input.Id" placeholder="" autocomplete="off" v-on:input="validateForm">
											</div>
											<div class="form-group" v-else-if="dynamic_input.TipoCampo =='dropdown'">
		                            			<select class="form-control custom-select" :class="dynamicInputsValidation[dynamic_input.Id] ? 'input-error':''"  v-model="dynamicFields[dynamic_input.Id]" @change="validateForm" >
		                            				<option value="dynamic_input_value" v-for="(value,idx2) in dynamic_input.Valores" key="idx2" v-html="value" v-bind:value="value">
													</option>
												</select>
		                            		</div>
										</div>
									</div>
							    </div>
			                </div>
		            	</div>
						<template v-if="showAnyQuestion == 1">
							<div v-if="![2315].includes(local_id)" v-show="!loadingData" class="row">
								<div class="information mb-0">
									<h3>
										Campos no obligatorios
									</h3>
									<template v-if="showQuestionAllergies == 1">
										<div class="form-group" style="position:relative;" v-show="[93].includes(local_id)">
											<label>¿Hay alguna alergia intolerancia o restricción que debamos considerar?</label>
											<textarea class="form-control fix-placeholder" name="allergies" v-model="reservation.allergies" rows="2" :placeholder="allergies_placeholder"></textarea>
										</div>
									</template>
									<template v-if="showQuestionSpecialRequirement == 1">
										<div v-if="reservation_types.length > 0" class="form-group"  style="display: none;" >
											<label>
											¿Tienes algún requerimiento en especial?
											</label>
											<select class="custom-select" name="reservation_type_id" v-model="reservation.reservation_type_id">
												<option :value="null"></option>
												<option :value="type.Id" v-for="type in reservation_types" v-html=" language =='en' ? type.DescripcionEn: type.Descripcion"></option>
											</select>
										</div>
									</template>
									<template v-if="showQuestionNeed == 1">
										<div class="form-group" style="position:relative;" v-show="![2268,2269,2390,2443].includes(local_id)">
											<label>
												¿Tiene alguna necesidad que tengamos que considerar?
											</label>
											<textarea class="form-control fix-placeholder" name="comment" v-model="reservation.comment" rows="2" :placeholder="comment_placeholder"></textarea>
										</div>
									</template>
									<template v-if="showQuestionAllergies == 1">
										<div class="form-group mb-0" style="position:relative;" v-show="![2268,2269,93].includes(local_id)">
											<label>¿Hay alguna alergia intolerancia o restricción que debamos considerar?</label>
											<textarea class="form-control fix-placeholder" name="allergies" v-model="reservation.allergies" rows="2" :placeholder="allergies_placeholder"></textarea>
										</div>
									</template>
								</div>
							</div>
						</template>
                        <div v-if="!!getWidgetFooterDescription && ![1057,11,873].includes(local_id) && !loadingData" class="row">
		                    <div class="description-widget">
								<span v-html="getWidgetFooterDescription"></span>
							</div>
				    	</div>
					    
                    </div>
                    <div class="button-fixed" v-show="step == 9 && !loadingData">
                    	<div class="row">
					    	<div class="buttons">
				        		<a class="btn-go-to-last-step" @click="goToLastStep">
									<span v-if="!showBeforeTheMenu">Ir al último paso</span>
									<span v-else>Continuar</span>
								</a>
								<a href="javascript:location.reload();" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
			        		</div>
					    </div>
					</div>
				</div>
				<div class="big-container">
					<div class="section-information" v-show="step == 10">
                    	<div class="row" id="your-almost-done">
                    		<div class="col-12">
								<h4 v-if="!showBeforeTheMenu || completeTheMenuValidation">
									¡Ya casi terminas!
								</h4>
								<h4 v-else>
									Seleccione el tipo de consumo

								</h4>	
							</div>
                    	</div>
                    	<div class="row">
							<div id="confirmReservationInfo" :class="!showBeforeTheMenu || completeTheMenuValidation ? 'col-xs-12 col-sm-12 col-md-7 col-lg-8 col-xl-8 order-2 order-md-1 pt-1 pl-1 pr-1' : 'col-12'">
	                    		<div v-show="!showBeforeTheMenu || completeTheMenuValidation" class="the-menu-validation-wrapper">
									<div class="information">
										<h3 :class="reservation.name !='' ? 'opacity-30':''" v-if="!isInstagram">Completa tus datos usando:</h3>
										<div class="social-icons">
											<span class="btn-social">
												<a :class="reservation.name !='' ? 'opacity-30 facebook':'facebook'" @click="signInFacebook" v-if="!isInstagram">Facebook</a>
											</span>
											<span class="btn-social">
												<a :class="reservation.name !='' ? 'opacity-30 google':'google'" @click="signInGoogle" v-if="!isInstagram">Google</a>
											</span>
										</div>
										<div class="signin-divider" v-if="!isInstagram">
											<div :class="reservation.name !='' ? 'opacity-30 text' : 'text' ">ó</div>
											
										</div>
										<h3>Reserva para:</h3>
										<div class="row">
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group">
													<label>Nombre</label>
													<input type="text" name="reservation_name" v-model="reservation.name" :class="['form-control', {'input-error': errors.reservation.name}]" placeholder="">
												</div>
											</div>
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group">
													<label>Apellidos</label>
													<input type="text" name="reservation_last_name" v-model="reservation.last_name" :class="['form-control', {'input-error': errors.reservation.last_name}]" placeholder="">
												</div>
											</div>
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group">
													<label>Email</label>
													<input type="text" name="email" v-model="reservation.email" maxlength="50" :class="['form-control', {'input-error': errors.reservation.email}]" data-culqi="card[email]" id="card[email]" autocomplete="off"  placeholder="">
												</div>
											</div>
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group cellphone_number" v-cloak>
													<label>Número de teléfono</label>
													<select name="phone_code" class="form-control" v-model="reservation.cellphone_prefix_number">
														<option v-for="phone_code in phone_codes" :value="phone_code.code" v-html="phone_code.code == '' ? phone_code.country : phone_code.country +' (+'+phone_code.code+')'"></option>
													</select>
													<input type="text" :class="['form-control', {'input-error': errors.reservation.cellphone_only_number}]" v-model="reservation.cellphone_only_number" name="cellphone_number" placeholder=""  data-culqi="card[phone]" id="card[phone]">
												</div>
											</div>
										</div>
										<div class="row" v-if="checkHotelFields()">
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group">
													<label>¿Dónde te hospedas?</label>
													<input type="text" name="hotel1" v-model="reservation.hotel1" maxlength="25" :class="['form-control', {'input-error': errors.reservation.hotel1}]" autocomplete="off"  placeholder="">
												</div>
											</div>
											<div class="col-md-6 col-sm-12 col-xs-12">
												<div class="form-group">
													<label>¿Teléfono de dónde te hospedas?</label>
													<input type="text" name="hotel2" v-model="reservation.hotel2" maxlength="25" :class="['form-control', {'input-error': errors.reservation.hotel2}]" autocomplete="off"  placeholder="">
												</div>
											</div>
										</div>
									</div>

									
									<div v-if="!!getWidgetFooterDescription && ![1057,11,873].includes(local_id)" class="description-widget">
										<span v-html="getWidgetFooterDescription"></span>
									</div>

																		<div class="description-widget">
																				<span>Si tienes alguna duda o consulta sobre el proceso de reserva, no dudes en contactarnos. <br>Puedes escribirnos a reservas@maido.pe o llamarnos al (+511) 313-5100, Anexo 21, de lunes a sábado, entre las 9:00 a.m. y 9:00 p.m. <br>¡Estaremos encantados de ayudarte!</span>
																			</div>
									
									<!-- Gurantee information -->
									<div class="guarantee-info" v-show="showGuarantee && !blockForeignPayments">
										<div v-if="reservation.waitlist != null && [2179].includes(local_id)" class="guarante-info-wrapper">
											<div class="title">
												<div v-if="language=='en'" class="subtitle">Waiting List Policy</div>
												<div v-else class="subtitle">Política de la lista de espera</div>
											</div>
											<div class="detail">
												<div v-if="language=='en'" class="detail-text">
													<b>This is not a confirmed reservation, you will be registered on the waitlist.</b>
													
													IMPORTANT:
													- We cannot ensure that your reservation request will be confirmed.
													- The waitlist for a shift is valid until 23:59 hours of the previous day.
													- If the requested space becomes available, you will receive an email from us which you must confirm within 24 hoursin order to guarantee your reservation.
													- If a space is not released, you will receive an email informing you that unfortunately we have not been able toconfirm your reservation.
												</div>
												<div v-else class="detail-text">
													<b>Esto no es una confirmación de reserva, usted se registrará en la lista de espera.</b>
													
													IMPORTANTE:
													- No podemos garantizar que su solicitud de reserva será confirmada.
													- La lista de espera para un turno es válida hasta las 23:59 horas del día previo.
													- De liberarse el espacio solicitado, nos comunicaremos con usted al correo o número de teléfono registrado en susolicitud.
													- De no liberarse un espacio, recibirá un correo informándole que lamentablemente no hemos podido confirmar susolicitud.
												</div>
											</div>
										</div>
										<div v-else class="guarante-info-wrapper">
											<div class="title">
												<div class="subtitle" v-html="guarantee.info.title" v-if="guarantee.info != null && guarantee.info.title !=''">
												</div>
												<div class="amount" v-html="guarantee.amount_format" v-if="guarantee.amount_format != '' && guarantee.amount > 0">
												</div>
											</div>
											<div class="detail">
												<div class="detail-text" v-if="guarantee.info != null && guarantee.info.text" v-html="guarantee.info.text">
												</div>
												<a @click="showGuaranteeDetail = !showGuaranteeDetail"
												v-if="!showGuaranteeDetail && guarantee.info != null && guarantee.info.detail != ''">
													Ver más detalle <i class="icon-arrow-down"></i>
												</a>
												<a @click="showGuaranteeDetail = !showGuaranteeDetail"
												v-else-if="showGuaranteeDetail && guarantee.info != null && guarantee.info.detail != ''">
													Ver menos detalle <i class="icon-arrow-up"></i>
												</a>
												<div class="detail-content" v-if="guarantee.info != null && guarantee.info.detail && showGuaranteeDetail" v-html="guarantee.info.detail">
												</div>
											</div>
										</div>
									</div>
								</div>

				        		<!-- Special dishes -->
								<div v-show="!showBeforeTheMenu || (showBeforeTheMenu && !completeTheMenuValidation)" :class="['special-dishes-info', {'alter': showBeforeTheMenu}]" v-if="showSpecialDishes">
									<div class="special-dishes-wrapper">
										<div :class="['dish-wrapper', (dishes.id == 51 || dishes.id == 53 || dishes.id == 54 || dishes.id == 55 || dishes.id == 56 || dishes.id == 63 || dishes.id == 64 ? 'has-accordion' : '')]" v-for="dishes in special_dishes">
											<div v-if="dishes.dishes.length > 0" :class="['category-head', {'accordion-category': dishes.id == 51 || dishes.id == 53 || dishes.id == 54 || dishes.id == 55 || dishes.id == 56 || dishes.id == 63 || dishes.id == 64}]">
												<div class="category-title">
													<div class="title-name">
														<div :class="['title', {'big': hasImageDishes}]" v-html="dishes.description"></div>	
														<div class="subtitle" v-if="!!dishes.descriptionadicional" v-html="dishes.descriptionadicional"></div>	
													</div>
													<div v-if="dishes.id == 51 || dishes.id == 53 || dishes.id == 54 || dishes.id == 55 || dishes.id == 56 || dishes.id == 63 || dishes.id == 64" class="title-icon">(Ver más)</div>
												</div>
											</div>

											<div class="dish" v-if="cartThemeEnabled">
												<div class="cart-dishes">
													<div class="cart-dish-wrapper" v-for="(dish,idx) in dishes.dishes">
														<div class="cart-dish-content">
															<div class="cart-dish-body">
																<p class="title" v-html="dish.description"></p>	
																<p v-if="!!dish.detail" class="description" v-html="dish.detail"></p>
																<p v-if="!!dish.price" class="price" v-html="dish.currency + ' ' + dish.price"></p>	
															</div>	
															<div class="cart-dish-image-cover">
																<div class="dish-image" :style="`background-image: url('${dish.photo_url}')`">
																	<div class="btn-controls">
																		<button type="button" class="btn btn-add-dish" @click="openDetailDish(dish)">+</button>	
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>

											<div class="dish" v-else-if="dishes.type == 1">
												<div class="row align-items-center justify-content-center" v-for="(dish,idx) in dishes.dishes">
													<div v-if="hasImageDishes" :class="['col-12', showPriceDetails ? 'col-lg-7' : 'col-lg-8']">
														<div class="dish-title-wrapper">
															<div class="dish-image-cover">
																<div class="dish-image" :style="`background-image: url('${dish.photo_url}')`"></div>
															</div>
															<div class="dish-body">
																<p class="title">
																	<span v-html="dish.description"></span><span v-if="showPriceDetails" v-html="' (' + dish.currency + ' ' + dish.price + ')'"></span><span v-html="dish.mandatory == 1 ? '*': ''"></span>	
																</p>
																<p v-if="!!dish.detail" class="description" v-html="dish.detail"></p>
															</div>
														</div>
													</div>
													<div v-else :class="['dish-name', showPriceDetails ? 'col-6 col-lg-7' : 'col-6 col-lg-8']">
														<i v-if="showBeforeTheMenu" class="bundle icon-circle"></i>
														<span v-html="dish.description"></span><span v-if="showPriceDetails" v-html="' (' + dish.currency + ' ' + dish.price + ')'"></span><span v-html="dish.mandatory == 1 ? '*': ''"></span>
													</div>
													<div :class="['dish-control control-center', {'auto-width': hasImageDishes}, showPriceDetails ? 'col-3 col-lg-2' : 'col-6 col-lg-4']" v-if="dish.mandatory == 1">
														<select :class="[!dishesValidationMandatory ? 'form-control custom-select input-error': 'form-control custom-select', {'filled': !!specialDishes[dish.id]}]" v-model="specialDishes[dish.id]" @change="validateQuantity">
															<option v-if="dish.min != 0" v-bind:value="0"></option>
															<option v-for="(d,idx) in dish.range" :key="idx" v-bind:value="idx" v-html="getDishOptionText(dish,d)"></option>
														</select>
													</div>
													<div :class="['dish-control control-center', showPriceDetails ? 'col-3 col-lg-2' : 'col-6 col-lg-4']" v-else>
														<select :class="[!dishesValidationNoMandatory ? 'form-control custom-select input-error': 'form-control custom-select', {'filled': !!specialDishes[dish.id]}]" v-model="specialDishes[dish.id]" @change="validateQuantity">
															<option v-if="dish.min != 0" v-bind:value="0"></option>
															<option v-for="(d,idx) in dish.range" :key="idx" v-bind:value="idx" v-html="getDishOptionText(dish,d)"></option>
														</select>
													</div>

													<div class="col-3 col-lg-3 dish-control control-right" v-show="showPriceDetails">
														<span v-html="specialDishesCalculated[dish.id]" v-if="specialDishesCalculated[dish.id]!=''"></span>
													</div>
												</div>
											</div>

											<div class="dish" v-else-if="dishes.type == 3">
												<div class="row align-items-center" v-for="(dish,idx) in dishes.dishes">
													<div :class="['dish-name', showPriceDetails ? 'col-6 col-lg-7' : 'col-8 col-lg-10']">
														<span v-html="dish.description"></span><span v-if="showPriceDetails" v-html="' (' + dish.currency + ' ' + dish.price + ')'"></span><span v-html="dish.mandatory == 1 ? '*': ''"></span>
													</div>
													<div :class="['dish-control control-center', showPriceDetails ? 'col-3 col-lg-2' : 'col-4 col-lg-2']">
															<select :class="(specialMixDishesCategorySelected[dishes.id] != reservation.pax) ? 'form-control custom-select input-error': 'form-control custom-select'" v-model="specialDishes[dish.id]" @change="validateQuantity">
															<option v-for="(d,idx) in dish.range" :key="idx" v-bind:value="idx" v-html="d"></option>
														</select>
													</div>

													<div class="col-3 col-lg-3 dish-control control-right" v-show="showPriceDetails">
														<span v-html="specialDishesCalculated[dish.id]" v-if="specialDishesCalculated[dish.id]!=''"></span>
													</div>
												</div>
											</div>

											<div class="dish" v-else>
												<div class="row align-items-center" v-for="(dish,idx) in dishes.dishes">
													<div :class="['dish-name', showPriceDetails ? 'col-6 col-lg-7' : 'col-8 col-lg-10']">
														<span v-html="dish.description"></span><span v-if="showPriceDetails" v-html="' (' + dish.currency + ' ' + dish.price + ')'"></span><span v-html="dish.mandatory == 1 ? '*': ''"></span>
													</div>
													<div :class="['dish-control control-center', showPriceDetails ? 'col-3 col-lg-2' : 'col-4 col-lg-2']">
															<select :class="(specialDishesCategoryMin[dishes.id] > specialDishesCategorySelected[dishes.id] || specialDishesCategoryMax[dishes.id] < specialDishesCategorySelected[dishes.id]) ||  (dish.mandatory == '1' && specialDishes[dish.id] == 0)  ? 'form-control custom-select input-error': 'form-control custom-select'" v-model="specialDishes[dish.id]" @change="validateQuantity">
															<option v-for="(d,idx) in dish.range" :key="idx" v-bind:value="idx" v-html="d"></option>
														</select>
													</div>

													<div class="col-3 col-lg-3 dish-control control-right" v-show="showPriceDetails">
														<span v-html="specialDishesCalculated[dish.id]" v-if="specialDishesCalculated[dish.id]!=''"></span>
													</div>
												</div>
											</div>
										</div>

										<div class="text-left" v-show="local_id == 1057">
											<p  v-if="language=='en'">
												All our prices include IGV.
											</p>
											<p v-else>
												Todos nuestros precios incluyen IGV.
											</p>
										</div>
									</div>
									
		                            <div v-if="dishesAmount > 0 && payment_type == 'T'" class="total separated">
		                            	<div class="total-wrapper">
											<div class="row">
												<div class="col-6 col-lg-8 total-description">
													Total a pagar:
												</div>
												<div class="col-6 col-lg-4 total-amount">
													<span v-html="formatPrice(dishesAmountFormato)"></span>
												</div>
											</div>
										</div>
		                            </div>

									<div class="notes-wrapper pt-4">
										<div v-if="(reservation.consumption_type == 1716) || (reservation.pax >= 6 && reservation.pax <= 8 && (reservation.consumption_type == 1717))" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">
												* The Experiences are not suitable for allergic to fish and seafood, celiac, gluten free, vegetarians and/or vegans.<br>
												* The total number of menus selected must be equal to the number of people on the reservation (<span v-html="reservation.pax"></span>).<br>
												* Prices includes taxes and consumption surcharge.<br>
												* Price is subject to change without notice.<br>
												* The menu cannot be modified once your reservation has been confirmed.<br>
											</p>
											<p class="text-left" v-else>
												* Las Experiencias no son aptas para personas celiacas, gluten free, vegetarianas, veganas o alérgicas a pescados y mariscos.<br>
												* El total de menús seleccionados debe ser igual al número de personas de la reserva (<span v-html="reservation.pax"></span>). <br>
												* Precio incluye impuestos y recargo al consumo.<br>
												* Precio sujeto a cambios sin previo aviso.<br>
												* Las opciones de menú elegidas no podrán ser modificadas una vez confirmada su reserva.<br>
											</p>
										</div>
										<div v-else-if="reservation.consumption_type == 1717" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">
												* The Experiences are not suitable for allergic to fish and seafood, celiac, gluten free, vegetarians and/or vegans.<br>
												* The total number of menus selected must be equal to the number of people on the reservation (<span v-html="reservation.pax"></span>). <br>
												* Price is subject to change without notice. <br>
												* Prices includes taxes and consumption surcharge. <br>
												* No corkage is allowed.<br>

											</p>
											<p class="text-left" v-else>
												* Las Experiencias no son aptas para personas celiacas, gluten free, vegetarianas, veganas o alérgicas a pescados y mariscos.<br>
												* El total de menús seleccionados debe ser igual al número de personas de la reserva (<span v-html="reservation.pax"></span>). <br>
												* Precio sujeto a cambios sin previo aviso. <br>
												* Precio incluye impuestos y recargo al consumo. <br>
												* No se permite el descorche.<br>

											</p>
										</div>
										
										<div v-if="reservation.consumption_type == 1939" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">
												* The Experiences are not suitable for allergic to fish and seafood, celiac, gluten free, vegetarians and/or vegans.<br>
												* The total number of menus selected must be equal to the number of people on the reservation (<span v-html="reservation.pax"></span>).<br>
												* Prices includes taxes and consumption surcharge.<br>
												* Price is subject to change without notice.<br>
												* The menu cannot be modified once your reservation has been confirmed.<br>
											</p>
											<p class="text-left" v-else>
												* Las Experiencias no son aptas para personas celiacas, gluten free, vegetarianas, veganas o alérgicas a pescados y mariscos.<br>
												* El total de menús seleccionados debe ser igual al número de personas de la reserva (<span v-html="reservation.pax"></span>). <br>
												* Precio incluye impuestos y recargo al consumo.<br>
												* Precio sujeto a cambios sin previo aviso.<br>
												* Las opciones de menú elegidas no podrán ser modificadas una vez confirmada su reserva.<br>
											</p>
										</div>
										<div v-else-if="reservation.consumption_type == 1940 || reservation.consumption_type == 1962" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">

												* The number of selected menus must match the number of guests in the reservation.<br>
												* Our experiences are not suitable for individuals with celiac disease, gluten-free diets, vegetarians, vegans, or those with allergies to fish and seafood.<br>
												* All prices are in Peruvian Soles (PEN) and include tax and service. Prices are subject to change without prior notice.<br>
												* We do not offer corkage service.<br>

											</p>
											<p class="text-left" v-else>

												* El número de menús seleccionados debe coincidir con la cantidad de personas en la reserva.<br>
												* Nuestras experiencias no son aptas para personas con enfermedad celíaca, dietas sin gluten, vegetarianas, veganas o con alergias a pescados y mariscos.<br>
												* Todos los precios están en Soles (PEN) e incluyen impuesto y servicio. Los precios están sujetos a cambios sin previo aviso.<br>
												* No ofrecemos servicio de descorche.<br>

											</p>
										</div>
										<div v-else-if="reservation.consumption_type == 2860 || reservation.consumption_type == 3016 || reservation.consumption_type == 3019" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">
												* All our prices include VAT and 12% service charge.
											</p>
											<p class="text-left" v-else>
												* Todos nuestros precios incluyen IGV y el 12% de servicio.
											</p>
										</div>
										<div v-else-if="reservation.consumption_type == 3322 || reservation.consumption_type == 3305" class="the-menu-notes-wrapper">
											<p class="text-left" v-if="language=='en'">
												* The minimum amount for this experience is S/ 1360.00
											</p>
											<p class="text-left" v-else>
												* El monto mínimo para esta experiencia es de S/ 1360.00
											</p>
										</div>
									</div>
								</div>

								<div v-show="dishesAmount != 0 && payment_type == 'T' && showBeforeTheMenu && completeTheMenuValidation" class="special-dishes-info" v-if="showSpecialDishes">
									<div class="total">
		                            	<div class="row">
	                                		<div class="col-6 col-lg-8 total-description">
			                                     Total a pagar:
			                                </div>
			                                <div class="col-6 col-lg-4 total-amount">
			                                    <span v-html="formatPrice(dishesAmountFormato)"></span>
			                                </div>
		                            	</div>
		                            </div>
								</div>

								<div v-show="showBeforeTheMenu && !completeTheMenuValidation" class="buttons" style="padding-bottom: 10px;">
									<div v-if="dishesCount == 0" class="default-message">
										En este momento no hay platos disponibles para la fecha u horario que seleccionaste. Puede ser que se hayan agotado por alta demanda. Te recomendamos probar con otra fecha o regresar más tarde.
									</div>
									<a v-else :class="['btn-booking', {'loading-dots': loading}]" @click="validateTheMenu()">
										<span v-if="gateway_name == 'izipay'">Continuar</span>	
										<span v-else>Ir al último paso</span>	
									</a>
									<a href="javascript:void(0);" @click="selectStep(9)" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
								</div>

								<div v-show="!showBeforeTheMenu || completeTheMenuValidation" class="the-menu-validation-wrapper">
									<!-- Payment information -->
									<div class="payment-info" v-if="hasPayment && !blockForeignPayments">
										<div class="title">Por favor, ingresa los datos para tu comprobante de pago</div>
                                        
										<div class="card-list d-flex align-items-center" v-if="['culqi3ds'].includes(gateway_name) && guarantee && guarantee.amount_currency_abr === 'PEN'">
                                          <input type="radio" name="card" class="mr-2" :checked="!isYape" @click="isYape = false">
											<img src="https://maido.mesa247.pe/reservas/img/card-list.png" class="mr-2" @click="isYape = false">
                                          <input type="radio" name="card" class="mr-2" :checked="isYape" @click="isYape = true">
											<img src="https://maido.mesa247.pe/reservas/img/yape-logo.png" @click="isYape = true">
										</div>
										<div class="card-list" v-else>
											<img v-if="gateway_name === 'kushki' && country_code == 'CL'" src="https://maido.mesa247.pe/reservas/img/card-list-cl.png">
											<img v-else src="https://maido.mesa247.pe/reservas/img/card-list.png">
										</div>
										<p>
																						<span>Ten en cuenta lo siguiente para asegurar que tu tarjeta sea válida para pagos en línea: <br></span> 
											<span v-if="payment_type =='D'">- No se realizará ningún cargo en este momento.  <br></span>
											<span>- Asegúrate de que tu tarjeta tenga habilitada la opción para compras por internet. <br></span> 
											<span>- Verifica que el CVV/CVC (los 3 dígitos al reverso de tu tarjeta) esté ingresado correctamente.</span>
																					</p>
										<div class="payment-content" v-if="['culqi','payu','kushki','wompi'].includes(gateway_name)">
                                          
                                          <div class="form-group" v-if="['kushki','wompi'].includes(gateway_name)">
                                            <div class="card-number">
                                              <label>Nombre del titular de la tarjeta</label>
                                              <input type="text" maxlength="30" :class="['form-control', {'input-error': errors.card.name}]" v-model="card.name" name="name" placeholder="" autocomplete="off">
                                            </div>
                                          </div>
											<div class="form-group">
												<div class="card-number">
													<label>Número de tarjeta de crédito o débito</label>
													<input type="text" :maxlength="gateway_name === 'kushki' ? 16 : 30" v-bind:class=" errors.card.number ? 'form-control input-error':'form-control'" v-model="card.number" payu-content="number" data-culqi="card[number]" id="card[number]"  name="number" placeholder="0000 0000 0000 0000" autocomplete="off">
												</div>
											</div>
											<div class="form-group">
												<div class="card-data">
													<label>Mes de Exp.</label>
													<input type="text" maxlength="2"
													:class="['form-control month-format', {'input-error': errors.card.expiration_month}]" payu-content="exp_month" data-culqi="card[exp_month]" id="card[exp_month]"  v-model="card.expiration_month" placeholder="MM" autocomplete="off">
												</div>
												<div class="card-data">
													<label>Año de Exp.</label>
													<input type="text" maxlength="4" :class="['form-control year-format', {'input-error': errors.card.expiration_year}]"  payu-content="exp_year" data-culqi="card[exp_year]" id="card[exp_year]" v-model="card.expiration_year" placeholder="20AA" autocomplete="off">
												</div>
												<div class="card-data">
													<label>Código de seguridad</label>
                          							<input v-if="gateway_name=='kushki'" type="password" maxlength="4" :class="['form-control cvv-format', {'input-error': errors.card.cvv}]"
													v-model="card.cvv"placeholder="CVV/CV2" autocomplete="off">
													<input v-else type="text" maxlength="4" :class="['form-control cvv-format', {'input-error': errors.card.cvv}]"
													data-culqi="card[cvv]" id="card[cvv]" v-model="card.cvv"placeholder="CVV/CV2" autocomplete="off">
												</div>
											</div>
										</div>
                                        
                                        <div class="payment-content" v-else-if="['culqi3ds'].includes(gateway_name) && !isYape">
											<div class="form-group">
												<div class="card-number">
													<label>Número de tarjeta de crédito o débito</label>
													<input type="text" :maxlength="gateway_name === 'kushki' ? 16 : 30" v-bind:class=" errors.card.number ? 'form-control input-error':'form-control'" v-model="card.number" payu-content="number" data-culqi="card[number]" id="card[number]"  name="number" placeholder="0000 0000 0000 0000" autocomplete="off">
												</div>
											</div>
											<div class="form-group">
												<div class="card-data">
													<label>Mes de Exp.</label>
													<input type="text" maxlength="2"
													:class="['form-control month-format', {'input-error': errors.card.expiration_month}]" payu-content="exp_month" data-culqi="card[exp_month]" id="card[exp_month]"  v-model="card.expiration_month" placeholder="MM" autocomplete="off">
												</div>
												<div class="card-data">
													<label>Año de Exp.</label>
													<input type="text" maxlength="4" :class="['form-control year-format', {'input-error': errors.card.expiration_year}]"  payu-content="exp_year" data-culqi="card[exp_year]" id="card[exp_year]" v-model="card.expiration_year" placeholder="20AA" autocomplete="off">
												</div>
												<div class="card-data">
													<label>Código de seguridad</label>
                          							<input v-if="gateway_name=='kushki'" type="password" maxlength="4" :class="['form-control cvv-format', {'input-error': errors.card.cvv}]"
													v-model="card.cvv"placeholder="CVV/CV2" autocomplete="off">
													<input v-else type="text" maxlength="4" :class="['form-control cvv-format', {'input-error': errors.card.cvv}]"
													data-culqi="card[cvv]" id="card[cvv]" v-model="card.cvv"placeholder="CVV/CV2" autocomplete="off">
												</div>
											</div>
										</div>
                        				<div class="payment-content" v-else-if="['culqi3ds'].includes(gateway_name) && isYape">
											<div class="form-group">
												<div class="card-number">
													<label>Número de celular asociado a Yape</label>
													<input type="text" :maxlength="9" class="form-control"  data-culqi="yape[phone]" id="yape[phone]" placeholder="e.g. 999-999-999" autocomplete="off">
												</div>
											</div>
                      						<div class="form-group">
												<div class="card-number">
													<label>Código de aprobación</label>
													<input type="text" :maxlength="6" class="form-control" data-culqi="yape[code]" id="yape[code]" name="code" placeholder="e.g. 123456" autocomplete="off">
												</div>
											</div>
										</div>
										
										<div v-else-if="['stripe'].includes(gateway_name)" class="payment-content stripe-form-wrapper">
											<div id="stripeForm" v-if="stripe.ready">
												<div class="form-group">
													<div class="card-number">
														<label>Número de tarjeta de crédito o débito</label>
														<div id="card-number-wrapper" :class="['stripe-input-wrapper', {'input-error': errors.card.number}]">
															<div id="card-number"></div>
														</div>
													</div>
												</div>
												<div class="form-group credit-card-couple">
													<div class="couple-box-exp">
														<label>Fecha de vencimiento</label>
														<div id="card-expiry-wrapper" :class="['stripe-input-wrapper', {'input-error': errors.card.expiration_year || errors.card.expiration_month}]">
															<div id="card-expiry"></div>
														</div>
													</div>
													<div class="couple-box-cvv">
														<label>Código de seguridad</label>
														<div id="card-cvc-wrapper" :class="['stripe-input-wrapper', {'input-error': errors.card.cvv}]">
															<div id="card-cvc"></div>
														</div>
													</div>
												</div>
											</div>
											<div v-else-if="stripe.error" class="stripe-error-container">
												<div class="stripe-error-message">
													<i class="fas fa-exclamation-triangle stripe-error-icon"></i>
													<div class="stripe-error-text">Error al cargar el formulario de pago</div>
													<button @click="retryStripeInitialization" class="btn btn-retry-stripe">
														<i class="fas fa-redo"></i> Reintentar
													</button>
												</div>
											</div>
											<div v-else class="stripe-loading-container">
												<div class="stripe-loading-message">
													<i class="icon-spinner fa-spin"></i>
													<p>Cargando formulario de pago...</p>
													<div class="stripe-loading-progress">
														<div class="stripe-loading-bar"></div>
													</div>
												</div>
											</div>
										</div>
										<div v-if="gateway_name == 'kushki'" class="text-center">
											<img class="mt-5 bg-white" style="padding: 4px 10px;border-radius: 5px;" src="https://kajita-uat.kushkipagos.com/static/media/powered-kushki.7ede8a37.svg">
										</div>
									</div>

									<!-- Invoicing information -->
									<div class="invoicing-info" v-if="hasInvoicing && !blockForeignPayments && enabledPaymentDocuments > 0">
										<div class="title">Por favor, ingresa los datos para tu comprobante de pago</div>
										<div class="invoicing-content">
											<div class="row">
												<div class="form-group col-12">
													<div class="invoicing-type col-left">
														<label>Tipo de documento</label>
														<select 
														:class="['form-control custom-select', {'input-error': errors.document_type}]" name="document_type" 
														v-model="reservation.document_type">
															<option v-bind:value="index" v-for="(doc,index) in document_types">{{ doc }}</option>
														</select>
													</div>
													<div class="invoicing-type col-right" v-if="reservation.document_type == '2'">
														<label>Número de documento</label>
														<input type="text" maxlength="70"
														:class="['form-control', {'input-error': errors.document_number}]"
														v-model="reservation.document_number" name="document_number" placeholder="" autocomplete="off">
													</div>
													<div class="invoicing-type col-right" v-if="reservation.document_type == '1'">
														<label v-if="country_code === 'EC'">Número de RUC</label>
														<label v-else-if="country_code === 'CO'">Número de RUT/NIT</label>
														<label v-else>Número de RUC o RUT</label>
														<input type="text" maxlength="70" 
														:class="['form-control', {'input-error': errors.document_number}]"
														v-model="reservation.document_number" name="document_number" placeholder="" autocomplete="off">
													</div>
												</div>
											</div>
											<div class="row">
												<div class="form-group col-12">
													<div class="invoicing-type col-left" v-if="reservation.document_type == '1'">
														<label>Nombre o razón social</label>
														<input type="text" maxlength="150"
														:class="['form-control', {'input-error': errors.customer_name}]"
														v-model="reservation.customer_name" name="customer_name" placeholder="" autocomplete="off">
													</div>
													<div class="invoicing-type col-right" v-if="reservation.document_type == '1' || country_code =='CL'">
														<label>Dirección fiscal</label>
														<input type="text" maxlength="150" 
														:class="['form-control', {'input-error': errors.customer_address}]"
														v-model="reservation.customer_address" name="customer_address" placeholder="" autocomplete="off">
													</div>
												</div>
											</div>
											<div class="row">
												<div class="form-group col-12">
													<div class="invoicing-type col-left" v-if="reservation.document_type == '1'">
														<label>Email de facturación</label>
														<input type="text" maxlength="50" 
														:class="['form-control', {'input-error': errors.email_billing}]"
														v-model="reservation.email_billing" name="email_billing" placeholder="" autocomplete="off">
													</div>
												</div>
											</div>
										</div>
									</div>

									<div class="invoicing-info">
										<div v-if="customPolicyEnabled" :class="errors.reservation.agree_custom_policy ? 'input-error control-switch':'control-switch'" >
											<div class="custom-control custom-switch">
												<input type="checkbox" class="custom-control-input" id="agree_custom_policy"  v-model="reservation.agree_custom_policy">
												<label class="custom-control-label" for="agree_custom_policy">
																										 Acepto los <a href="https://maido.pe/maido-politica-de-privacidad-del-sitio-web" target="_blank">términos y condiciones</a> de Food Service Investment S.A.C.
																									</label>
											</div>
										</div>
										<div v-if="extraCustomPolicyEnabled" :class="errors.reservation.agree_extra_custom_policy ? 'input-error control-switch':'control-switch'" >
											<div class="custom-control custom-switch">
												<input type="checkbox" class="custom-control-input" id="agree_extra_custom_policy"  v-model="reservation.agree_extra_custom_policy">
												<label class="custom-control-label" for="agree_extra_custom_policy">
																										Acepto las <a href="https://maido.pe/maido-politicas-de-reserva" target="_blank">Políticas de Reserva</a> de Food Service Investment S.A.C.
																									</label>
											</div>
										</div>
										<div :class="errors.reservation.agree_policy ? 'input-error control-switch':'control-switch'" >
											<div class="custom-control custom-switch">
											<input type="checkbox" class="custom-control-input" id="agree_policy"  v-model="reservation.agree_policy">
											<label class="custom-control-label" for="agree_policy">
												Acepto los <a href="https://www.mesa247.pe/terminos_condiciones" target="_blank">términos, condiciones</a> y <a href="https://www.mesa247.pe/politicas_privacidad" target="_blank"> políticas de privacidad</a> de MESA 24/7 S.A.
											</label>
											</div>
										</div>
										
										
										<div class="control-switch">
											<div class="custom-control custom-switch">
											<input type="checkbox" class="custom-control-input" id="politic_communication"  v-model="reservation.politic_communication">
											<label class="custom-control-label" for="politic_communication">
																						Consiento la recepción de comunicaciones del restaurante por e-mail y/o SMS con fines comerciales.
																						</label>
											</div>
										</div>
										<div v-if="showAgeAccepted" :class="errors.reservation.agree_age ? 'input-error control-switch':'control-switch'">
											<div class="custom-control custom-switch">
												<input type="checkbox" class="custom-control-input" id="agree_age" v-model="reservation.agree_age">
												<label class="custom-control-label" for="agree_age">
														Declaro que soy mayor de 14 años.
												</label>
											</div>
                    					</div>
										
										<div v-if="gateway_name == 'wompi'" :class="errors.wompi_accepted ? 'input-error control-switch':'control-switch'">
											<div class="custom-control custom-switch">
												<input type="checkbox" class="custom-control-input" id="colombian_data_manipulation"  v-model="wompi_accepted"@change="()=>{errors.wompi_accepted=false}">
												<label class="custom-control-label" for="colombian_data_manipulation">
												Acepto haber leído los <a href="https://wompi.com/assets/downloadble/reglamento-Usuarios-Colombia.pdf" target="_blank">términos y condiciones y la política de privacidad</a> para hacer esta compra.
												</label>
											</div>
                    					</div>
									</div>

									<div class="information" v-if="errorMessage != '' ">
										<div class="error-message" v-html="errorMessage"></div>
									</div>

																		<div class="buttons" style="padding-bottom: 10px;">
										<a class="btn-disabled btn-booking loading-dots" @click="doReservation" v-if="processingReservation">Procesando</a>
										<a class="btn-booking" @click="doReservation" v-else>
											<span v-if="reservation.waitlist != null">Añadirme a la lista de espera</span>
											<span v-else v-html="gateway_name == 'izipay' ? 'Continuar' : 'Confirma tu reserva'"></span>
										</a>
										<a href="javascript:void(0);" @click="backPreviewLastStep()" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
									</div>
																	</div>
							</div>
							<div v-show="!showBeforeTheMenu || completeTheMenuValidation" class="col-xs-12 col-sm-12 col-md-5 col-lg-4 col-xl-4 order-1 order-md-2 pt-1 pl-1 pr-1">
								<div class="summary">
									<h6 v-html="local_name"></h6>
									<address v-html="local_ubigeo"></address>
									<div class="form-group" v-if="local_address !=''">
										<span class="label"><i class="icon-marker"></i></span>
										<span class="value"><span v-html="local_address"></span></span>
									</div>
									<div class="form-group" v-if="local_phone !=''">
										<span class="label"><i class="icon-phone"></i></span>
										<span class="value"><span v-html="local_phone"></span></span>
									</div>
									<div class="divider"></div>
									<div class="form-group" v-if="reservation.pax != null">
										<span class="label"><i class="icon-persons"></i></span>
										<span class="value"><span v-html="reservation.pax + (reservation.pax > 1 ? ' personas' : ' persona')"></span></span>
									</div>
									<div class="form-group" v-if="reservation.date != null">
										<span class="label"><i class="icon-calendar"></i></span>
										<span class="value"><span v-html="selectedDate "></span></span>
									</div>
									<div class="form-group" v-if="reservation.hour != null">
										<span class="label"><i class="icon-clock"></i></span>
										<span class="value"><span v-html="tConvert2(reservation.hour)"></span> <span v-if="reservation.waitlist != null">(Waitlist)</span></span>
									</div>
									<div class="form-group" v-if="reservation.zone_name != null && selectManualZone && showEmailZones">
										<span class="label"><i class="icon-service-terraza"></i></span>
										<span class="value"><span v-html="reservation.zone_name "></span></span>
									</div>
									<div class="form-group" v-if="reservation.consumption_type_name != null && selectManualConsumptionType">
										<span class="label"><i class="icon-food-type"></i></span>
										<span class="value"><span v-html="reservation.consumption_type_name"></span></span>
									</div>
									<div class="special-dishes-dummary-warpper" v-if="specialDishesSelected.length > 0">
										<div class="divider"></div>
										<div class="form-group">
											<div class="label"><i class="icon-list"></i></div>
											<div class="value">Opciones de menú</div>
											<div class="menu-options-value" style="width: 100%">
												<p v-for="(specialDishSelected, ids) in specialDishesSelected" :key="ids" v-html="specialDishSelected"></p>	
											</div>
										</div>
										
									</div>
									
												                        <div class="buttons" style="padding: 20px 0px;">
						        		<a class="btn-disabled btn-booking loading-dots" @click="doReservation" v-if="processingReservation">Procesando</a>
						        		<a class="btn-booking" @click="doReservation" v-else>
											<span v-if="reservation.waitlist != null">Añadirme a la lista de espera</span>
											<span v-else v-html="gateway_name == 'izipay' ? 'Continuar' : 'Confirma tu reserva'"></span>
										</a>
										<a href="javascript:void(0);" @click="backPreviewLastStep()" class="btn btn-step-back"><i class="icon-arrow-left-alt"></i> Regresar</a>
						        	</div>
						        										<div>
										<span class="chronometer" v-if="timer > 0" v-html="timerString"></span>
										<span v-else> </span>
									</div>
								</div>
							</div>

                    	</div>

                    </div>


          
          <div class="section-detail" v-show="step == 11">
						<div class="row">
							<h4 v-if="reservation.waitlist == 0 || reservation.waitlist == null">¡Tu reserva está confirmada!</h4>
							
							<h4 v-else>Estás en lista de espera</h4>
						</div>
						<div class="row">
							<div class="booking-information extended">
								<div class="row">
									<div class="wrap-detail-reservation">
										
										
										
										<div class="content-description">
											<h2 v-html="local_name"></h2>
                      <div class="reservation-confirm-bundle" v-if="reservation.waitlist == 0 || reservation.waitlist == null"><i class="icon-check bundle"></i> <span class="ml-2">Reserva confirmada</span></div>
											
											
											
											
											
											
											
											
											
										</div>
                    <div class="share-action-container">
                    <a :href="`https://restaurantes.mesa247.pe/reserva/${reservation_info.Hash}/comparte-tu-reserva`" target="_blank" class="action-button-item active" v-if="reservation.waitlist == 0 || reservation.waitlist == null">
											
											<i class="action-icon icon-persons"></i>
											<span class="action-name">Comparte tu reserva</span>
										</a>
                    </div>
									</div>
									
								</div>
								<div class="subtitle-description" v-if="reservation.waitlist == 0 || reservation.waitlist == null">
									Detalle de tu reserva	
								</div>
								<div class="subtitle-description" v-else>
																	Has sido agregado a la lista de espera. Serás notificado cuando exista un espacio disponible.
																</div>
								<div class="row reset-row" style="margin-right: 5px;margin-left: 5px;">
									<div class="col-12 col-md-6">
										<div class="form-group" v-if="reservation_info.NombreDuenoReserva != null">
											<div class="label-separator"><i class="icon-avatar"></i></div>
											<div class="value-reservation" v-html="reservation_info.NombreDuenoReserva + ' ' + reservation_info.ApellidoDuenoReserva"></div>
										</div>
										<div class="form-group" v-if="reservation_info.CantidadPersonas != null">
											<div class="label-separator"><i class="icon-persons"></i></div>
											<div class="value-reservation" v-html="(reservation_info.CantidadPersonas > 1 ? reservation_info.CantidadPersonas + ` Personas` : reservation_info.CantidadPersonas + ` Persona` )"></div>
										</div>
										<div class="form-group" style="padding-left: 0px;" v-if="reservation_info.FechaReserva != null">
											<div class="label-separator"><i class="icon-calendar"></i></div>
											<div class="value-reservation" v-html="reservation_info.FechaReserva"></div>
										</div>
										<div class="form-group" v-if="reservation_info.HoraInicio != null">
											<div class="label-separator"><i class="icon-clock"></i></div>
											<div class="value-reservation" v-html="reservation_info.HoraInicio"></div>
										</div>
										<div class="form-group" v-if="reservation_info.TipoConsumo != null && (reservation.consumption_type_name != null && selectManualConsumptionType) && ((language == 'en' && reservation_info.TipoConsumo.DescripcionEn != '') || (language != 'en' && reservation_info.TipoConsumo.Descripcion != '')) && local_id != 2179 && local_id != 2246">
											<div class="label-separator"><i class="icon-food-type"></i></div>
											<div class="value-reservation" v-html="language == 'en' ? reservation_info.TipoConsumo.DescripcionEn : reservation_info.TipoConsumo.Descripcion"></div>
										</div>
										
                                        
                                        <div class="form-group" v-if="reservation_info.AmbienteNombre != null && (reservation.zone_name != null && selectManualZone) && showEmailZones && reservation_info.AmbienteNombre != '' && ![93,2192,686,54,27,175,55,28,2363].includes(local_id)">
											<div class="label-separator"><i class="icon-service-terraza"></i></div>
											<div class="value-reservation" v-html="reservation_info.AmbienteNombre"></div>
										</div>
										<div class="form-group" v-if="reservation_info.Tipo != null && reservation_info.Tipo != ''">
											<div class="label-separator"><i class="icon-comment"></i></div>
											<div class="value-reservation" v-for="res_type in reservation_types" v-if="res_type.Id == reservation_info.Tipo" v-html="res_type.Descripcion"></div>
										</div>
										<div class="form-group" v-if="reservation_info.Comentario != null && reservation_info.Comentario != ''">
											<div class="label-separator"><i class="icon-comment-alt"></i></div>
											<div class="value-reservation" v-html="reservation_info.Comentario"></div>
										</div>
										<div class="form-group" v-if="reservation_info.Alergias != null && reservation_info.Alergias != ''">
											<div class="label-separator"><i class="icon-commet-alt"></i></div>
											<div class="value-reservation" v-html="reservation_info.Alergias"></div>
										</div>

                    
                    <div class="form-group" v-if="hasBeenPaid && ['P','T'].includes(payment_type)">
                      <div class="label-separator">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="18" viewBox="0 0 576 512">
                          <path d="M64 32C28.7 32 0 60.7 0 96v32H576V96c0-35.3-28.7-64-64-64H64zM576 224H0V416c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V224zM112 352h64c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm112 16c0-8.8 7.2-16 16-16H368c8.8 0 16 7.2 16 16s-7.2 16-16 16H240c-8.8 0-16-7.2-16-16z"/>
                        </svg>
                      </div>
                      <div class="value-reservation"> 
                        <p v-html="`${card.number.slice(0,4)}********${card.number.slice(-4)}`"></p>
                      </div> 
                    </div>

                    <div class="form-group" v-if="hasBeenPaid" style="color: #856404;">
                      <div class="label-separator"style="color: #856404;">
                        <svg class="flex-shrink-0 inline w-4 h-4 me-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" height="16" width="16"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/></svg>
                      </div>
                      <div class="value-reservation" style="color: #856404;"> 
                        <span style="" v-if="['P','T'].includes(payment_type)">En tu extracto bancario, la compra aparecerá a nombre de <strong>{{ statement_mesa_name }}</strong>.</span>
                        <span style="" v-else>En tu extracto bancario, la transacción de verificación de tarjeta aparecerá a nombre de <strong>{{ statement_mesa_name }}</strong>.</span>
                        <br>
                        <br>
                        <span><strong>*El documento de pago será entregado por el restaurante.</strong></span>
                      </div> 
                    </div>

                    
										</div>

                    <div class="col-12 col-md-6 new-action-buttons-container" v-if="reservation.waitlist == 0 || reservation.waitlist == null">
                      <a :href="local_id == 2179 || local_id == 2246 ? `https://restaurantes.mesa247.pe/reserva/${reservation_info.Hash}/editar` : `https://restaurantes.mesa247.pe/reserva/detalle/${reservation_info.Hash}`" target="_blank" class="action-button-item-special">
											
											<span class="action-name">Editar</span>
										</a>
										<a :href="local_id == 2179 || local_id == 2246 ? `https://restaurantes.mesa247.pe/reserva/${reservation_info.Hash}/editar` : `https://restaurantes.mesa247.pe/reserva/detalle/${reservation_info.Hash}`" target="_blank" class="action-button-item-special">
											
											<span class="action-name">Cancelar</span>
										</a>


									</div>
								</div>
																<div class="row">
									
									
									
									
									
									
									
									
									
									
									
									
									
									
								</div>
								

                














								<div class="value-reservation mt-4 text-left text-dark" style="padding-left: 18px; font-size: 14px; font-family: Manrope-Light;" v-if="!!(guarantee && guarantee.info && guarantee.info.text) && hasBeenPaid">
									<p style="white-space: pre-line;">*{{ guarantee?.info?.text }}</p>
								</div>
							</div>
						</div>
						        </div>


          


				</div>
			</section>
			<section v-if="!!recommended_locals && recommended_locals.length > 0 && step <= 5">
				<div class="container">
					<div class="extra-detail-content">
						<div class="recommend-locals-wrapper">
							<div class="recommend-locals-title">
								<h4>También podrías probar</h4>
							</div>
							<div class="recommend-local-items">
								<div class="local-item"
									 v-for="(recommendLocal, idl) in recommended_locals" :key="idl">
									<div class="avatar" :style="`background-image: url('${recommendLocal.image_url}')`"></div>
									<div class="description">
										<h5 v-html="recommendLocal.name"></h5>
										<ul>
											<li><i class="icon-food-type"></i> <span v-html="recommendLocal.type_of_food"></span> <span v-if="!!recommendLocal.ubication" v-html="` | ${recommendLocal.ubication}`"></span></li>
											<li><i class="icon-marker"></i> <span v-html="recommendLocal.address"></span></li>
										</ul>
									</div>
									<div class="btn-actions">
										<a v-if="!!recommendLocal.group_urls" 
										   :href="recommendLocal.group_urls.url" 
										   class="btn btn-reservation-link"
										   target="_blank">Reservar</a>
									</div>
								</div>
							</div>
						</div>
					</div>	
				</div>	
			</section>
									<div class="modal fade modal-focus modal-beauty" id="confirmPopup" tabindex="-1" role="dialog" aria-hidden="true">
				<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							Le recordamos que la reserva se está generando fuera de nuestro periodo de política de cancelación. Por favor tenga en cuenta que de cancelar su reserva se ejecutará el cobro de garantía de manera automática. <br><br>Agradecemos no deje de contactar a nuestro equipo de reservas por si surgiera algún evento no previsible. Correo: reservas@maido.pe - Telf: +51(01) 3135-100 Anexo 21. <br><br>Muchas gracias.<br>
						</div>
					</div>
				</div>
			</div>
						<div class="modal fade modal-focus modal-beauty" id="specialDishesPopup" tabindex="-1" role="dialog" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
						</div>
						<div class="modal-body">
							<div class="message-content" v-html="specialDishesPopupMessage"></div>
							<div class="text-center mt-3">
								<button type="button" class="btn btn-popup" data-dismiss="modal" aria-label="Close">Aceptar</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div v-if="cartThemeEnabled" v-show="detailDishPopup.show" class="overlay-cover"></div>
			<div v-if="cartThemeEnabled" :class="['cart-popup', {'show': detailDishPopup.show}]">
				<div class="popup-card">
					<div class="card-header">
						<button type="button" @click="closeDetailDish()" class="btn btn-cart-close">&#128473;</button>
						<div class="popup-dish">
							<div v-if="!!detailDishPopup.dish" class="cart-dish-wrapper">
								<div class="cart-dish-content">
									<div class="cart-dish-body">
										<p class="title" v-html="detailDishPopup.dish.description"></p>	
										<p v-if="!!detailDishPopup.dish.detail" class="description" v-html="detailDishPopup.dish.detail"></p>
										<p v-if="!!detailDishPopup.dish.price" class="price" v-html="detailDishPopup.dish.currency + ' ' + detailDishPopup.dish.price"></p>	
									</div>	
									<div class="cart-dish-image-cover">
										<div class="dish-image" :style="`background-image: url('${detailDishPopup.dish.photo_url}')`">
											<div class="btn-controls">
												<button type="button" class="btn btn-add-dish" @click="openDetailDish(dish)">+</button>	
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>	
					</div>	
					<div class="card-body">
					</div>
					<div class="card-footer">
						<button class="btn btn-add-cart" type="button">
							Agregar
						</button>	
					</div>	
				</div>
			</div>
			
		</div>
	</div>
</div>
<div id="events-ga"></div>
<script type="application/ld+json">
{
"@context":"http://schema.org",
"@type":"Restaurant",
"@id":"https://maido.mesa247.pe/reservas/maido",
"image":"https://img.mesa247.pe/archivos/w-logo-maido-1567438004.png",
"name":"Maido",
"priceRange":"S/ 200",
"servesCuisine":"Nikkei / Japonesa",
"telephone":"5113135100",
"url":"https://maido.mesa247.pe/reservas/maido",
"address":{
    "@type":"PostalAddress",
    "streetAddress": "Ca. San Martín No. 399",
    "addressLocality": "Miraflores",
    "addressRegion":"LIMA",
    "addressCountry":"Perú",
    "postalCode":"15074"
},
"geo":{"@type":"GeoCoordinates","latitude":-12.125420200000000,"longitude":-77.030574400000000 },
"acceptsReservations":"True",
"potentialAction":{
    "@type":"ReserveAction",
    "target":[{
        "@type":"EntryPoint",
        "urlTemplate":"https://maido.mesa247.pe/reservas/maido",
        "inLanguage":"es",
        "actionPlatform":["http://schema.org/DesktopWebPlatform","http://schema.org/MobileWebPlatform"]
        },{
        "@type":"EntryPoint",
        "urlTemplate":"https://maido.mesa247.pe/reservas/maido",
        "inLanguage":"es",
        "actionPlatform":"http://schema.org/AndroidPlatform"
    }],
    "result":{
        "@type":"FoodEstablishmentReservation",
        "name":"Haz tu reserva en Maido"
    }
}
}</script>

	<!-- Footer -->
		<div class="widget-footer">
				<div class="container">
			<div class=" row-maido-wrapper ">
				
				<p class="copyright">Powered by mesa 24/7</p>
				<span class="links">
					<a href="https://www.mesa247.pe/terminos_condiciones" target="_blank">Términos y condiciones</a>
										<a href="https://www.mesa247.pe/politicas_privacidad" target="_blank">Políticas de privacidad</a>
				</span>
			</div>
		</div>
		<div style="display: none">
			widget202409
		</div>
		<div >v2.2024.02.19.13.25 - W</div>
	</div>
		<!-- Scripts -->
	<script src="https://maido.mesa247.pe/reservas/js/app.js?id=a33c5f16d6d80bfaaf9e"></script>
	
	
	<script>

		$(document).ready(function() {
			if ($('#session-frame').length > 0) {

				$('#session-frame').on('load', function(){
					console.log('load');
					$('#session-frame').remove()

					
				});
			}

			$('#logoutButton').on('click', function(e) {
				e.preventDefault();
				var _this = $(this)

				$('body').append('<iframe id="logout-frame" style="display: none" src="https://mesa247.pe/user/logout"></iframe>');

				$('#logout-frame').on('load', function(){
					console.log('load');
					$('#logout-frame').remove()

					window.location.href = _this.attr('href')
				});

			});
		});
	</script>

<script type="text/javascript">
	function setCookie(cname, cvalue, exhours) {
		var d = new Date();
		d.setTime(d.getTime() + (exhours * 60 * 60 * 1000));
		var expires = "expires="+d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}

	function setMesaCookie(cname, cvalue, exhours) {
		var d = new Date();
		d.setTime(d.getTime() + (exhours * 60 * 60 * 1000));
		var expires = "expires="+d.toUTCString();
		document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/;domain=.mesa247.pe";
	}

	function getCookie(cname) {
		var name = cname + "=";
		var ca = document.cookie.split(';');

		for(var i = 0; i < ca.length; i++) {
			var c = ca[i];

			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}

			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}

		return "";
	}

	function removeCookie(cname) { 
		setCookie(cname, 0, 0); 
	}
  </script>

	<script src="https://maido.mesa247.pe/reservas/js/vue.min.js"></script>

	
<script type="text/javascript">
function tConvert(time) {
    // Check correct time format and split into components
    time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

    if (time.length > 1) { // If time format correct
        time = time.slice(1); // Remove full string match value
        time[5] = +time[0] < 12 ? 'AM' : 'PM'; // Set AM/PM
        time[0] = +time[0] % 12 || 12; // Adjust hours
    }

    return time.join(''); // return adjusted time or original string
}
function tConvert2(time){
    time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];
    if (time.length > 1) {
        time = time.slice(1);
        time[5] = +time[0] < 12 ? ' am' : ' pm';
        time[0] = +time[0] % 12 || 12;
    }

    return time.join('');
}
</script>

	
<script src="https://maido.mesa247.pe/reservas/js/moment.full.min.js"></script>
<script src="https://maido.mesa247.pe/reservas/js/v-calendar-v2.4.1.min.js"></script>
<script src="https://checkout.culqi.com/v2"></script>


<script src="https://3ds.culqi.com" defer></script>
<script src="https://cdn.kushkipagos.com/kushki.min.js"></script>




<script type="text/javascript">
  moment.locale('es');
var reservation = new Vue({
	el:  '#reservation',
	data: {
		attrs: [],
		available_dates: [],
		country_code: "PE",
		language: "es",
		errorMessage: "",
		loading: true,
		loadingPeople: true,
		loadingDate: false,
		loadingHour:false,
		loadingData:false,
		loadingMessage: "Cargando",
		mainMessage: "",
		show_user_menu: false,
		dates: [],
		displayLangList: false,
		hours: [],
		local_id:2179,
		max_pax: 10,
		min_pax: 1,
		no_quotes_availables: false,
		no_schedules_availables: false,
		start_date: "2025-10-01",
		end_date: "2025-12-31",
		people: [],
		available_paxs: [],
		step: 1,
		firstStep: 1,
		schedule_id: null,
		modelConfig: {
			type: 'string',
			mask: 'YYYY-MM-DD',
		},
		fastCalendarEnabled: '0',
		optionsOrder: 0,
		prefix_phone: 51,
		zones: [],
		consumption_types: [],
        useConsumptionTypes: 1,
        useZones: 1,
        showEmailZones: true,
        showQuestionSpecialRequirement: 1,
        showQuestionNeed: 1,
        showQuestionAllergies: 1,
        showAnyQuestion: 1,
        selectManualConsumptionType: true,
        selectManualZone: true,
        autoSelectFirstConsumptionType: true,
		access_token: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjNjOTk1NGViMDAxN2Q0OTE1NDczNDEzNDc4YmFiOTE0Yjg2ZDk0MTEwOWI5YTlhODI3Y2Q5ZjliY2EyNTk5OTgyZGNkMzI5ZDMwY2VlYWUyIn0.eyJhdWQiOiI3MDgiLCJqdGkiOiIzYzk5NTRlYjAwMTdkNDkxNTQ3MzQxMzQ3OGJhYjkxNGI4NmQ5NDExMDliOWE5YTgyN2NkOWY5YmNhMjU5OTk4MmRjZDMyOWQzMGNlZWFlMiIsImlhdCI6MTc1OTUxMTgyMCwibmJmIjoxNzU5NTExODIwLCJleHAiOjE3OTEwNDc4MjAsInN1YiI6IjQ4NDk2Iiwic2NvcGVzIjpbXX0.ZiyaNXfJgw7a2FeXXaa-N8Md0QDCvL57dPlyf1RnzbxpSmHQZ7Yn__78ny0OP9dtd5t-zWuCprUTzkaM9lksJ-VnLnDt10sRKlu68sM4sdn0bwqNMhKSeOxbyOXP_00KRYAfSoq1wHHbW4_ToEBEdSvf8hyIVp_m5MeOCrqVym3gvWKwevGWga7nkE6PEGPpNBdj2Up37yZ101zus7idXedrTIKUCmiUXeKVImj5nO3GUM4I8F0vIqW79GTeHbSwbV6OeT7BSaMclkzalT9knZj0K-hiJ_MibsiUqbflTshUpCaN1G7pOi8EsX8MjLo6kJoZnPfcG_DOgKTwubeu7_rMSfuSIh9qxS18XDsoeui2kDWp24VOWTTkhDftj1px9sGHp-acnSUyn-McWgO0I-K1C24EY0jblXx0QGEoOYm-PKSl6Z_Jkcaw4toKrS_l9UOBeQndsL3nACuU-PTp5FmWbLsnQkBr3b13p_uj_d394dtrqk4In2uuiOaQQyGEf4E2KqeSQjy2CNKcDXdlElp9atAwT1wChl3x_G4LcDB4yWgFCw5KyT3r7xynKzqw2FPEfeVnbL7orc2roNu_1A6Hy29puR3gKlmeNkwDPhAWBian0MAYF0jlqJ6EMI1pihs7Hg7Um56sqgp7ReJc-NOcWzVmVHT2ZGaN3rT-8HQ',
		access_token2: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImQyYjY5OWZhYWJkMTYxODAzZTQ0YTg2NjVkY2MzYWNkY2Y5MWM5MjAzNGIzODkwNzFhMDQwMjE2YmJmYTJlNmZmZWJkYmE3ZmU5M2NkNjU3In0.eyJhdWQiOiI3MDgiLCJqdGkiOiJkMmI2OTlmYWFiZDE2MTgwM2U0NGE4NjY1ZGNjM2FjZGNmOTFjOTIwMzRiMzg5MDcxYTA0MDIxNmJiZmEyZTZmZmViZGJhN2ZlOTNjZDY1NyIsImlhdCI6MTc1OTUxMTgyMCwibmJmIjoxNzU5NTExODIwLCJleHAiOjE3OTEwNDc4MjAsInN1YiI6IjE5NiIsInNjb3BlcyI6W119.gCtyyH0O2htkfQKa-0iiU2CF5t-9dVgca3RiuCX1JXy7MD4WNpM7_22Gnz-Un-GU4tjWds1Tg__VdQsXvEDMs_rawYkDePCYQON89j_HIagF6c5ykTBJ38Tx07AgOXbil0A0Jq7MQ9grj0MNQStZJ2Dukg6yflxi2VPlf3GXEseDZgeaXA5CV7JyvNccynGP5pvRt4dxNOuKgmjmULPnRaoRjoBxf7RYUln3NPy_7TQR6b9A4XlSzfYWwMz_r-ls-1sjrTtyh5N7EdnYk7FDDPi5-LEpd2l5YwafwGeXuWt-FP2qfZqWGqSBJlw9z6WN0ulH5FxVDp5Dj_ygWl4JxKdbZ1ECUu9Ax3aRqnTyILaZXT-9ML4P3jUMLT7zODhHU4g3rhdamGuCbjx8nSIFzydRm5qzWAAeTfuridlzrRoC5mfkAktFp3HzwMSbBJ586neuVCZs7NP-jsJK4aE4960htg_ELBNo8jqr3smnfFgX_fGdHq9nuVT2W5lrUayiZV3kwKsmy3c0fVdj_igF6-cKmiDtWX32zHrCNVkUvbhVWv7rTWvulmWCi6BdFQaCBjesb-HO1BSzQLrkfl4a2P-i3Hcbm8QH6AspIBo5IKwNWDM52UDjM2_R0OGdJPvyLTW6UWoIqjyDERKXa4aVJTFbnqX00bSbFihUxPYSuMU",
		processingReservation: false,
		showFinishMessage: false,
		hasPayment: false,
		hasInvoicing: false,
		enabledPaymentDocuments: '2',//0: No muestra docs y no es requerido. 1: Muestra docs y no es requerido. 2: Muestra docs y es requerido
		requiredPaymentDocuments: false,
		showGuarantee: false,
		showGuaranteeDetail: false,
		showSpecialDishes: false,
		selectedDate: null,
		selectedHour: null,
		reservation_types: [],
		special_dishes: [],
		local_alias: "maido",
		guarantee: [],
		gateways: [],
		gateway_type: "suscripcion",
		payment_type: "D",
		gateway_name: "culqi",
		local_name: "Maido",
		local_ubigeo: "Miraflores",
		local_address: "Ca. San Martín No. 399",
		local_phone: "5113135100",
		reservation_info: [],
		phone_codes: [],
		identity_number: "",
		invoicing_type: "B",
		ginterval: false,
		token: null,
		payment_method: 4,
		displayLangList: false,
		dynamicFields:[],
		dinamicIsValid:[],
		dynamic_inputs: [],
		dynamic_inputs_original: [],
		AgrupacionRedirect: "",
		showPoliticOptions: false,
		showWaitlistOptions: true,
		showAgeAccepted: false,
		schedulesWithWaitlist: 0,
		PoliticCommunication: 0,
		layoutStyle: 1,
		reservationFromDate: null,
		showMorePeople: true,
		showMoreHours: true,
		showNextDay: false,
		attrs: [{
            key: 'today',
            highlight: true,
            dates: new Date(),
        }],
        notification_hours: JSON.parse('[{"hour":"00:15"},{"hour":"00:30"},{"hour":"00:45"},{"hour":"01:00"},{"hour":"01:15"},{"hour":"01:30"},{"hour":"01:45"},{"hour":"02:00"},{"hour":"02:15"},{"hour":"02:30"},{"hour":"02:45"},{"hour":"03:00"},{"hour":"03:15"},{"hour":"03:30"},{"hour":"03:45"},{"hour":"04:00"},{"hour":"04:15"},{"hour":"04:30"},{"hour":"04:45"},{"hour":"05:00"},{"hour":"05:15"},{"hour":"05:30"},{"hour":"05:45"},{"hour":"06:00"},{"hour":"06:15"},{"hour":"06:30"},{"hour":"06:45"},{"hour":"07:00"},{"hour":"07:15"},{"hour":"07:30"},{"hour":"07:45"},{"hour":"08:00"},{"hour":"08:15"},{"hour":"08:30"},{"hour":"08:45"},{"hour":"09:00"},{"hour":"09:15"},{"hour":"09:30"},{"hour":"09:45"},{"hour":"10:00"},{"hour":"10:15"},{"hour":"10:30"},{"hour":"10:45"},{"hour":"11:00"},{"hour":"11:15"},{"hour":"11:30"},{"hour":"11:45"},{"hour":"12:00"},{"hour":"12:15"},{"hour":"12:30"},{"hour":"12:45"},{"hour":"13:00"},{"hour":"13:15"},{"hour":"13:30"},{"hour":"13:45"},{"hour":"14:00"},{"hour":"14:15"},{"hour":"14:30"},{"hour":"14:45"},{"hour":"15:00"},{"hour":"15:15"},{"hour":"15:30"},{"hour":"15:45"},{"hour":"16:00"},{"hour":"16:15"},{"hour":"16:30"},{"hour":"16:45"},{"hour":"17:00"},{"hour":"17:15"},{"hour":"17:30"},{"hour":"17:45"},{"hour":"18:00"},{"hour":"18:15"},{"hour":"18:30"},{"hour":"18:45"},{"hour":"19:00"},{"hour":"19:15"},{"hour":"19:30"},{"hour":"19:45"},{"hour":"20:00"},{"hour":"20:15"},{"hour":"20:30"}]'),
        notify: {
		    start: {
		        hour: null,
		        hour_text: null,
                key: null
            },
            end: {
		        hour: null,
		        hour_text: null,
                key: null,
            },
            message: {
		        show: false,
                type: '',
                content: ''
            }
        },
		timer: 300,
		timerString: '',
		reservation:{
			id: "",
			date: null,
			hour: null,
			pax: null,
			name: "",
			last_name: "",
			user_id: "",
			phone_number: null,
			cellphone_number: "",
			cellphone_prefix_number: "51",
			cellphone_only_number: "",
						consumption_type: null,
			email:  "",
			promotion_code: null,
			allergies: null,
			comment: null,
			reservation_type_id: null,
			reserve_for_another: 0,
			other_name: null,
			other_last_name: null,
			other_business: null,
			other_cellphone_number: null,
			other_email: null,
			device: null,
			language: "es",
			so: null,
			from: "widget",
			oversold_approval: "0",
			card_hash: null,
			zone_id: null,
			payment_card_calculate: null,
			by: "C",
			referred: null,
			full_edit: null,
			agree_custom_policy: true,
			agree_extra_custom_policy: true,
			agree_policy: true,
			agree_age: false,
			politic_communication:false,
			zone_name: null,
			consumption_type_name: null,
			type_consumption_id: null,
			so: '',
			device: '',
			card_hash: null,
			payment_card_calculate: null,
			payment_card_tip: null,
			schedule_id: null,
			document_type: "",
			document_number: "",
			bussiness_number: "",
			customer_name: "",
			customer_address: "",
			email_billing: "",
			person_document_type: null,
			dynamic_inputs:[],
			special_dishes:[],
			waitlist: null,
			payment_gateway:'culqi',
			hotel1: '',
			hotel2:'',
		},
		reservation_prev:{
			date: "",
			hour: "",
			pax: "",
            schedule_id: "",
            zone_id: "",
            zone_name: "",
            consumption_type: "",
            consumption_type_name: "",
		},
		card:{
			address: '',
			cvv:'',
			expiration_month:'',
			expiration_year:'',
			method:'',
			name:'',
			name_card:'',
			number:'',
			payer_id: '',
		},
		giftcardLocalCode: null,
		giftcardLocalLoading: false,
		giftcardLocalResultMessageType: '',
		giftcardLocalResultMessageText: '',
		widget:{
			header_logo:"https://img.mesa247.pe/archivos/w-logo-maido-1567438004.png",
			body_background:"https://img.mesa247.pe/archivos/w-bg-maido-cocina-nikkei-1678410550.jpeg",
			body_background_color:"rgba(0, 0, 0, 0.1)",
			color1:"rgb(190, 190, 190)",
			color2:"#ffffff",
			color3:"#D6D6D6",
			color4:"#000000",
			color5:"rgb(255, 255, 255)",
			color6:"rgb(255, 255, 255)",
			color7:"#B73844",
			color9:"rgba(0,0,0,0.3)",
			color_bar:"#000000",
			description:"",
			dynamicFields:[],
			start_order: "1",// 1: Pax, 2: Date, 3: Consumption type, 4: Zone
		},
		showSpecialPopup: false,
		hasDynamicInputsEmpty: false,
		dynamicInputsValidation: [],
		dateWithWaitlist: false,
		specialDishes: [],
		specialDishesSelected: [],
		specialDishesCalculated: [],
		specialDishesValidation: [],
		specialDishesCategoryMin: [],
		specialDishesCategoryMax: [],
		specialDishesCategorySelected: [],
		specialMixDishesCategorySelected: [],
		specialDishesMandatorySelected: 0,
		specialDishesNoMandatorySelected: 0,
		dishesValidationMandatory: true,
		dishesValidationNoMandatory: true,
		dishesValidationCategory: true,
		dishesValidationMixCategoryDishes: true,
		dishesCount: 0,
		showPriceDetails: false,
		specialDishesPopupMessage: '',
		reloadReturnPage: false,
		showBeforeTheMenu: false,
		completeTheMenuValidation: false,
		minNoMandatory: null,
		maxNoMandatory: null,
		minMandatory: null,
		maxMandatory: null,
		dishesValidationType: 1,
		fixedAmount: 0.00,
		dishesAmount: 0.00,
        dishesAmountFormato:'',
        tipAmountFormato:'',
        totalAmountFormato:'',
        totalAmount: 0.00,
        paymentCurrency:'S/',
        dishesValidation: true,
        mountNew:0,
        warrantyAmount:0.00,
        allergies_placeholder: '',
        comment_placeholder: '',
		errors:{
			reservation:{
				cellphone_prefix_number: false,
				cellphone_only_number: false,
				pax: false,
				date: false,
				hour: false,
				allergies: false,
				other_name: false,
				other_last_name: false,
				other_business: false,
				other_email: false,
				other_cellphone_number: false,
				agree_custom_policy: false,
				agree_extra_custom_policy: false,
				agree_policy: false,
				agree_age: false,
			},
			card:{
				name_card: false,
				document: false,
				document_type: false,
				number: false,
				address: false,
				expiration_month: false,
				expiration_year: false,
				cvv: false
			},
			giftcardLocalCode: false,
			dynamic_inputs: false,
      		deviceId: null,
		},
		widgetFooterDescription: ``,
		recommended_locals: [],
		customPolicyEnabled: true,
		extraCustomPolicyEnabled: false,
		showPopupWidget: false,
		showRecommendedLocals: false,
		showConfirmPopupReservation: true,
		hoursConfirmPopupReservation: 24,
		isInstagram: false,
		hasBeenPaid: false,
		culqiPaymentOptionsAvailable: null, 
		fallingBack: false,
		authenticated3DS: false,
		validCurrencyAbreviations: ['PEN','USD'],
		//here we'll save the culqi scripts so we don't load it many times (append the script tag to the document)
		CulqiScript: null,
		Culqi3DSScript: null,
		isYape: false,
		wompi_public_key: "pub_prod_9GhTZDRYDIcd9pK4xZsS1GAtcbXBQIXg",
		wompi_url: "prod" === 'dev' ? 'https://sandbox.wompi.co/v1' : 'https://production.wompi.co/v1',
		wompi_acceptance_token: null,
		wompi_accepted: false,
		oldSafariVersion: false,
		bridgeZonesEnabled: false,
		hasImageDishes: false,
		cartThemeEnabled: false,
		blockForeignPayments: false,
		detailDishPopup: {
			show: false,
			dish: null
		},
		stripe: {
			object: null,
			elements: null,
			cardNumberElement: null,
			cardExpiryElement: null,
			cardCvcElement: null,
			ready: false,
			initializing: false,
			error: false,
			errorMessage: '',
			loadingTimeout: null,
			clientSecret: null,
			scriptLoaded: false,
			lastSetupIntentId: null,
			setupIntentId: null,
			siStatus: null,
			changedAfterSuccess: false
		},
	},
	watch: {
		'card.number': function (newVal, oldVal){
			this.card.number = this.card.number.toString().toLowerCase()
							.replace(/[^\w\-]+/g, '') // Remove all non-word chars
							.replace(/[a-zA-Z]+/g, '') // only numbers
							.replace(/\-\-+/g, ' ')   // Replace multiple - with single -
							.replace(/^-+/, '')       // Trim - from start of text
							.replace(/-+$/, '');      // Trim - from end of text
			if(newVal != oldVal){
				this.errors.card.number = (this.card.number == "") ? true : false;
			}
		},
		'card.expiration_month': function (newVal, oldVal){
			this.card.expiration_month = this.card.expiration_month.toString().toLowerCase()
								.replace(/[^\w\-]+/g, '') // Remove all non-word chars
								.replace(/[a-zA-Z]/g, '') // only numbers
								.replace(/\-\-+/g, ' ')   // Replace multiple - with single -
								.replace(/^-+/, '')       // Trim - from start of text
								.replace(/-+$/, '');      // Trim - from end of text
			if(newVal != oldVal){
				this.errors.card.expiration_month = (this.card.expiration_month == "") ? true : false;
			}
		},
		'card.expiration_year': function (newVal, oldVal){
			this.card.expiration_year = this.card.expiration_year.toString().toLowerCase()
								.replace(/[^\w\-]+/g, '') // Remove all non-word chars
								.replace(/[a-zA-Z]/g, '') // only numbers
								.replace(/\-\-+/g, ' ')   // Replace multiple - with single -
								.replace(/^-+/, '')       // Trim - from start of text
								.replace(/-+$/, '');      // Trim - from end of text
			if(newVal != oldVal){
				this.errors.card.expiration_year = (this.card.expiration_year == "") ? true : false;
			}
		},
		'card.cvv': function (newVal, oldVal){
			this.card.cvv = this.card.cvv.toString().toLowerCase().
							replace(/[^\w\-]+/g, '')
							.replace(/[a-zA-Z]/g, '')
							.replace(/\-\-+/g, ' ')
							.replace(/^-+/, '')
							.replace(/-+$/, '');
			if(newVal != oldVal){
				this.errors.card.cvv = (this.card.cvv == "") ? true : false;
			}
		},
        'reservation.name': function (newVal, oldVal) {
			if(newVal != oldVal){
				this.validateForm();
			}
        },
        'reservation.last_name': function (newVal, oldVal) {
			if(newVal != oldVal){
				this.validateForm();
			}
        },
        'reservation.email': function (newVal, oldVal) {
			if(newVal != oldVal){
				this.validateForm();
			}
        },
        'reservation.cellphone_prefix_number': function (newVal, oldVal){
			var self = this;
			if(newVal != oldVal){
				self.checkFoerignPayment();

				self.reservation.cellphone_number = self.reservation.cellphone_prefix_number + " " +self.reservation.cellphone_only_number;
				this.validateForm();
			}
        },
        'reservation.cellphone_only_number': function(newVal, oldVal){
			var self = this;
			self.reservation.cellphone_only_number = self.reservation.cellphone_only_number.replace(/  +/g, ' ');
			if(newVal != oldVal){
				self.reservation.cellphone_number = self.reservation.cellphone_prefix_number + " " +self.reservation.cellphone_only_number;
				this.validateForm();
			}
        },
		'reservation.document_type': function (newVal, oldVal){
			if(newVal != oldVal){
				if(this.reservation.document_type == 2){
					this.reservation.person_document_type = 2;
				}else if(this.reservation.document_type == 1){
					this.reservation.person_document_type = 1;
				}
				this.validateForm();
			}
		},
		'bussiness_address': function (newVal, oldVal){
			this.card.address = this.bussiness_address;
			if(newVal != oldVal){
				this.errors.bussiness_address = (( this.invoicing_type == 'F' || this.country_code == 'CL' ) && this.bussiness_address == "") ? true : false;
				this.errorMessage = "";
			}
		},
		'gateway_name': function (newVal, oldVal) {
			if (oldVal === 'stripe' && newVal !== 'stripe') {
				this.cleanupStripeElements({ resetStripeObjects: true });
			}
		},
		'reservation.document_number': function (newVal, oldVal){
			if(newVal != oldVal){
				this.validateForm();
			}
		},
		'reservation.agree_custom_policy': function (newVal, oldVal){
			if(newVal != oldVal){
				this.validateForm();
			}
		},
		'reservation.agree_extra_custom_policy': function (newVal, oldVal){
			if(newVal != oldVal){
				this.validateForm();
			}
		},
		'reservation.agree_policy': function (newVal, oldVal){
			if(newVal != oldVal){
				this.validateForm();
			}
		},
		'reservation.agree_age': function (newVal, oldVal){
			if(newVal != oldVal){
				this.validateForm();
			}
		},
	},
	mounted: function(){
		var self = this;

		var interval = setInterval(function(){

			if (self.timer > 0) {

				self.timer -= 1;

				var time = self.timer;

				var minutes = Math.floor(time / 60);
				var seconds = time - minutes * 60;

				function str_pad_left(string,pad,length) {
					return (new Array(length+1).join(pad)+string).slice(-length);
				}

				let timerString = str_pad_left(minutes,'0',2)+':'+str_pad_left(seconds,'0',2);
				self.timerString = "Por tu seguridad, en  <b>" + timerString + " min </b>refrescaremos el formulario.";

			} else  {
				clearInterval(interval);
			}

		}, 1000)
	},
	computed: {
		getWidgetFooterDescription() {
			let description = this.widgetFooterDescription;

			if (this.reservation.consumption_type == 1832) {
				description = 'Si necesita ponerse en contacto con nosotros, escríbanos a reservas@milcentro.pe';
			}

			return description;
		},
    document_types() {
		let labelInvoice, labelBillOfSale;

		switch (this.country_code) {
			case 'EC':
			labelInvoice = 'Factura';
			labelBillOfSale = 'CI/Pasaporte (Consumidor final)';
			break;
			case 'CO':
			labelInvoice = 'Factura electrónica';
			labelBillOfSale = 'CI/Pasaporte (Cédula de ciudadanía)';
			break;
			case 'PE':
			default:
			labelInvoice = 'Factura';
			labelBillOfSale = 'DNI/Pasaporte (Boleta)';
		}


      const baseDocumentTypes = {
        0: 'Selecciona el tipo de comprobante de pago', 
        1: labelInvoice, 
        2: labelBillOfSale 
      };

      return baseDocumentTypes;
    },
    statement_mesa_name() {
      const kushkiText = 'MESA247 KSA';
      const izipayText = 'MESA247';
      const culqiText = 'Mesa247.pe';
      const wompiTExt = 'PASARELA COLOMBIA - WO MEDELLIN CO';
      
      switch(this.gateway_name) {
        case 'kushki':
          return kushkiText;
        case 'izipay':
          return izipayText;
        case 'culqi':
          return culqiText;
        case 'wompi':
          return wompiTExt;
        default:
          return culqiText;
      }
    },
	},
	async created(){
		this.oldSafariVersion = this.isOldSafari();
		this.initInstagramAlert();
		this.loading = false;
		var self = this;

				console.log('url referred: ' + document.referrer);
		if (!!document.referrer) {
			console.log('url referred agregado');
			self.reservation.referred = document.referrer;
			setCookie('referrer_url', document.referrer, 1);
		}
		
		
		self.initPeople();
		self.getPhoneCodes();

		if(typeof Culqi !== "undefined"){
			Culqi.publicKey = "pk_live_8a7da28b078c829b"
	        Culqi.init();
			//in order to async inizialization to not be broken
			this.CulqiScript = Culqi;
		}

				
		
		if([93, 103, 1569, 1401, 2625].includes(self.local_id)) {
        	self.showAgeAccepted = true;
        }
		
		if(self.local_id == 2361 || self.local_id == 93 || self.local_id == 11){
			self.bridgeZonesEnabled = true;
		}
		if (self.local_id == 2370) {
			self.cartThemeEnabled = true;
		}

		if (self.local_id == 2390 || self.local_id == 2445 || self.local_id == 2455 || self.local_id == 2465) {
			self.autoSelectFirstConsumptionType = false;
		}
		
		self.allergies_placeholder = `Haremos todo lo posible por adaptar los platos a su restricción alimenticia. Sin embargo, le informamos que, a pesar de nuestro mayor esfuerzo, no podemos garantizarle un ambiente 100% libre de alérgenos (como crustáceos, mariscos, frutos secos, gluten, huevos, leche, maní, moluscos, pescados, sésamo, soya, sulfitos, trigo, entre otros), debido al riesgo de posible contaminación cruzada.`;
		self.comment_placeholder = `Aunque no podemos garantizar que podamos cubrir todas sus necesidades, haremos todo lo posible por asistirle y ofrecerle el mejor servicio posible.`;

    	if(self.local_id == 1057){
			self.special_popup_message = "Le recordamos que la reserva se está generando fuera de nuestro periodo de política de cancelación, lo cual no aplica a una devolución por cambio o cancelación. Agradecemos no deje de contactar a nuestro equipo de reservas por si surgiera algún evento no previsible.<br>Correo: reservas@milcentro.pe<br>Telf: +51 970 645 908<br>Muchas gracias!";
		}
		
		if (self.local_id == 2179 || self.local_id == 2246 || self.local_id == 2262) {
			self.reservation.agree_custom_policy = false;
		}

        // start by consumption type - zone
        if(self.widget.start_order == "3"){
        	// Order Zones - Consumption types
        	if(self.optionsOrder == 0){
        		if(self.useZones == 1){
        			self.zones = [];
        			await self.getPaxDataInfo("zones");
                    if(self.zones != null && self.zones.length > 0 && self.zones.length == 1){
                        self.selectManualZone = false;
                        await self.selectZone(self.zones[0].id);
                        self.step = 3;
						self.moveToStep(3);
                    }
        		}
        	}else{
        		if(self.useConsumptionTypes == 1){
        			self.consumption_types = [];
        			await self.getPaxDataInfo("type_consumptions");
	            	if(self.autoSelectFirstConsumptionType && self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1){
                        self.selectManualConsumptionType = false;
                        // after 3 seconds
                        setTimeout(() => {
                        	self.selectConsumptionTypeInfo(self.consumption_types[0].id);
                        }, 1500);
                    }

					        		}
        	}
        	self.step = 1;

			self.getRecommendedReservationLocals();
        }
        // start by PAX
        if(self.widget.start_order == "1"){
        	self.step = 3;
        	self.firstStep = 3;
        	self.moveToStep(2);

        	self.loadingPeople = true;
        	await self.getPaxDataInfo("available_paxs");
					//self.initPeople();
        	self.loadingPeople = false;
			
			self.getRecommendedReservationLocals();
        }
        // start by Date
        if(self.widget.start_order == "2"){
			self.loadingDate = true;
			self.loadingMessage = "";
			self.reservation.date = null;
			self.no_quotes_availables = false;
			self.no_schedules_availables = false;
			self.available_dates = [{ start: new Date(2000,1,1), end: new Date(2000,1,1)}];
			self.attrs =  [{ dates: new Date(2000,1,1),bar: true}];
			self.step = 4;
			self.firstStep = 4;
			self.moveToStep(3);
			self.getAvailableDates();
			self.loadingDate = false;
			self.getRecommendedReservationLocals();
        }

		let lastReservation = getCookie('last_reservation');

		if (!!lastReservation) {
			lastReservationObject = JSON.parse(lastReservation);
			self.reservation.name = lastReservationObject.name;
			self.reservation.last_name = lastReservationObject.last_name;
			self.reservation.email = lastReservationObject.email;
			self.reservation.cellphone_only_number = lastReservationObject.cellphone_only_number;
			self.reservation.email_billing = lastReservationObject.email;
		}

		
		self.checkFoerignPayment();

		self.$nextTick(function () {
			
			if (self.showPopupWidget) {
				$('#specialPopup').modal('show');
			}
		});
	},
  beforeUpdate(){
    if(this.step !== 4) return;
    if(this.language === 'es'){
    $('.vc-weekday').each(function(idx, ele) {
          var text = $(ele).html();
          switch(text){
            case 'L':
              $(ele).html("Lun");
              break;
            case 'M':
              $(ele).html("Mar");
              break;
            case 'X':
              $(ele).html("Mie");
              break;
            case 'J':
              $(ele).html("Jue");
              break;
            case 'V':
              $(ele).html("Vie");
              break;
            case 'S':
              $(ele).html("Sáb");
              break;
            case 'D':
              $(ele).html("Dom");
              break;
          }
      });
    }
  },
	methods: {
		getTabState(tab){
			var self = this;
			var className = "";
			if(self.step > tab){
				className = 'done';
			}else if(self.step == tab){
				className = 'current';
			}else{
				className ='inactive';
			}
			if(self.widget.start_order == "3"){
				className +=' width-16';
			}else if(self.useZones == 1 && self.useConsumptionTypes == 1){
				className +=' width-20';
			}else{
				className +=' width-25';
			}
			/*if(self.reservation.consumption_type_name != null || self.reservation.zone_name != null){
				className += " has-extra-options";
			}*/
			return className;
		},
		goToPreviousStep(){
			var self = this;
			if(self.step == 7 && self.widget.start_order == '1'){
				self.selectStep(5);
			}else if(self.step == 9){
				self.selectStep(7);
			}else{
				self.selectStep(self.step-1);
			}
		},
		getTabLabel(tab){
			var self = this;
			var label = "";
			switch(tab){
				case 1:
					// Order Zone - Consumption type
					if(self.optionsOrder == 0){
						label =  "";
						if(self.reservation.zone_name != null){
							label = self.reservation.zone_name;
						}
						if(label == ""){
							label =  "Zona";
						}
						label = '<span class="title"><i class="icon-service-terraza"></i><span class="extra-label">'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-off '+ (self.step > 1 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 1 ? 'active' : '' )+ '"></span>';
					}else{
						label =  "";
						if(self.reservation.consumption_type_name != null){
							label = self.reservation.consumption_type_name;
						}
						if(label == ""){
							label = `Zona y Tipo de consumo`;
						}
						label = '<span class="title"><i class="icon-list"></i><span class="extra-label">'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-off '+ (self.step > 1 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 1 ? 'active' : '' )+ '"></span>';
					}
					break;
				case 2:
					// Order Zone - Consumption type
					if(self.optionsOrder == 0){
						label =  "";
						if(self.reservation.consumption_type_name != null){
							label = self.reservation.consumption_type_name;
						}
						if(label == ""){
							label = `Zona y Tipo de consumo`;
						}
						label = '<span class="title"><i class="icon-list"></i><span class="extra-label">'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 2 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 2 ? 'active' : '' )+ '"></span>';
					}else{
						label =  "";
						if(self.reservation.zone_name != null){
							label = self.reservation.zone_name;
						}
						if(label == ""){
							label =  "Zona";
						}
						label = '<span class="title"><i class="icon-service-terraza"></i><span class="extra-label">'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 2 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 2 ? 'active' : '' )+ '"></span>';
					}
					break;
				case 3:
					label = self.reservation.pax != null ?  (self.reservation.pax > 1 ? self.reservation.pax + ` Personas` : self.reservation.pax + ` Persona` ) : `Personas`;
					label = '<span class="title"><i class="icon-avatar"></i><span>' + label +'</span></span><span class="indicator"></span><span class="indicator-line ' + ( self.widget.start_order == '3'? 'line-on ':'line-off ')+ (self.step > 3 ? 'active' : '' ) +'"></span><span class="indicator-line line-on '+ (self.step > 3 ? 'active' : '' )+ '"></span>';
					break;
				case 4:
					label = self.selectedDate != null ? self.selectedDate : `Fecha`;
					label = '<span class="title"><i class="icon-calendar"></i><span>' + label + '</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 3 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 4 ? 'active' : '' )+ '"></span>';
					break;
				case 5:
					label = self.selectedHour != null ?  self.selectedHour : `Hora`;
					extra_label = '';
					if(self.reservation.waitlist != null ){
						extra_label =  extra_label + '<div class="has-waitlist">' + 'Lista de espera' + '</div>';
					}
					label = '<span class="title"><i class="icon-clock"></i><span>' + label +'</span><span class="extra-options-in-line">' + extra_label + '</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 4 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 5 ? 'active' : '' )+ '"></span>';
					break;
				case 6:
					label = self.reservation.pax != null ?  (self.reservation.pax > 1 ? self.reservation.pax + ` Personas` : self.reservation.pax + ` Persona` ) : `Personas`;
					label = '<span class="title"><i class="icon-avatar"></i><span>' + label +'</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 5 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 6 ? 'active' : '' )+ '"></span>';
					break;
				case 7:
					label =  "";
					if(self.reservation.zone_name != null){
						label = self.reservation.zone_name;
					}
					if(self.reservation.consumption_type_name != null){
						label =  label == "" ? self.reservation.consumption_type_name : (label + " - " +self.reservation.consumption_type_name);
					}
					if(label == "" || self.local_id == 2488){
						label = `Zona y Tipo de consumo`;
					}

					label = '<span class="title"><i class="icon-list"></i><span class="extra-label">'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 6 ? 'active' : '' )+ '"></span><span class="indicator-line line-on '+ (self.step > 7 ? 'active' : '' )+ '"></span>';
					break;
				case 9:
					label =  `Tus datos`;
					label = '<span class="title"><i class="icon-comment-alt"></i><span>'+ label +'</span></span><span class="indicator"></span><span class="indicator-line line-on '+ (self.step > 7 ? 'active' : '' )+ '"></span><span class="indicator-line line-off"></span>';
					break;
			}
			return label;
		},
		showUserMenu(){
			this.show_user_menu = !this.show_user_menu;
		},
		initPeople() {
			var self = this;
						if (self.min_pax > 1) {
				self.people = [...Array(self.max_pax - (self.min_pax > 1 ? (self.min_pax - 1) : 0)).keys()].map(i => (i + self.min_pax));
				self.morePeople();
			} else {
				self.people = [...Array(self.max_pax).keys()].map(i => (i + 1));
			}
						
			self.loadingPeople = false;
		},
        morePeople() {
	        this.showMorePeople = !this.showMorePeople;
        },
        moreHours() {
            this.showMoreHours = !this.showMoreHours;
        },
        syncTime(key, hour, param) {
            this.notify[param].hour = hour;
            this.notify[param].hour_text = tConvert(hour);
            this.notify[param].key = key;
        },
        initNotifyHours() {
            var self = this;
            const defaultTime = '17:00';
            for (let i = 0; i < self.notification_hours.length; i++) {
                if (self.notification_hours[i].hour === defaultTime) {
                    self.notify.start.hour = defaultTime;
                    self.notify.start.hour_text = tConvert(defaultTime);
                    self.notify.start.key = i;
                    self.notify.end.hour = defaultTime;
                    self.notify.end.hour_text = tConvert(defaultTime);
                    self.notify.end.key = i;
                }
            }
        },
        openNotify() {
            var self = this;
            self.resetNotifyFields();
            $("#notifyModal").modal('show');
        },
		openDetailDish(dish) {
			var self = this;
			self.detailDishPopup.show = true;
			self.detailDishPopup.dish = dish;
		},
		closeDetailDish() {
			var self = this;
			self.detailDishPopup.show = false;
			
			setTimeout(() => {
				self.detailDishPopup.dish = null;
            }, 500);
		},
        resetNotifyFields() {
		    var self = this;
            self.initNotifyHours();
		    self.notify.message.show = false;
		    self.notify.message.type = '';
		    self.notify.message.content = '';
        },
		checkHotelFields() {
			var self = this;
			let displayHotelFields = self.reservation.cellphone_prefix_number != self.prefix_phone && self.reservation.cellphone_prefix_number !='';

			/*Force not to show for Ciccolina, LIMO peruano nikkei, MAP Café, 
			INKAGRILL, PACHAPAPA cocina cusqueña, KION peruvian chinese, Las Manos cocina*/
			const excludeLocalIds = [2346, 27, 28, 54, 55, 175, 2363];

            if (excludeLocalIds.includes(self.local_id)) {
                displayHotelFields = false;
            }

			return displayHotelFields;
		},
        async moveToStep(step){
        	// go to last tab
        	var self = this;

			if (self.step == 9) {
				self.loadingData = true;
				await self.getReservationTypes();
				await self.getDynamicFields();
				self.validateDynamicInputs();
				self.loadingData = false;
			}

        	if(self.widget.start_order == 3){
        		var tabPositions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        		//var tabPositions = [0, 0, 343, 687, 1030, 1374, 0, 0, 0, 1757, 1757];
        		//var tabPositionsMobile = [0, 0, 223, 447, 670, 894, 0, 0, 0, 1117, 1117];
        		var tabPositionsMobile = [0, 0, 0, 163, 327, 490, 654, 0, 0, 0, 1117];
        	}else{
        		// consumo (oculto) - zona (oculto) - pax - fecha - hora - pax (oculto) - consumo - zona - datos
        		var tabPositions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        		//var tabPositions = [0, 0, 0, 343, 400, 635, 0, 900, 900, 1250, 1250];
        		var tabPositionsMobile = [0, 0, 0, 0, 0, 163, 327, 327, 490, 654, 817];
        	}

        	if(window.innerWidth <= 576){
        		var posX = tabPositionsMobile[step];
        	}else{
        		var posX = tabPositions[step];
        	}

        	document.getElementById('section-navbar-ul').scrollLeft = posX;
			document.getElementById("page-header").scrollIntoView({behavior: "instant", block: "start"});

			//START Mostrar popup privado
			self.$nextTick(function () {
				const reservationDate = self.reservation.date;
				const specificDate = '2025-11-01';

				if (self.step == 9 && (self.reservation.zone_id == 4831 || self.reservation.zone_id == 5049)) {
					
					if (self.language !== 'en') {

						if (reservationDate >= specificDate) {
							self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Política de Reserva, Modificación y Cancelación del Salón Privado (2025)</div>

								Gracias por considerar nuestro salón privado para su experiencia gastronómica. Para procurar el mejor servicio, le pedimos leer cuidadosamente las siguientes políticas:

								<b>1. Condiciones Generales</b>
								- Capacidad mínima: 6 personas.
								- Capacidad máxima: 10 personas.
								- En caso de que su grupo sea reducido a 5 personas o menos, la reserva podrá ser reubicada al salón principal sin previo aviso.
								- Todos los precios están en Soles (PEN) e incluyen impuesto y servicio.
								- Los precios están sujetos a cambio sin previo aviso.
								- No ofrecemos: servicio de descorche ni menús adaptados a dietas celíacas, gluten free, vegetarianas, veganas o con alergias a pescados y mariscos.
								- Nuestra cocina está diseñada para disfrutarse al momento, por ello no brindamos comida para llevar.
								- El salón privado se encuentra en el tercer piso, accesible únicamente por escaleras desde el segundo piso (el ascensor llega hasta el segundo nivel).
								
								<b>2. Reservas para Grupos de Hasta 6 Personas</b>
								Para confirmar su reserva, se requiere el pago anticipado según la opción elegida:
								- Servicio a la carta: consumo mínimo de S/. 3,000 por grupo (hasta 6 personas).
								- Experiencias Maido:
								* Sin maridaje: S/. 1,295 por persona
								* Con maridaje Maido: S/. 1,985 por persona
								* Con maridaje Tokujō: S/. 2,525 por persona
								* Con maridaje sin alcohol: S/. 1,659 por persona
								- Experiencia Privado (mínimo 6 personas): S/. 849 por persona (no incluye bebidas).
								
								<b>3. Reservas para Grupos de 7 a 10 Personas</b>
								Para confirmar su reserva, se requiere el pago anticipado según la opción elegida:
								- Experiencias Maido:
								* Sin maridaje: S/. 1,295 por persona
								* Con maridaje Maido: S/. 1,985 por persona
								* Con maridaje Tokujō: S/. 2,525 por persona
								* Con maridaje sin alcohol: S/. 1,659 por persona
								- Experiencia Privado (mínimo 6 personas): S/. 849 por persona (no incluye bebidas)
								
								Importante: Para grupos de 7 a 10 personas no está disponible el servicio a la carta.
								
								<b>4. Cambios y Cancelaciones</b>
								- Una vez confirmada, su reserva puede modificarse o cancelarse con al menos 7 días de anticipación.
								- Si la modificación o cancelación se realiza con menos de 7 días de anticipación, el monto pagado se considerará como penalidad.
								- Si el número de personas cambia de 6 a más, se aplicarán automáticamente las condiciones para grupos de 7 a 10 personas.
								
								<b>5. Puntualidad y Penalidades</b>
								- Su mesa se mantiene por un máximo de 10 minutos de tolerancia.
								- Pasado ese tiempo sin completar el grupo, la reserva será cancelada automáticamente sin derecho a reembolso.
								- Si el consumo realizado no alcanza el monto pagado por anticipado, la diferencia no será reembolsada y se considerará como penalidad.
								
								<b>6. Reembolsos</b>
								- Si cancela su reserva con más de 7 días de anticipación, el reembolso puede demorar hasta 30 días hábiles, según la política de su banco.
								
								<b>7. Consumos Adicionales</b>
								- Todo consumo adicional al previamente pagado deberá ser abonado directamente en el restaurante al finalizar la experiencia.
							`;
						} else {
							self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Política de Reserva, Modificación y Cancelación del Salón Privado (2025)</div>

								Gracias por considerar nuestro salón privado para su experiencia gastronómica. Para procurar el mejor servicio, le pedimos leer cuidadosamente las siguientes políticas:

								<b>1. Condiciones Generales</b>
								- Capacidad mínima: 6 personas.
								- Capacidad máxima: 10 personas.
								- En caso de que su grupo sea reducido a 5 personas o menos, la reserva podrá ser reubicada al salón principal sin previo aviso.
								- Todos los precios están en Soles (PEN) e incluyen impuesto y servicio.
								- Los precios están sujetos a cambio sin previo aviso.
								- No ofrecemos: servicio de descorche ni menús adaptados a dietas celíacas, gluten free, vegetarianas, veganas o con alergias a pescados y mariscos.
								- Nuestra cocina está diseñada para disfrutarse al momento, por ello no brindamos comida para llevar.
								- El salón privado se encuentra en el tercer piso, accesible únicamente por escaleras desde el segundo piso (el ascensor llega hasta el segundo nivel).
								
								<b>2. Reservas para Grupos de Hasta 6 Personas</b>
								Para confirmar su reserva, se requiere el pago anticipado según la opción elegida:
								- Servicio a la carta: consumo mínimo de S/. 3,000 por grupo (hasta 6 personas).
								- Experiencias Maido:
								* Sin maridaje: S/. 1,190 por persona
								* Con maridaje Maido: S/. 1,880 por persona
								* Con maridaje Tokujō: S/. 2,420 por persona
								* Con maridaje sin alcohol: S/. 1,554 por persona
								- Experiencia Privado (mínimo 6 personas): S/. 849 por persona (no incluye bebidas)
								
								<b>3. Reservas para Grupos de 7 a 10 Personas</b>
								Para confirmar su reserva, se requiere el pago anticipado según la opción elegida:
								- Experiencias Maido:
								* Sin maridaje: S/. 1,190 por persona
								* Con maridaje Maido: S/. 1,880 por persona
								* Con maridaje Tokujō: S/. 2,420 por persona
								* Con maridaje sin alcohol: S/. 1,554 por persona
								- Experiencia Privado (mínimo 6 personas): S/. 849 por persona (no incluye bebidas)
								
								Importante: Para grupos de 7 a 10 personas no está disponible el servicio a la carta.
								
								<b>4. Cambios y Cancelaciones</b>
								- Una vez confirmada, su reserva puede modificarse o cancelarse con al menos 7 días de anticipación.
								- Si la modificación o cancelación se realiza con menos de 7 días de anticipación, el monto pagado se considerará como penalidad.
								- Si el número de personas cambia de 6 a más, se aplicarán automáticamente las condiciones para grupos de 7 a 10 personas.
								
								<b>5. Puntualidad y Penalidades</b>
								- Su mesa se mantiene por un máximo de 10 minutos de tolerancia.
								- Pasado ese tiempo sin completar el grupo, la reserva será cancelada automáticamente sin derecho a reembolso.
								- Si el consumo realizado no alcanza el monto pagado por anticipado, la diferencia no será reembolsada y se considerará como penalidad.
								
								<b>6. Reembolsos</b>
								- Si cancela su reserva con más de 7 días de anticipación, el reembolso puede demorar hasta 30 días hábiles, según la política de su banco.
								
								<b>7. Consumos Adicionales</b>
								- Todo consumo adicional al previamente pagado deberá ser abonado directamente en el restaurante al finalizar la experiencia.
							`;
						}
						
					} else {

						if (reservationDate >= specificDate) {
							self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Dining Room Reservation, Modification, and Cancellation Policy (2025)</div>

								Thank you for considering our private dining room for your culinary experience. To ensure the best possible service, we kindly ask that you read the following policies carefully:

								<b>1. General Conditions</b>
								- Minimum capacity: 6 guests.
								- Maximum capacity: 10 guests.
								- If your group is reduced to 5 guests or fewer, the reservation may be relocated to the main dining area without prior notice.
								- All prices are in Peruvian Soles (PEN) and include tax and service charges.
								- Prices are subject to change without prior notice.
								- We do not offer: corkage service, menus adapted for celiac, glutenfree, vegetarian, vegan diets, or allergies to fish and seafood.
								- Our cuisine is designed to be enjoyed in the moment; therefore, we do not offer takeout service.
								- The private dining room is located on the third floor, accessible only by stairs from the second floor (the elevator goes up to the second floor only).
								
								<b>2. Reservations for Groups of Up to 6 Guests</b>
								To confirm your reservation, advance payment is required based on your chosen option:
								- À la carte service: Minimum consumption of S/. 3,000 per group (up to 6 people).
								- Maido Experiences:
								* Without pairing: S/. 1,295 per person
								* With Maido pairing: S/. 1,985 per person
								* With Tokujō pairing: S/. 2,525 per person
								* With non-alcoholic pairing: S/. 1,659 per person
								- Private Experience (minimum 6 guests): S/. 849 per person (beverages not included)
								
								<b>3. Reservations for Groups of 7 to 10 Guests</b>
								To confirm your reservation, advance payment is required based on your chosen option:
								- Maido Experiences:
								* Without pairing: S/. 1,295 per person
								* With Maido pairing: S/. 1,985 per person
								* With Tokujō pairing: S/. 2,525 per person
								* With non-alcoholic pairing: S/. 1,659 per person
								- Private Experience (minimum 6 guests): S/. 849 per person (beverages not included)
								
								Important: À la carte service is not available for groups of 7 to 10 guests.
								
								<b>4. Changes and Cancellations</b>
								- Once confirmed, reservations may be modified or cancelled at least 7 days in advance.
								- If the modification or cancellation is made less than 7 days in advance, the amount paid will be considered a penalty.
								- If the group size increases from 6 to more, the conditions for groups of 7 to 10 guests will automatically apply.
								
								<b>5. Punctuality and Penalties</b>
								- Your table will be held for a maximum tolerance of 10 minutes.
								- After that time, if the group is not complete, the reservation will be automatically cancelled without refund.
								- If actual consumption does not reach the prepaid amount, the difference will not be refunded and will be considered a penalty.
								
								<b>6. Refunds</b>
								- If you cancel your reservation more than 7 days in advance, the refund may take up to 30 business days, depending on your bank’s policies.
								
								<b>7. Additional Consumption</b>
								- Any additional consumption beyond the prepaid amount must be paid directly at the restaurant at the end of the experience.
							`;
						} else {
							self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Dining Room Reservation, Modification, and Cancellation Policy (2025)</div>

								Thank you for considering our private dining room for your culinary experience. To ensure the best possible service, we kindly ask that you read the following policies carefully:

								<b>1. General Conditions</b>
								- Minimum capacity: 6 guests.
								- Maximum capacity: 10 guests.
								- If your group is reduced to 5 guests or fewer, the reservation may be relocated to the main dining area without prior notice.
								- All prices are in Peruvian Soles (PEN) and include tax and service charges.
								- Prices are subject to change without prior notice.
								- We do not offer: corkage service, menus adapted for celiac, glutenfree, vegetarian, vegan diets, or allergies to fish and seafood.
								- Our cuisine is designed to be enjoyed in the moment; therefore, we do not offer takeout service.
								- The private dining room is located on the third floor, accessible only by stairs from the second floor (the elevator goes up to the second floor only).
								
								<b>2. Reservations for Groups of Up to 6 Guests</b>
								To confirm your reservation, advance payment is required based on your chosen option:
								- À la carte service: Minimum consumption of S/. 3,000 per group (up to 6 people).
								- Maido Experiences:
								* Without pairing: S/. 1,190 per person
								* With Maido pairing: S/. 1,880 per person
								* With Tokujō pairing: S/. 2,420 per person
								* With non-alcoholic pairing: S/. 1,554 per person
								- Private Experience (minimum 6 guests): S/. 849 per person (beverages not included)
								
								<b>3. Reservations for Groups of 7 to 10 Guests</b>
								To confirm your reservation, advance payment is required based on your chosen option:
								- Maido Experiences:
								* Without pairing: S/. 1,190 per person
								* With Maido pairing: S/. 1,880 per person
								* With Tokujō pairing: S/. 2,420 per person
								* With non-alcoholic pairing: S/. 1,554 per person
								- Private Experience (minimum 6 guests): S/. 849 per person (beverages not included)
								
								Important: À la carte service is not available for groups of 7 to 10 guests.
								
								<b>4. Changes and Cancellations</b>
								- Once confirmed, reservations may be modified or cancelled at least 7 days in advance.
								- If the modification or cancellation is made less than 7 days in advance, the amount paid will be considered a penalty.
								- If the group size increases from 6 to more, the conditions for groups of 7 to 10 guests will automatically apply.
								
								<b>5. Punctuality and Penalties</b>
								- Your table will be held for a maximum tolerance of 10 minutes.
								- After that time, if the group is not complete, the reservation will be automatically cancelled without refund.
								- If actual consumption does not reach the prepaid amount, the difference will not be refunded and will be considered a penalty.
								
								<b>6. Refunds</b>
								- If you cancel your reservation more than 7 days in advance, the refund may take up to 30 business days, depending on your bank’s policies.
								
								<b>7. Additional Consumption</b>
								- Any additional consumption beyond the prepaid amount must be paid directly at the restaurant at the end of the experience.
							`;
						}
						
					}
					
					$('#specialDishesPopup').modal({backdrop: 'static', keyboard: false}, 'show');
				} else if (self.step == 9 && (self.reservation.consumption_type == 2014 || self.reservation.consumption_type == 2014)) {
					
					if (self.language !== 'en') {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #04312c; font-family: 'Manrope-SemiBold'">POLÍTICA DE RESERVA, MODIFICACIÓN Y/O CANCELACIÓN</div>

						El tiempo de tolerancia es de 10 minutos, tiempo en el que se deberá completar la mesa. En caso de no presentarse dentro del tiempo de tolerancia, su reserva quedará automáticamente cancelada.

						A fin de garantizar su reserva, esta requiere de un cobro anticipado como sigue:
						-Experiencia Mayta (no incluye bebidas): S/. 845 Soles por persona.

						Precios en Soles incluido impuesto y servicio; precios sujetos a cambio sin previo aviso.
						Confirmada la reserva únicamente podrá ser modificada o cancelada sin cobro, con mínimo siete (07) días de anticipación, caso contrario, se aplicarán los cobros detallados.

						No se brinda servicio de descorche.
						Todo consumo extra deberá ser pagado en el restaurante.


						`;
					} else {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #04312c; font-family: 'Manrope-SemiBold'">RESERVATION, MODIFICATION AND/OR CANCELLATION POLICY</div>
						
						The tolerance time is 10 minutes, in which time the table must be completed. In case of no-show within the tolerance time, your reservation will be automatically cancelled.

						In order to guarantee your reservation, a prepayment is required as follows:
						-Mayta Experience (drinks not included): S/. 845 Soles per person.

						Prices in Soles including tax and service; prices subject to change without previous notice.
						Once the reservation is confirmed, it can only be modified or cancelled without charge, with a minimum of seven (07) days of anticipation, otherwise, the detailed charges will be applied.
						
						
						`;
					}
					
					$('#specialDishesPopup').modal({backdrop: 'static', keyboard: false}, 'show');
				} else if (self.step == 9 && (self.reservation.consumption_type == 2048 || self.reservation.consumption_type == 2049 || self.reservation.consumption_type == 2050 || self.reservation.consumption_type == 2051)) {
					
					if (self.language !== 'en') {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #04312c; font-family: 'Manrope-SemiBold'">ATENCIÓN</div>
						Sobre la hora programada de su reserva. Ofreceremos un tiempo de tolerancia de 15 minutos. Ante cualquier cambio o modificación, le solicitamos comunicarse con al menos 24 horas de anticipación al (51)242-8515 o a reservas@centralrestaurante.com.pe
						`;
					} else {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #04312c; font-family: 'Manrope-SemiBold'">ATENCIÓN</div>
						Sobre la hora programada de su reserva. Ofreceremos un tiempo de tolerancia de 15 minutos. Ante cualquier cambio o modificación, le solicitamos comunicarse con al menos 24 horas de anticipación al (51)242-8515 o a reservas@centralrestaurante.com.pe
						`;
					}
					
					$('#specialDishesPopup').modal({backdrop: 'static', keyboard: false}, 'show');
				}
			});
			//END Mostrar popup privado
        },
		selectStep(step){
			console.log("step: "+step);
			var self = this;
			if(typeof Culqi !== "undefined"){
				Culqi.token = undefined;
			}
			clearInterval(this.ginterval);
			if(self.reservation.id != "" && self.reservation.id > 0){
				step = self.firstStep;
				//self.cleanFields();
			}
			self.moveToStep(step);
			switch(step){
				case 1:
					//self.reservation.id = null;
					self.reservation.pax = null;
					self.reservation.date = null;
					self.selectedDate = null;
					self.reservation.hour = null;
					self.selectedHour = null;
					self.reservation.zone_id = null;
					self.reservation.zone_name = null;
					self.reservation.consumption_type = null;
					self.reservation.consumption_type_name = null;
					self.reservation.waitlist = null;
					self.reservation.from = "widget";
					self.schedulesWithWaitlist = 0;
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
				break;
				case 2:
					//self.reservation.id = null;
					self.reservation.pax = null;
					self.reservation.date = null;
					self.selectedDate = null;
					self.reservation.hour = null;
					self.selectedHour = null;
					// Order Zones - Consumption types
					if(self.optionsOrder == 0){
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}else{
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
					}
					self.reservation.waitlist = null;
					self.reservation.from = "widget";
					self.schedulesWithWaitlist = 0;
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
				break;
				case 3:
					//self.reservation.id = null;
					self.reservation.pax = null;
					self.reservation.date = null;
					self.selectedDate = null;
					self.reservation.hour = null;
					self.selectedHour = null;
					// if first step is not consumption type - zone
					if(self.widget.start_order != "3"){
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}
					console.log('entre aquí...');
					console.log(self.widget.start_order);
					self.reservation.waitlist = null;
					self.reservation.from = "widget";
					self.schedulesWithWaitlist = 0;
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
					break;
				case 4:
					self.reservation.date = null;
					self.selectedDate = null;
					self.reservation.hour = null;
					self.selectedHour = null;
					// if first step is not consumption type - zone
					if(self.widget.start_order != "3"){
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}
					self.reservation.waitlist = null;
					self.reservation.from = "widget";
					self.schedulesWithWaitlist = 0;
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					// if first step is not Pax
					if(self.widget.start_order == "2"){
						self.reservation.pax = null;
					}
					self.dishesAmountFormato = "";
					break;
				case 5:
					self.reservation.hour = null;
					self.selectedHour = null;
					// if first step is not consumption type - zone
					if(self.widget.start_order != "3"){
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}
					self.reservation.waitlist = null;
					self.reservation.from = "widget";
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
					break;
				case 6:
					// if first step is not consumption type - zone
					if(self.widget.start_order != "3"){
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
					break;
				case 7:
					// if first step is not consumption type - zone
					if(self.widget.start_order != "3"){
						self.reservation.zone_id = null;
						self.reservation.zone_name = null;
						self.reservation.consumption_type = null;
						self.reservation.consumption_type_name = null;
					}
					self.reservation.cellphone_only_number = "";
					self.reservation.reservation_type_id = null;
					self.reservation.comment = null;
					self.reservation.allergies = "";
					self.dishesAmountFormato = "";
					break;
			}

			if (step <= 5) {
				self.getRecommendedReservationLocals();
			}

			self.step = step;
		},
		closeSpecialPopup(){
			var self = this;
			self.showSpecialPopup = false;
		},
		culqi(){
			if (Culqi.token) {
				clearInterval(this.ginterval);
				this.token = Culqi.token;
				this.loading = true;
				this.saveCard();
			}else{
				if(Culqi.error){
					this.loading = false;
					this.errorMessage = Culqi.error.user_message;
					clearInterval(this.ginterval);
					this.processingReservation = false;
	            	console.log("doReservation - end -" + this.processingReservation);
				}
			}
		},
		hideLangList() {
			this.displayLangList = false;
		},
		async changeLang(language) {
			var self = this;
      		self.loadingMessage = "Cargando";
      		window.axios.defaults.baseURL = '/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			var rs = await axios.get("/reservas/" + self.local_alias + "/language/" + language ,{
			  params: params
			}).then(function (response) {
				self.loading = false;
				location.reload();
			}).catch(function (error) {
                self.loading = false;
				console.log(error);
			});
			this.hideLangList();
		},
		changeLanguage(term) {
			window.location.href = 'https://maido.mesa247.pe/reservas/maido?language=' + term;
		},
		validateDynamicInputs(){
			this.errors.dynamic_inputs = false;
			this.dynamic_inputs = this.dynamic_inputs_original;

			if (!!this.dynamicInputsToValidate && this.dynamicInputsToValidate.length > 0) {
				this.dynamicInputsToValidate.map((ele,idx, index)=>{
					if(this.dynamicFields[ele.Id]=='' || typeof this.dynamicFields[ele.Id] == "undefined"){
						this.dynamicInputsValidation[ele.Id] = true;
						this.errors.dynamic_inputs = true;
					}else{
						this.dynamicInputsValidation[ele.Id] = false;
					}
				});
			}

			//Start Hack campos dinámicos (oculta los campos)
			if (!!this.reservation.consumption_type &&
				(this.reservation.consumption_type == 1555 ||
				this.reservation.consumption_type == 851 ||
				this.reservation.consumption_type == 1700 ||
				this.reservation.consumption_type == 1716 ||
				this.reservation.consumption_type == 1705 ||
				this.reservation.consumption_type == 987 ||
				this.reservation.consumption_type == 1074 ||
				this.reservation.consumption_type == 1008 ||
				this.reservation.consumption_type == 1075 ||
				this.reservation.consumption_type == 1555 ||
				this.reservation.consumption_type == 884 ||
				this.reservation.consumption_type == 2099 ||
				this.reservation.consumption_type == 2100 ||
				this.reservation.consumption_type == 2101 ||

				this.reservation.consumption_type == 2492 ||
				this.reservation.consumption_type == 2494 ||
				this.reservation.consumption_type == 2496 ||
				this.reservation.consumption_type == 2497 ||
				this.reservation.consumption_type == 2498 ||
				this.reservation.consumption_type == 2499 ||
				this.reservation.consumption_type == 2500 ||
				this.reservation.consumption_type == 2102 ||
				this.reservation.consumption_type == 2104 ||
				this.reservation.consumption_type == 2739 ||
				this.reservation.consumption_type == 2748 ||

				this.reservation.consumption_type == 3169 ||
				this.reservation.consumption_type == 3170

				)) {
				let newDynamicFields = [];
				this.dynamic_inputs.map((ele,idx, index)=>{
					let dynamicInputIdsHidden = (ele.Id == 446 || ele.Id == 447 || ele.Id == 488 || ele.Id == 482 || ele.Id == 446 || ele.Id == 481 || ele.Id == 516 || ele.Id == 517 || ele.Id == 430  || ele.Id == 722);
					
					if ( this.reservation.consumption_type == 1008 || this.reservation.consumption_type == 1074) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489);
					}

					if (this.reservation.consumption_type == 987 || this.reservation.consumption_type == 1075) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 490);
					}

					if (this.reservation.consumption_type == 2099) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 722);
					}
					
					if (this.reservation.consumption_type == 2100) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 722);
					}

					if (this.reservation.consumption_type == 2101) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 722);
					}
					if (this.reservation.consumption_type == 2492) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 490);
					}
					if (this.reservation.consumption_type == 2494) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 490);
					}
					if (this.reservation.consumption_type == 2496) {
						dynamicInputIdsHidden = (ele.Id == 430 || ele.Id == 489 || ele.Id == 490);
					}

					if (this.reservation.consumption_type == 2497) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 858);
					}
					if (this.reservation.consumption_type == 2498) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}
					if (this.reservation.consumption_type == 2499) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}

					if (this.reservation.consumption_type == 3169) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}
					if (this.reservation.consumption_type == 3170) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}

					if (this.reservation.consumption_type == 2500) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 858);
					}
					
					if (this.reservation.consumption_type == 2739) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}
					if (this.reservation.consumption_type == 2748) {
						dynamicInputIdsHidden = (ele.Id == 349 || ele.Id == 723);
					}


					if (this.reservation.consumption_type == 2102) {
						dynamicInputIdsHidden = (ele.Id == 723);
					}
					if (this.reservation.consumption_type == 2104) {
						dynamicInputIdsHidden = (ele.Id == 723);
					}







					if (this.reservation.consumption_type == 1716) {
						dynamicInputIdsHidden = (ele.Id == 494);
					}

					if (this.reservation.consumption_type == 884) {
						dynamicInputIdsHidden = (ele.Id == 349);
					}

					if((this.dynamicFields[ele.Id]=='' || typeof this.dynamicFields[ele.Id] == "undefined") && dynamicInputIdsHidden == true){
						this.dynamicInputsValidation[ele.Id] = false;
						this.errors.dynamic_inputs = false;
					} else {
						newDynamicFields.push(ele);
					}
				});

				this.dynamic_inputs = newDynamicFields;
			}
			//End Hack campos dinámicos
		},
		checkFoerignPayment() {
			let self = this;

			if ([2433,2295,2105].includes(self.local_id)) { // Pedir tarjeta solo a extranjeros
				self.blockForeignPayments = !(self.reservation.cellphone_prefix_number != self.prefix_phone && self.reservation.cellphone_prefix_number !='');
			}

		},
		validateForm(){

			this.errors.card.name = false;
			this.errors.card.number = false;
			this.errors.card.expiration_month = false;
			this.errors.card.expiration_year = false;
			this.errors.card.cvv = false;

			const isEmpty = v => v == null || String(v).trim() === '';

			if (!this.blockForeignPayments && this.hasPayment) {
				const isKushki = this.gateway_name == 'kushki';
				const hasNameValidation = ['kushki','wompi'].includes(this.gateway_name);

				if (this.gateway_name == 'stripe') {
					const stripe = this.stripe;

					if (stripe && stripe.cardNumberElement && stripe.cardExpiryElement && stripe.cardCvcElement) {
						if (!stripe.cardNumberElement._complete) {
							this.errors.card.number = true;
						}

						if (!stripe.cardExpiryElement._complete) {
							this.errors.card.expiration_month = true;
							this.errors.card.expiration_year = true;
						}

						if (!stripe.cardCvcElement._complete) {
							this.errors.card.cvv = true;
						}
					} else {
						this.errors.card.number = true;
						this.errors.card.expiration_month = true;
						this.errors.card.expiration_year = true;
						this.errors.card.cvv = true;
						
						this.highlightStripeError();
					}
				} else {
					this.errors.card.name = hasNameValidation && !!isEmpty(this.card.name);
					this.errors.card.number = !!isEmpty(this.card.number);
					this.errors.card.expiration_month = !!isEmpty(this.card.expiration_month);
					this.errors.card.expiration_year = !!isEmpty(this.card.expiration_year);
					this.errors.card.cvv = !!isEmpty(this.card.cvv) || (isKushki && this.card.cvv.length < 3);	
				}

				//if kushki then we'll validate that the date is in the future
				if (isKushki){
					const now = new Date();
					const cardDate = new Date(this.card.expiration_year, this.card.expiration_month);
					const isInTheFuture = cardDate > now;

					if (!isInTheFuture){
						this.errors.card.expiration_month = true;
						this.errors.card.expiration_year = true;
					}
				}
			}

			this.errors.reservation.cellphone_prefix_number = (this.reservation.cellphone_prefix_number == "" || this.reservation.cellphone_prefix_number == null) ? true : false;
			this.errors.reservation.cellphone_only_number = (this.reservation.cellphone_only_number == "" || this.reservation.cellphone_only_number == null || this.reservation.cellphone_only_number.length < 7) ? true : false;
			/*this.errors.reservation.email = (this.reservation.email == "") ? true : false;*/
			this.errors.reservation.email = (this.reservation.email === "" || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.reservation.email)) ? true : false;
			this.errors.reservation.name = (this.reservation.name == "") ? true : false;
			this.errors.reservation.last_name = (this.reservation.last_name == "") ? true : false;

			this.errors.document_type = false;
			this.errors.document_number = false;
			//this.errors.customer_address = false;
			this.errors.customer_name = false;
			this.errors.email_billing = false;

			if (this.requiredPaymentDocuments && !this.blockForeignPayments) {
				this.errors.document_type = ( (this.reservation.document_type == 0 || this.reservation.document_type == "") && this.hasInvoicing) ? true : false;
				this.errors.document_number = ((this.reservation.document_type == '2' || this.reservation.document_type == '1') && (this.reservation.document_number == "" || this.reservation.document_number.length < 4)) ? true : false;
				//this.errors.customer_address = (( this.reservation.document_type == '1' || this.country_code == 'CL' ) && this.reservation.customer_address == "") ? true : false;
				this.errors.customer_name = (this.reservation.document_type == '1' && this.reservation.customer_name == "" && this.hasInvoicing) ? true : false;
				this.errors.email_billing = (this.reservation.document_type == '1' && (this.reservation.email_billing == "" || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.reservation.email_billing)) && this.hasInvoicing) ? true : false;
			}

			if (this.customPolicyEnabled) {
				this.errors.reservation.agree_custom_policy = (this.reservation.agree_custom_policy) ? false : true;
			}
			
			if (this.extraCustomPolicyEnabled) {
				this.errors.reservation.agree_extra_custom_policy = (this.reservation.agree_extra_custom_policy) ? false : true;
			}

			this.errors.reservation.agree_policy = (this.reservation.agree_policy) ? false : true;

			if (this.showAgeAccepted) {
				this.errors.reservation.agree_age = (this.reservation.agree_age) ? false : true;
			}

			this.validateDynamicInputs();
			
			return (
        		this.errors.card.name ||
				this.errors.card.number ||
				this.errors.card.expiration_month ||
				this.errors.card.expiration_year ||
				this.errors.card.cvv ||
				this.errors.reservation.cellphone_prefix_number ||
				this.errors.reservation.email ||
				this.errors.reservation.name ||
				this.errors.reservation.last_name ||
				this.errors.reservation.cellphone_only_number ||
				this.errors.document_type  ||
				this.errors.identity_number ||
				this.errors.document_number ||
				this.errors.customer_address ||
				this.errors.customer_name ||
				this.errors.email_billing ||
				this.errors.reservation.agree_custom_policy ||
				this.errors.reservation.agree_extra_custom_policy ||
				this.errors.reservation.agree_policy ||
				this.errors.reservation.agree_age ||
				this.errors.dynamic_inputs ||
				this.errors.payment_method) ? false : true;
		},
		async saveCard() {
			let self = this;
			self.loading = true;

			window.axios.defaults.baseURL = "https://homerestaurantesprod.mesa247.cloud/v1/";
			window.axios.defaults.params = {};
			window.axios.defaults.headers.common = { 'Authorization': "Bearer " + self.access_token };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const creditCardData = ['kushki', 'wompi'].includes(self.gateway_name)
				? { token: self.token }
				: (self.gateway_name === 'stripe'
					? {
						payment_method_id: self.token,
						setup_intent_id: self.stripe?.lastSetupIntentId || undefined,
						}
					: self.token);

			try {
				const payload = {
					credit_card_data: JSON.stringify(creditCardData),
					default: "1",
					hidden: "1",
					country_code: self.country_code,
					payment_type: self.gateway_type,
					name: self.reservation.name,
					last_name: self.reservation.last_name,
					phone: self.reservation.cellphone_only_number,
					phone_code: self.reservation.cellphone_prefix_number,
					email: self.reservation.email,
					...(
						['kushki','culqi3ds','wompi','stripe'].includes(self.gateway_name) || self.fallingBack
						? { payment_gateway: self.gateway_name }
						: {}
					),
					...(self.gateway_name === 'culqi3ds' ? { deviceId: self.deviceId } : {}),
					...(self.authenticated3DS ? { parameters3DS: self.parameters3DS } : {}),
				};

				const response = await axios.post('users/credit_cards', payload);

				if (self.gateway_name === 'culqi3ds') {
					
					if (response?.data?.success === false &&
						response?.data?.data?.message === "Card needs to be authenticated") {
						self.culqi3dsAuthentication();
						
						return;
					}
				}

				self.reservation.card_hash = response.data.data.credit_card.hash;
				self.continueReservation();

			} catch (error) {
				self.errorMessage = error?.response?.data?.message || 'No se pudo guardar la tarjeta. Inténtalo de nuevo.';
				self.loading = false;
				self.processingReservation = false;
				console.log("doReservation - end -" + self.processingReservation);

				if (self.gateway_name !== 'stripe' && self.shouldFallback()) {
					self.fallback();
				}
			}
		},
		async selectPeopleNumber(person) {
			var self = this;
			if(self.reservation.pax != person){
				self.reservation.pax = person;
				self.reservation.date = null;
				self.no_quotes_availables = false;
				self.no_schedules_availables = false;
				self.available_dates = [{ start: new Date(2000,1,1), end: new Date(2000,1,1)}];
				self.attrs =  [{ dates: new Date(2000,1,1),bar: true}];
				self.step = 4;
				self.schedulesWithWaitlist = 0;

									self.showWaitlistOptions = true;
				
				if ([3780, 3700, 3758].includes(self.reservation.consumption_type)) {
					self.showWaitlistOptions = false;
					self.schedulesWithWaitlist = 1;
				}

				self.moveToStep(4);
				await self.getAvailableDates();
				self.loadingDate = false;

				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}
			}
		},
		async selectPeopleNumberAlt(person) {
			var self = this;
			console.log("selectPeopleNumberAlt");
			if(self.reservation.pax != person){
				self.reservation.pax = person;
				self.step = 7;
				self.moveToStep(7);
				if(self.useZones == 0 && self.useConsumptionTypes == 0 && self.widget.start_order == "2"){
        			self.step = 9;
        			self.validateDynamicInputs();
        		}else{
	                // show first zones
	                if(self.optionsOrder == 0){
	                    if(self.useZones == 1){
	                        self.consumption_types = [];
	                        await self.getPaxData("zones");
	                        if(self.zones != null && self.zones.length > 0 && self.zones.length == 1){
	                            self.selectManualZone = false;
	                            await self.selectZone(self.zones[0].id);
	                        }
							if(self.reservation_prev.zone_id != null && self.reservation_prev.zone_id !=""){
								self.selectManualZone = true;
								self.reservation.zone_id = self.reservation_prev.zone_id;
								await self.selectZone(self.reservation_prev.zone_id);
							}
	                    }
	                }else{
	                    if(self.useConsumptionTypes == 1){
	                        self.zones = [];
	                        await self.getPaxData("consumption_types");
	                        if(self.autoSelectFirstConsumptionType && self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1){
	                            self.selectManualConsumptionType = false;
	                            self.step = 7;
	                            self.moveToStep(7);
	                            await self.selectConsumptionType(self.consumption_types[0].id);
	                        }
							if(self.reservation_prev.consumption_type != null && self.reservation_prev.consumption_type !=""){
								self.selectManualConsumptionType = true;
								self.reservation.consumption_type = self.reservation_prev.consumption_type;
								self.step = 7;
								self.moveToStep(7);
								await self.selectConsumptionType(self.reservation_prev.consumption_type);
							}
	                    }
	                }
        		}
				
				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}

                await self.getPaxData2();
                await self.getGuarantee();
			}
		},
		async loadAvailableDates(type){
			var self = this;
			self.reservation.date = null;
			self.no_quotes_availables = false;
			self.no_schedules_availables = false;
			self.available_dates = [{ start: new Date(2000,1,1), end: new Date(2000,1,1)}];
			self.attrs =  [{ dates: new Date(2000,1,1),bar: true}];
			// schedules without waitlist
			if(type == 1){
				self.schedulesWithWaitlist = 1;
			}else{
				// schedules with waitlist
				self.schedulesWithWaitlist = 0;
			}
			await self.getAvailableDates();
			self.loadingDate = false;
		},
		async getAvailableDates(){
			var self = this;
			self.loadingDate = true;
			self.hours = [];
			self.loadingMessage = "Cargando fechas disponibles...";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			self.reservationFromDate = null;
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			params.append('type_reservation', "widget");
			params.append('start_date', self.start_date);
			params.append('end_date', self.end_date);
			if(self.reservation.pax > 0){
				params.append('paxs', self.reservation.pax);
			}
			if(self.reservation.id > 0){
				params.append('reservation_id',self.reservation.id);
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}

			params.append('from', 'gateway');

			
			let baseRoute = "search";

			if (self.fastCalendarEnabled == 1 && self.schedulesWithWaitlist == 0) {
				baseRoute = 'fastcalendar';
			}

			var rs = await axios.get(baseRoute,{
				params: params
			}).then(function (response) {
				let collectionDates = response.data.locals[0].dates;
				let available_dates = [];
				let attrs = [];
				let flag = 1;
				for (let elementDate of collectionDates) {
					const rawDate = elementDate.date.split('-');
					const year = parseInt(rawDate[0]);
					const month = parseInt(rawDate[1]) - 1;
					const day = parseInt(rawDate[2]);

					const date = {
							start: new Date(year, month, day),
							end: new Date(year, month, day)
					};

					const attr = {
							bar: true,
							dates: new Date(year, month, day),
					};
					if(self.schedulesWithWaitlist == 1){
						if(elementDate.available == '1' || elementDate.waitlist == "1"){
							available_dates.push(date);
							attrs.push(attr);

	                        if (flag) {
	                            self.reservationFromDate = date.start;
	                            flag = 0;
	                        }
						}
					}else{
						if (elementDate.available == '1') {
							available_dates.push(date);
							attrs.push(attr);

	                        if (flag) {
	                            self.reservationFromDate = date.start;
	                            flag = 0;
	                        }

						}
					}
				}
				if(available_dates.length == 0){
					self.no_quotes_availables = true;
				}
				if(available_dates.length > 0){
					self.available_dates = available_dates;
					self.attrs = attrs;
				}else{
					self.available_dates = [{ start: new Date(2000,1,1), end: new Date(2000,1,1)}];
					self.attrs =  [{ dates: new Date(2000,1,1),bar: true}];
				}
				self.dates = response.data.locals[0].dates;

				if (self.language === 'es') {
					self.formatCalendar();
				}
			}).catch(function (error) {
				self.loading = false;
			});
		},
		formatCalendar(){
			$('.vc-weekday').each(function(idx, ele) {
			    var text = $(ele).html();
			    switch(text){
			    	case 'L':
			    		$(ele).html("Lun");
			    		break;
			    	case 'M':
			    		$(ele).html("Mar");
			    		break;
			    	case 'X':
			    		$(ele).html("Mie");
			    		break;
			    	case 'J':
			    		$(ele).html("Jue");
			    		break;
			    	case 'V':
			    		$(ele).html("Vie");
			    		break;
			    	case 'S':
			    		$(ele).html("Sáb");
			    		break;
			    	case 'D':
			    		$(ele).html("Dom");
			    		break;
			    }
			});
		},
        async setDate(day) {
			//so that they won't be pressing dates several times
			this.loadingDate = true;
			var self = this;
			let dateAvailable = false;
			let dates = self.dates;
			self.dateWithWaitlist = false;

			dates.map((elem,idx)=>{
				// set hour width when day has waitlist
				if(day.id == elem.date  && parseInt(elem.waitlist) == 1){
					self.dateWithWaitlist = true;
				}
				if(self.schedulesWithWaitlist == 1){
					if(day.id == elem.date && (parseInt(elem.available) == 1 || parseInt(elem.waitlist) == 1)){
						dateAvailable = true;
					}
				}else{
					if(day.id == elem.date && parseInt(elem.available) == 1){
						dateAvailable = true;
					}
				}
			});

			if(dateAvailable){
				self.loadingHour = true;
				self.reservation.hour = null;
				self.no_quotes_availables = false;
				self.no_schedules_availables = false;
				self.hours = [];
				self.reservation.date = day.id;
				const dateFormat = (self.language === 'es') ? 'dddd, D [de] MMMM' : 'dddd, MMMM Do';
				self.selectedDate =  moment(self.reservation.date).format(dateFormat);
				
				if(self.language === 'es'){
					self.selectedDate = self.selectedDate.split(' ').map((word, index) => {
					if (index === 2) {
						return word;
					}
					return word.charAt(0).toUpperCase() + word.slice(1);
					}).join(' ');
				}

				var date1 = moment();
				var date2 = moment(self.reservation.date);
				var dateDiff = date2.diff(date1, 'days');

				if(self.local_id == 1057 && dateDiff <= 30){
					self.showSpecialPopup = true;
				}

				if(self.local_id == 402 || self.local_id == 2663){
					self.showNextDay = true;
				}

				await self.getSchedules();
				if(self.showNextDay){
					await self.getSchedulesNextDay();
				}

				self.step = 5;
				self.moveToStep(5);

				self.getRecommendedReservationLocals();
			}

			this.loadingDate = false;
        },
        async getSchedules(){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			params.append('type_reservation', "widget");
			params.append('date', self.reservation.date);
			if(self.reservation.pax > 0){
				params.append('paxs', self.reservation.pax);
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}
			params.append('response', "hours,unavailable_hours,available_paxs");
			if(self.reservation.id > 0){
				params.append('reservation_id',self.reservation.id);
			}

			params.append('from', 'gateway');

						
			var rs = await axios.get("search",{
			  params: params
			}).then(function (response) {
                let dataHours = response.data.locals[0].hours;

				if((self.local_id == 2179 || self.local_id == 2246) &&
				!!self.reservation.date && dataHours.length > 0) {
					let nowDate = moment(new Date()).format('YYYY-MM-DD');
					let reservationDate = moment(self.reservation.date).format('YYYY-MM-DD');

					if (nowDate == reservationDate) {
						dataHours = dataHours.filter((availableHour) => availableHour.available == 1);
					}
				}

                self.dateWithWaitlist = false;
				
	        	dataHours.map((elem,idx)=>{
        			if(parseInt(elem.waitlist) == 1){
        				self.dateWithWaitlist = true;
        			}
				});

                if(dataHours.length == 0){
                    self.no_schedules_availables = true;
                }

				self.hours = dataHours;
				self.loading = false;
				self.loadingHour = false;
			}).catch(function (error) {
				console.log(error);
				self.loading = false;
			});
		},
		async getSchedulesNextDay(){
			var self = this;
			
			// Verificar que tengamos la fecha antes de continuar
			if (!self.reservation || !self.reservation.date) {
				console.log('getSchedulesNextDay: No hay fecha disponible');
				return;
			}
			
			try {
				self.loading = false;
				self.loadingHour = false;
				
				window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
				window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
				window.axios.defaults.headers.common['Content-Type'] = 'application/json';
				window.axios.defaults.headers.common['Accept'] = 'application/json';
				
				const params = new URLSearchParams();
				params.append('language', self.language);
				params.append('country_code', self.country_code);
				params.append('local_id', self.local_id);
				params.append('type_reservation', "widget");
				
				// Llamar al servicio con la fecha del día siguiente
				let nextDayDate = moment(self.reservation.date).add(1, 'day').format('YYYY-MM-DD');
				console.log('getSchedulesNextDay: Fecha original:', self.reservation.date, 'Fecha siguiente:', nextDayDate);
				
				params.append('date', nextDayDate);
				
				if(self.reservation.pax > 0){
					params.append('paxs', self.reservation.pax);
				}
				if(self.reservation.consumption_type){
					params.append('type_consumption_id', self.reservation.consumption_type);
				}
				if(self.reservation.zone_id){
					params.append('zone_id', self.reservation.zone_id);
				}
				params.append('response', "hours,unavailable_hours,available_paxs");
				if(self.reservation.id > 0){
					params.append('reservation_id',self.reservation.id);
				}

				params.append('from', 'gateway');

								
				console.log('getSchedulesNextDay: Haciendo llamada a API con params:', params.toString());
				
				var rs = await axios.get("search",{
				  params: params
				});
				
				console.log('getSchedulesNextDay: Respuesta recibida:', rs.data);
				
				if (rs.data && rs.data.locals && rs.data.locals[0] && rs.data.locals[0].hours) {
					let dataHours = rs.data.locals[0].hours;
					console.log('getSchedulesNextDay: Horarios encontrados:', dataHours.length);

					if((self.local_id == 2179 || self.local_id == 2246) &&
					!!nextDayDate && dataHours.length > 0) {
						let nowDate = moment(new Date()).format('YYYY-MM-DD');
						let reservationDate = moment(nextDayDate).format('YYYY-MM-DD');

						if (nowDate == reservationDate) {
							dataHours = dataHours.filter((availableHour) => availableHour.available == 1);
						}
					}

					// Marcar los horarios del día siguiente para identificarlos
					dataHours.forEach(hour => {
						hour.isNextDay = true;
						hour.nextDayDate = nextDayDate;
					});

					// COMBINAR los horarios del día siguiente con los existentes
					if (self.hours && self.hours.length > 0) {
						console.log('getSchedulesNextDay: Combinando horarios. Antes:', self.hours.length, 'Nuevos:', dataHours.length);
						self.hours = [...self.hours, ...dataHours];
						console.log('getSchedulesNextDay: Total después de combinar:', self.hours.length);
					} else {
						self.hours = dataHours;
						console.log('getSchedulesNextDay: Estableciendo horarios del día siguiente como únicos');
					}

					// Actualizar el estado de waitlist si es necesario
					if (dataHours.some(hour => parseInt(hour.waitlist) == 1)) {
						self.dateWithWaitlist = true;
					}

					// Actualizar el estado de no hay horarios disponibles
					if (self.hours.length == 0) {
						self.no_schedules_availables = true;
					}
				} else {
					console.log('getSchedulesNextDay: No se encontraron horarios en la respuesta');
				}
				
			} catch (error) {
				console.error('getSchedulesNextDay: Error completo:', error);
				console.error('getSchedulesNextDay: Mensaje de error:', error.message);
				if (error.response) {
					console.error('getSchedulesNextDay: Respuesta de error:', error.response.data);
				}
			} finally {
				self.loading = false;
				self.loadingHour = false;
			}
		},
		async getReservationTypes(){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v1/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('local_id', self.local_id);
			var rs = await axios.get("reservation_types",{
				params: params
			}).then(function (response) {
				self.reservation_types = response.data.data.types;
				//self.loading = false;
			}).catch(function (error) {
				console.log(error);
				self.loading = false;
			});
		},
		async validGiftcardLocalCode() {
			let self = this;

			self.giftcardLocalLoading = true;
			self.giftcardLocalResultMessageType = '';
			self.giftcardLocalResultMessageText = '';

			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v3/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);

			var rs = await axios.get(`locals/${self.local_id}/valid-giftcard/${self.giftcardLocalCode}`,{
				params: params
			}).then(function (response) {
				self.giftcardLocalResultMessageType = response.data.success ? 'alert-success' : 'alert-danger';
				self.giftcardLocalResultMessageText = response.data.message;
				self.giftcardLocalLoading = false;
			}).catch(function (error) {
				console.log(error);
				self.giftcardLocalResultMessageType = 'alert-danger';
				self.giftcardLocalResultMessageText = error.response.data.message;
				self.giftcardLocalLoading = false;
			});
		},
		async getRecommendedReservationLocals() {
			var self = this;
			
			if (!self.showRecommendedLocals) {
				return false;
			}
			
			self.recommended_locals = [];
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v3/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('consumption_type_id', !!self.reservation.consumption_type ? self.reservation.consumption_type : '');
			params.append('pax', !!self.reservation.pax ? self.reservation.pax : '');
			params.append('date', !!self.reservation.date ? self.reservation.date : '');
			params.append('hour', !!self.reservation.hour ? self.reservation.hour : '');

			var rs = await axios.get(`restaurants/${self.local_id}/recommended-reservation-locals`,{
				params: params
			}).then(function (response) {
				self.recommended_locals = response.data.data;
				//self.loading = false;
			}).catch(function (error) {
				console.log(error);
				self.loading = false;
			});
		},
		async getDynamicFields(){
			var self = this;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v1/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('consumption_type', self.reservation.consumption_type);
			params.append('pax', self.reservation.pax);
			params.append('date', self.reservation.date);
			params.append('hour', self.reservation.hour);

			
			var rs = await axios.get("/locals/" + self.local_id +"/get_dynamic_inputs",{
				params: params
			}).then(function (response) {
				let dynamic_inputs = response.data.data.dynamic_inputs;
				let new_dynamic_inputs = [];
				self.dynamicInputsValidation = [];
				let dynamicInputsToValidate = [];
				dynamic_inputs.map((elem,idx)=>{
					if(elem.Externo == "1"){
						new_dynamic_inputs.push(elem);
					}
				});
				self.dynamic_inputs = new_dynamic_inputs;
				self.dynamic_inputs_original = new_dynamic_inputs;
				self.dynamic_inputs.map((elem,idx)=>{
					if(elem.Obligatorio == '1'){
						dynamicInputsToValidate.push(elem);
						self.dynamicInputsValidation[elem.Id] = true;
					}else{
						self.dynamicInputsValidation[elem.Id] = false;
					}
				});
				self.dynamicInputsToValidate = dynamicInputsToValidate;
			}).catch(function (error) {
				console.log(error);
				self.loading = false;
			});
		},
		async goToLastStep(){
			var self = this;
			var dynamicFieldsLength = document.querySelectorAll('#dynamic-fields .input-error').length;
			
			if(dynamicFieldsLength == 0){
				//Mostrar Platos estilo Maido | Forzar que traiga platos por local
				if(self.payment_type == 'T' || self.local_id == 11 ||self.local_id == 14 || self.local_id == 2179 || self.local_id == 2335 || self.local_id == 2246 || self.local_id == 2337 || self.local_id == 2488 || self.local_id == 2465 || self.local_id == 2478 || self.local_id == 2517 || self.local_id == 2550){
					await self.getSpecialDishes();

			        // platos del tipo de consumo del local
	                let specialDishes = self.special_dishes;
					self.hasImageDishes = false;
					let dishesCount = 0;

					specialDishes.map((elem,idx)=>{
						// each category
						self.specialDishesCategorySelected[elem.id] = 0;

						if (elem.type == 3) {
							self.specialMixDishesCategorySelected[elem.id] = 0
						}

						self.specialDishesCategoryMin[elem.id] = elem.min;
						self.specialDishesCategoryMax[elem.id] = elem.max;
						// loop dishes
						elem.dishes.map((ele, indx)=>{
							// each dish
							self.paymentCurrency = ele.currency;
							// when price is fixed
							if(ele.fixed_payment_type == '1'){
								self.specialDishes[ele.id] =  1;
								self.specialDishesCalculated[ele.id] =  ele.currency+'&nbsp;'+parseFloat(ele.price).toFixed(2);
							} else {
								// when price is result of quantity
								self.specialDishes[ele.id] =  0;
								self.specialDishesCalculated[ele.id] =  ele.currency+'&nbsp;0.00';
							}

							if (ele.price > 0) {
								
							}

							if (self.local_id == 2370 && !!ele.photo_url) {
								self.hasImageDishes = true;
							}

							dishesCount++;
						})
					});

					self.dishesCount = dishesCount;

					if (self.showBeforeTheMenu && self.dishesCount == 0 && self.local_id != 2179) {
						self.showBeforeTheMenu = false;
					}

					// call dishes validation
					self.validateQuantity();
					self.resetValidationInputDishes();
					self.showSpecialDishes = self.dishesCount > 0;

					//Start Accordion platos especiales
					this.$nextTick(function () {
						$('.accordion-category').on('click', function () {
							let element = $(this);
							element.toggleClass('active');
							let panel = element.parent().find('.dish');

							if (panel.css('max-height') == 'none') {
								panel.css('max-height', 0);
								element.find('.title-icon').html('(Ver más)');
							} else {
								panel.css('max-height', 'none');
								element.find('.title-icon').html('(Ver menos)');
							}
						});
					});
					//End Accordion platos especiales
				}
				self.step = 10;
				self.moveToStep(10);

				self.$nextTick(function () {
					
					if (self.showConfirmPopupReservation && !!self.reservation.date && !!self.reservation.hour) {
						let now = moment(new Date());
						let reservationDate = moment(self.reservation.date + ' ' + self.reservation.hour);
						let diffHours = reservationDate.diff(now, 'hours');
						
						if (diffHours < self.hoursConfirmPopupReservation && self.reservation.waitlist == null) {
							$('#confirmPopup').modal('show');
						}
					}

				});
			}else{
				document.getElementById("help-us-customize").scrollIntoView({behavior: "smooth", block: "start"});
			}
		},
		resetValidationInputDishes() {
			var self = this;
			
			self.dishesValidationMandatory = true;
			self.dishesValidationNoMandatory = true;
			self.dishesValidationCategory = true;
			self.dishesValidationMixCategoryDishes = true;
		},
		checkCoverZones() {
			var self = this;

			let coverZones = self.zones.filter((elementZone) => !!elementZone.photo);

			return coverZones.length > 0;
		},
		checkDetailZones() {
			var self = this;

			let detailZones = self.zones.filter((elementZone) => !!elementZone.detail);

			return detailZones.length > 0;
		},
		checkAvailableHours() {
			var self = this;

			//let availableHours = self.hours.filter((availableHour) => (availableHour.available == 1 && availableHour.waitlist == 0) || (availableHour.available == 0 && availableHour.waitlist == 1));
			let availableHours = self.hours.filter((availableHour) => availableHour.available == 1 || availableHour.waitlist == 1);

			return availableHours.length > 0;
		},
		validateQuantity(){
			var self = this;
			// dishes in form
 			let platosEspeciales = self.specialDishes;
 			self.dishesAmount = 0.00;
 			// platos especiales del tipo de consumo del local
			let platos = self.special_dishes;
			self.specialDishesMandatorySelected = 0;
			self.specialDishesNoMandatorySelected = 0;

			let dishesCategories = self.specialDishesCategorySelected;
			dishesCategories.map((elem,idx)=>{
				self.specialDishesCategorySelected[idx] = 0;
			});

			let mixDishesCategories = self.specialMixDishesCategorySelected;
			mixDishesCategories.map((elem,idx)=>{
				self.specialMixDishesCategorySelected[idx] = 0;
			});

			//Reiniciar platos escogidos
			self.specialDishesSelected = [];

 			platosEspeciales.map((elem,idx)=>{

 				let quantity = self.specialDishes[idx];
 				quantity = isNaN(quantity) ? 0 : parseInt(quantity);

 				let price = 0.00;

 				platos.map((eleItem,indc)=>{

 					let category_id = eleItem.id;

 					eleItem.dishes.map((el,ind)=>{
						// match between dish in form vs dish of local
						if(el.id  == idx){
							price = el.price;

							if( parseInt(quantity) >  0){
								self.specialDishesCategorySelected[category_id] += parseInt(quantity);
								
								if (eleItem.type == 3) {
									self.specialMixDishesCategorySelected[category_id] += parseInt(quantity);
								}
							}

							if(el.mandatory == '1'){
								self.specialDishesMandatorySelected += quantity;
							}else{
								self.specialDishesNoMandatorySelected += quantity;
							}
						}
					});
 				});

                self.specialDishesCalculated[idx] = self.paymentCurrency + parseFloat(quantity * price * 1.00).toFixed(2);
				
                self.dishesAmount += quantity * price * 1.00;
 			});

			//START HACK: Fixed minimum amount for the special cases
			let fixedMinimumAmount = 0;

			if (self.reservation.consumption_type == 3322 || self.reservation.consumption_type == 3305) {
				fixedMinimumAmount = 1360.00; // Alqa pachamanca amount 340*4
			}

			if (self.dishesAmount >= 0 && self.dishesAmount < fixedMinimumAmount) {
				self.dishesAmount = fixedMinimumAmount;
			}
			//END HACK: Fixed minimum amount for the special cases

			// dishes amount
			self.dishesAmount = self.fixedAmount * 1.00 + self.dishesAmount;
            self.dishesAmount = self.dishesAmount * 1.00;

            self.dishesAmountFormato = self.paymentCurrency + parseFloat(self.dishesAmount).toFixed(2);
            //tip amount
            self.tipAmount = (self.mountNew * 1.00 *(self.warrantyAmount * 1.00 + self.dishesAmount) / 100);
            self.tipAmountFormato = self.paymentCurrency + ' ' + parseFloat(self.tipAmount).toFixed(2);
            self.payment_tip = self.tipAmount;
            // total amount
            self.totalAmount = self.warrantyAmount * 1.00 + self.tipAmount * 1.00 + self.dishesAmount * 1.00;
            self.totalAmountFormato = self.paymentCurrency + ' ' + parseFloat(self.totalAmount).toFixed(2);

            self.reservation.payment_card_calculate = self.totalAmount;
            self.reservation.payment_card_tip = self.payment_tip;

            // platos obligatorios
			self.minMandatory = self.reservation.pax;
			self.maxMandatory = self.reservation.pax;

			self.dishesValidationCategory = true;
			self.dishesValidationMixCategoryDishes = true;

			let onlyValidationCategory = false;
			let mixValidationCategoryDishes = false;

            if(self.special_dishes.length > 0){
				// special dishes
                let specialDishes = self.special_dishes;
				specialDishes.map((elem,idx)=>{
					// loop dishes
					elem.dishes.map((ele, indx)=>{
						// platos no obligatorios
						if(ele.mandatory == '0'){
							// min
							if(self.minNoMandatory == null)
							{
								self.minNoMandatory =  ele.min;
							}
							if(ele.min < self.minNoMandatory)
							{
								self.minNoMandatory = ele.min;
							}
							// max
							if(self.maxNoMandatory == null)
							{
								self.maxNoMandatory =  ele.max;
							}
							if(ele.max > self.maxNoMandatory)
							{
								self.maxNoMandatory = ele.max;
							}
						}

						if (elem.type == 1) {
							onlyValidationCategory = true;
						} else if (elem.type == 3) {
							mixValidationCategoryDishes = true;
						} else {
							if(self.specialDishesCategoryMin[elem.id] > self.specialDishesCategorySelected[elem.id]
							|| self.specialDishesCategoryMax[elem.id] < self.specialDishesCategorySelected[elem.id]
							|| (ele.mandatory == '1' && self.specialDishes[ele.id] == 0)
								)
							{
								self.dishesValidationCategory = false;
							}
						}

						if (!!self.specialDishes[ele.id] && self.specialDishes[ele.id] > 0) {
							self.specialDishesSelected.push(`(${self.specialDishes[ele.id]}) ${ele.description}`);
						}
					})

				});
            }
            // validation mandatory
            if(self.minMandatory <= self.specialDishesMandatorySelected  && self.specialDishesMandatorySelected <= self.maxMandatory){
            	self.dishesValidationMandatory = true;
            }else{
            	self.dishesValidationMandatory = false;
            }

            // validation no mandatory
            if(self.minNoMandatory <= self.specialDishesNoMandatorySelected  && self.specialDishesNoMandatorySelected <= self.maxNoMandatory){
            	self.dishesValidationNoMandatory = true;
            }else{
            	self.dishesValidationNoMandatory = false;
            }

			//validación por categoría separada
			if (mixValidationCategoryDishes) {
				let mixCateogiesSelected = self.specialMixDishesCategorySelected;
				let mixCategoriesNotFilled = mixCateogiesSelected.filter((element) => (element != self.reservation.pax));
				self.dishesValidationMixCategoryDishes = mixCategoriesNotFilled.length == 0;
			}

            // validacion por platos
            if (onlyValidationCategory) {
            	self.dishesValidationCategory = true;
            } else {
            	// validacion por categorias
            	self.dishesValidationMandatory = true;
            	self.dishesValidationNoMandatory = true;
            }

        	// validation both
            if (!self.dishesValidationMandatory || !self.dishesValidationNoMandatory || !self.dishesValidationCategory || !self.dishesValidationMixCategoryDishes){
				self.dishesValidation = false;
            } else {
            	self.dishesValidation = true;
            }

		},
		async getSpecialDishes(){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v1/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('local_id', self.local_id);
			params.append('consumption_type_id', self.reservation.consumption_type);
			params.append('pax', self.reservation.pax);
			params.append('date', self.reservation.date);
			params.append('hour', self.reservation.hour);
			params.append('waitlist', self.reservation.waitlist);

			
			var rs = await axios.get("special-dishes",{
				params: params
			}).then(function (response) {
				self.special_dishes = response.data.special_dishes;
				//self.loading = false;
			}).catch(function (error) {
				console.log(error);
				self.loading = false;
			});
		},
		async selectAnHourWithWaitlist(hour) {
			var self = this;
			self.reservation.waitlist = 1;
			console.log("waitlist "+ self.reservation.waitlist);
			await self.selectAnHour(hour);
		},
		async selectAnHour(hour) {
        	var self = this;
        	
        	// ACTUALIZAR LA FECHA SI EL HORARIO ES DEL DÍA SIGUIENTE
        	if (hour.isNextDay && hour.nextDayDate) {
        		console.log('selectAnHour: Actualizando fecha a día siguiente:', hour.nextDayDate);
        		self.reservation.date = hour.nextDayDate;
        		// También actualizar la fecha en el objeto reservation_prev si existe
        		if (self.reservation_prev) {
        			self.reservation_prev.date = hour.nextDayDate;
        		}
        		// ACTUALIZAR selectedDate con el mismo formato que se usa en el resto de la aplicación
        		const dateFormat = (self.language === 'es') ? 'dddd, D [de] MMMM' : 'dddd, MMMM Do';
        		self.selectedDate = moment(hour.nextDayDate).format(dateFormat);
        		
        		// Aplicar el mismo procesamiento de capitalización que se usa en otras partes
        		if(self.language === 'es'){
        			self.selectedDate = self.selectedDate.split(' ').map((word, index) => {
        				if (index === 2) { // La palabra "de" no se capitaliza
        					return word;
        				}
        				return word.charAt(0).toUpperCase() + word.slice(1);
        			}).join(' ');
        		}
        	}
        	
        	let hours = self.hours;
        	let hourAvailable = false;
            if(self.hours != null && self.hours.length > 0){
	        	hours.map((elem,idx)=>{
	        		if(hour.hour == elem.hour){
	        			hourAvailable = true;
	        			self.schedule_id = elem.schedule_id;
	        			self.reservation.schedule_id = elem.schedule_id;
	        		}
				});
			}
        	if(self.reservation.hour != hour.hour && hourAvailable){
        		self.reservation.hour = hour.hour;
        		self.selectedHour = hour.hour_text;
        		
        		if(self.widget.start_order != '3'){
					self.reservation.consumption_type = null;
	        		self.reservation.zone_id = null;
	        		self.reservation.zone_name = null;
        		}
				
        		if(self.useZones == 0 && self.useConsumptionTypes == 0 && self.widget.start_order == "1"){
        			self.step = 9;
        			self.validateDynamicInputs();
        			self.moveToStep(9);
        		}else if(self.widget.start_order == "3"){
        			self.step = 9;
        			self.validateDynamicInputs();
        			self.moveToStep(9);
        		}
        		else{
        			// widget start using PAX
        			if(self.widget.start_order == "1"){
		        		self.step = 7;
		        		self.moveToStep(7);
		                // show first zones
		                if(self.optionsOrder == 0){
		                    if(self.useZones == 1){
		                        self.consumption_types = [];
		                        await self.getPaxData("zones");
		                        if(self.zones != null && self.zones.length > 0 && self.zones.length == 1){
		                            self.selectManualZone = false;
		                            await self.selectZone(self.zones[0].id);
		                        }
		                        // en caso sea un horario con waitlist
		                        if(self.reservation.waitlist == 1  && self.zones != null && self.zones.length > 0 ){
		                            self.selectManualZone = false;
		                            await self.selectZone(self.zones[0].id);
		                        }
								/*if(self.reservation_prev.zone_id != null && self.reservation_prev.zone_id !=""){
									self.selectManualZone = true;
									self.reservation.zone_id = self.reservation_prev.zone_id;
									await self.selectZone(self.reservation_prev.zone_id);
								}*/
		                    }
		                }else{
		                    if(self.useConsumptionTypes == 1){
		                        self.zones = [];
		                        await self.getPaxData("consumption_types");
		                        if(self.autoSelectFirstConsumptionType && self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1 && self.consumption_types[0].available == 1){
		                            self.selectManualConsumptionType = false;
		                            self.step = 7;
		                            self.moveToStep(7);
		                            await self.selectConsumptionType(self.consumption_types[0].id);
		                        }
								if(self.reservation_prev.consumption_type != null && self.reservation_prev.consumption_type !=""){
									self.selectManualConsumptionType = true;
									self.reservation.consumption_type = self.reservation_prev.consumption_type;
									self.step = 7;
									self.moveToStep(7);
									await self.selectConsumptionType(self.reservation_prev.consumption_type);
								}
		                    }
		                }
        			}else{
        				self.loadingPeople = true;
        				self.step = 6;
        				self.moveToStep(6);
        				await self.getPaxData3();
        				self.loadingPeople = false;
        			}

        		}

				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}

                await self.getPaxData2();
                await self.getGuarantee();
        	}
        },
        async getPaxDataInfo(type){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			if(self.reservation.waitlist != null){
				params.append('type_reservation', "waitlist");
			}else{
				params.append('type_reservation', "widget");
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}
			if(type){
				params.append('response', type);
			}

			params.append('from', 'gateway');

			
			
			var rs = await axios.get("flexible-search",{
			  params: params
			}).then(function (response) {
				// zones
				if(type == "zones"){
					self.zones = response.data != null  && response.data.locals.length > 0  && response.data.locals[0].zones_v2 != null ? response.data.locals[0].zones_v2 : [];
				}
				// consumption_types
				if(type == "type_consumptions"){
					self.consumption_types = response.data != null  && response.data.locals.length > 0 && response.data.locals[0].type_consumptions_v2 != null ? response.data.locals[0].type_consumptions_v2 : [];
				}
				// available_paxs
				if(type == "available_paxs"){
					self.available_paxs = response.data != null  && response.data.locals.length > 0 && response.data.locals[0].available_paxs != null ? response.data.locals[0].available_paxs : [];
					let people = [];
					let available_paxs = self.available_paxs;
					available_paxs.map((elem,idx)=>{
						people.push(elem);
					});
					self.people = people;
				}
				self.loading = false;
			}).catch(function (error) {
				self.loading = false;
			});
		},
        async getPaxData(type){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			params.append('paxs', self.reservation.pax);
			if(self.reservation.waitlist != null){
				params.append('type_reservation', "waitlist");
			}else{
				params.append('type_reservation', "widget");
			}

			if(self.reservation.id > 0){
				params.append('reservation_id',self.reservation.id);
			}
			const hour = self.reservation.hour;
			if(hour){
				params.append('hour', hour);
			}
			if(self.reservation.date){
				params.append('date', self.reservation.date);
				params.append('response', "hours,unavailable_hours,available_paxs,zones,type_consumptions");
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}

			params.append('from', 'gateway');

						
			var rs = await axios.get("search",{
			  params: params
			}).then(function (response) {
				if(type == "zones"){
					self.zones = response.data != null  && response.data.locals.length > 0  && response.data.locals[0].zones_v2 != null ? response.data.locals[0].zones_v2 : [];
				}
				if(type == "consumption_types"){
					self.consumption_types = response.data != null  && response.data.locals.length > 0 && response.data.locals[0].type_consumptions_v2 != null ? response.data.locals[0].type_consumptions_v2 : [];
				}
				if(response.data != null  && response.data.locals.length > 0  && response.data.locals[0].hours != null && response.data.locals[0].hours.length > 0){
					self.schedule_id = response.data.locals[0].hours[0].schedule_id;
					self.reservation.schedule_id = self.schedule_id;
				}
				self.loading = false;
			}).catch(function (error) {
				self.loading = false;
			});
		},
        async getPaxData2(){
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			if(self.reservation.waitlist != null){
				params.append('type_reservation', "waitlist");
			}else{
				params.append('type_reservation', "widget");
			}
			if(self.reservation.pax > 0){
				params.append('paxs', self.reservation.pax);
			}
			if(self.reservation.id > 0){
				params.append('reservation_id',self.reservation.id);
			}
			const hour = self.reservation.hour;
			if(hour){
				params.append('hour', hour);
			}
			if(self.reservation.date){
				params.append('date', self.reservation.date);
				params.append('response', "hours,unavailable_hours,available_paxs,zones,type_consumptions");
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}

			params.append('from', 'gateway');

			
			var rs = await axios.get("search",{
			  params: params
			}).then(function (response) {
				if(response.data.locals[0].hours.length > 0){
					self.schedule_id = response.data.locals[0].hours[0].schedule_id;
					self.reservation.schedule_id = self.schedule_id
				}
				self.loading = false;
			}).catch(function (error) {
				self.loading = false;
			});
		},
        async getPaxData3(){
        	console.log("getPaxData3");
			var self = this;
			//self.loading = true;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v2/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';
			window.axios.defaults.headers.common['Accept'] = 'application/json';
			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('local_id', self.local_id);
			if(self.reservation.waitlist != null){
				params.append('type_reservation', "waitlist");
			}else{
				params.append('type_reservation', "widget");
			}
			if(self.reservation.pax > 0){
				params.append('paxs', self.reservation.pax);
			}
			if(self.reservation.id > 0){
				params.append('reservation_id',self.reservation.id);
			}
			const hour = self.reservation.hour;
			if(hour){
				params.append('hour', hour);
			}
			if(self.reservation.date){
				params.append('date', self.reservation.date);
				params.append('response', "hours,unavailable_hours,available_paxs,zones,type_consumptions");
			}
			if(self.reservation.consumption_type){
				params.append('type_consumption_id', self.reservation.consumption_type);
			}
			if(self.reservation.zone_id){
				params.append('zone_id', self.reservation.zone_id);
			}

			params.append('from', 'gateway');

			
			var rs = await axios.get("search",{
			  params: params
			}).then(function (response) {
				if(response.data.locals[0].available_paxs.length > 0){
					self.people = response.data.locals[0].available_paxs;
				}
				self.loading = false;
			}).catch(function (error) {
				self.loading = false;
			});
		},
        async getGuarantee(customScheduleId = null){
			var self = this;
			//self.loading = true;
			self.showBeforeTheMenu = false;
			self.hasInvoicing = false;
			self.requiredPaymentDocuments = false;

			//Mostrar Platos estilo Maido | Mostrar platos como paso previo
			//START Hack para habilitar el menú antes de confirmar la reserva
			if (self.local_id == 2179 || self.local_id == 11 ||self.local_id == 14 || self.local_id == 2246 || self.local_id == 2337 || self.local_id == 2370 || self.local_id == 2488 || self.local_id == 2465 || self.local_id == 2478 || self.local_id == 2517 || self.local_id == 2550) {
				self.showBeforeTheMenu = true;
			}
			//END Hack para habilitar el menú antes de confirmar la reserva

			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v3/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			let scheduleId = self.schedule_id;

			if (!!customScheduleId) {
				scheduleId = customScheduleId;
			}

			const params = new URLSearchParams();
			params.append('language', self.language);
			params.append('country_code', self.country_code);
			params.append('schedule_id', scheduleId);
			params.append('date', self.reservation.date);
			params.append('from', "widget");
			params.append('waitlist', self.reservation.waitlist != null ? 1 : 0);
			
			if(self.reservation.pax > 0){
				params.append('paxs', self.reservation.pax);
			}

			
			
			const rs = await axios.get("reservations/schedule-data",{
			  params: params
			}).then(function (response) {
				self.guarantee = response.data;
				self.fixedAmount = 0.00;
				
				if (self.guarantee != null & self.guarantee.amount > 0) {
					self.fixedAmount = self.guarantee.amount;
					self.reservation.payment_card_calculate = self.guarantee.amount;
					self.reservation.payment_card_tip = 0.00;
					self.gateways = self.guarantee.gateways;
					if(self.gateways != null && self.gateways.length > 0){
						self.gateway_type = self.gateways[0].type; //suscripcion
						self.payment_type = self.gateways[0].payment_type; // D
						self.gateway_name = self.gateways[0].alias;
						self.reservation.payment_gateway = self.gateways[0].alias;
					}
					if(["culqi","kushki","culqi3ds","wompi", 'stripe'].includes(self.gateway_name)){
						self.showGuarantee = true;
						self.hasPayment = true;
						self.hasInvoicing = true;
					}else if(self.gateway_name == "izipay"){
						self.showGuarantee = true;
						self.hasPayment = false;
						//self.hasInvoicing = false;
						self.hasInvoicing = true;
					}
				} else if (self.guarantee != null && self.guarantee.payment_type == "T") {
					self.reservation.payment_card_calculate = self.guarantee.amount;
					self.reservation.payment_card_tip = 0.00;
					self.gateways = self.guarantee.gateways;
					self.payment_type = self.guarantee.payment_type; // T

					if(self.gateways != null && self.gateways.length > 0){
						self.gateway_type = self.gateways[0].type; //pago-unico
						//self.payment_type = self.gateways[0].payment_type; // T
						self.gateway_name = self.gateways[0].alias;
						self.reservation.payment_gateway = self.gateways[0].alias;
					}
					if(["culqi","kushki","culqi3ds","wompi", 'stripe'].includes(self.gateway_name)){
						self.showGuarantee = true;
						self.hasPayment = true;
						self.hasInvoicing = true;
					}else if(self.gateway_name == "izipay"){
						self.showGuarantee = true;
						self.hasPayment = false;
						self.hasInvoicing = false;
					}
				} else {
					self.showGuarantee = false;
					self.hasPayment = false;
					self.gateway_name = null;
					self.reservation.payment_gateway = null;
				}

				self.fallingBack = false;

				//START Hack settings to hide invoicing documents
				if (self.local_id == 2390) {
					self.hasInvoicing = false;
				}
				//END Hack settings to hide invoicing documents

				if((self.local_id == 1902 || self.local_id == 402) && self.reservation.waitlist != null){
					self.showGuarantee = false;
					self.hasPayment = false;
					self.gateway_name = null;
					self.reservation.payment_gateway = null;
					self.hasInvoicing = false;
				}

				//Mostrar Platos estilo Maido | Forzar que muestre los platos en un paso previo
				//START Hack para habilitar el menú antes de confirmar la reserva
				if (self.local_id == 14 || self.local_id == 11 || self.local_id == 2179 || self.local_id == 2246 || self.local_id == 2337 || self.local_id == 2488 || self.local_id == 2465 || self.local_id == 2478 || self.local_id == 2517 || self.local_id == 2550) {
					self.showBeforeTheMenu = true;
				} else if (self.guarantee.payment_type == "T" && (self.local_id == 2262 || self.local_id == 2257  || self.local_id == 2370)) {
					self.showBeforeTheMenu = true;
				}
				//END Hack para habilitar el menú antes de confirmar la reserva
				
				if (scheduleId != self.schedule_id) {
					self.schedule_id = scheduleId;
					self.reservation.schedule_id = scheduleId;
				}
				//self.loading = false;
			}).catch(function (error) {
				self.errorMessage = error.response.data.message;
				//self.loading = false;
			});

			if (self.gateway_name == 'stripe' && !(self.stripe.ready || self.stripe.initializing)) {
				try {
					await self.loadStripeScript();
					await self.initStripeForm();
				} catch (err) {
					console.error('Error cargando Stripe:', err.message);
					self.stripe.error = true;
					self.stripe.errorMessage = err.message || 'Error al cargar el formulario de pago';
				}
			}

			if (self.country_code === 'AW' || [2465,2482].includes(self.local_id)) {
				self.enabledPaymentDocuments = 0;
			}

			if ([2383].includes(self.local_id)) {
				self.enabledPaymentDocuments = 1;
			}

			if (self.hasInvoicing && self.enabledPaymentDocuments == 2) {
				self.requiredPaymentDocuments = true;
			}
        },
        async selectZoneInfo(zone) {
            var self = this;

			if (self.bridgeZonesEnabled) {
				self.step = 3;
				self.moveToStep(3);
				self.loadingPeople = true;
				await self.getPaxDataInfo("available_paxs");
				self.loadingPeople = false;
			} else if (self.reservation.zone_id !=  zone || self.reservation_prev.zone_id != null) {
                self.reservation.zone_id = zone;
            	// fill zone name
				let zones = self.zones;
				if(self.zones != null && self.zones.length > 0){
					zones.map((elem,idx)=>{
						if(self.reservation.zone_id == elem.id){
							self.reservation.zone_name = elem.name_247;
						}
					});
				}
				// Order Zone - Consumption type
	            if(self.optionsOrder == 0 && self.useZones == 1){
					self.step = 2;
					self.moveToStep(2);
	            	await self.getPaxDataInfo("type_consumptions");
	            	if(self.autoSelectFirstConsumptionType && self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1){
                        self.selectManualConsumptionType = false;
                        await self.selectConsumptionTypeInfo(self.consumption_types[0].id);
                    }
	            }else{
	            	self.step = 3;
	            	self.moveToStep(3);
	            	self.loadingPeople = true;
		            await self.getPaxDataInfo("available_paxs");
		            self.loadingPeople = false;
	            }

				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}
            }
        },
        async selectZone(zone) {
            var self = this;

			if (self.bridgeZonesEnabled) {
				self.step = 9;
				self.moveToStep(9);
				self.loadingPeople = true;
				await self.getPaxData2();
				self.loadingPeople = false;
			} else if (self.reservation.zone_id !=  zone || self.reservation_prev.zone_id != null) {
                self.reservation.zone_id = zone;
            	// fill zone name
				let zones = self.zones;
				if(self.zones != null && self.zones.length > 1){
					zones.map((elem,idx)=>{
						if(self.reservation.zone_id == elem.id){
							self.reservation.zone_name = elem.name_247;
						}
					});
				}
                // when second is consumption type
                if(self.optionsOrder == 0 && self.useConsumptionTypes == 1){
                    self.consumption_types = [];
                    self.reservation.consumption_type = null;
                    self.reservation.consumption_type_name = null;
                    self.step = 8;
                    self.moveToStep(7);
                    await self.getPaxData("consumption_types");
                    self.selectManualConsumptionType = true;
                    if(self.autoSelectFirstConsumptionType && self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1){
                        self.selectManualConsumptionType = false;
                        await self.selectConsumptionType(self.consumption_types[0].id);
                    }
                    /*if(self.reservation_prev.consumption_type != null && self.reservation_prev.consumption_type != ""){
                        if(self.consumption_types != null && self.consumption_types.length > 0 && self.consumption_types.length == 1){
                            self.selectManualConsumptionType = false;
                        }
                        if(self.consumption_types != null && self.consumption_types.length > 0){
                            await self.selectConsumptionType(self.reservation_prev.consumption_type);
                        }
                    }*/
                }else{
                	self.step = 9;
                	self.moveToStep(9);
                	await self.getPaxData2();
                }

            	if(self.reservation.id == null && self.reservation.id !=""){
            		self.cleanFields();
            	}

				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}

				//Start Hack campos dinámicos para Maido al seleccionar una zona
				if (self.local_id == 2246 || self.local_id == 2179) {
					self.validateDynamicInputs();
				}
				//End Hack campos dinámicos para Maido al seleccionar una zona
            }
            await self.getGuarantee();
        },
        async selectConsumptionTypeInfo(consumption_type, event = null) {
            var self = this;

			if (event && event.target.tagName === 'A') {
				return;
			}

            if (self.reservation.consumption_type !=  consumption_type || self.reservation_prev.consumption_type != null ) {
                self.reservation.consumption_type = consumption_type;
            	// fill consumption type name
				let consumption_types = self.consumption_types;
				if(self.consumption_types != null && self.consumption_types.length > 0){
					consumption_types.map((elem,idx)=>{
						if(self.reservation.consumption_type == elem.id){
							self.reservation.consumption_type_name = elem.name;
						}
					});
				}
            }
            // Order Consumption type - Zone
            if(self.optionsOrder == 1 && self.useZones == 1){
				self.step = 2;
				self.moveToStep(2);
	            await self.getPaxDataInfo("zones");
	            // auto select zone
				if(self.bridgeZonesEnabled){
                    self.selectManualZone = false;
					await self.selectZoneInfo(self.zones[0].id);
                } else if (self.zones != null && self.zones.length > 0 && self.zones.length == 1){
                    self.selectManualZone = false;
                    self.reservation.zone_name = self.zones[0].name_247;
                    await self.selectZoneInfo(self.zones[0].id);
                }
            }else{
            	self.step = 3;
            	self.moveToStep(3);
            	await self.getPaxDataInfo("available_paxs");
            }
		    /* para que muestre zonas siempre y no autoseleccione cuando hay uno
		    if(self.zones != null && self.zones.length > 0 && self.zones.length == 1){
                self.selectManualZone = false;
                self.reservation.zone_name = self.zones[0].name_247;
                self.step = 3;
                await self.selectZoneInfo(self.zones[0].id);

        	}*/

			if (self.step <= 5) {
				self.getRecommendedReservationLocals();
			}
			self.resetShowDetail();
        },
        async selectConsumptionType(consumption_type, event = null) {
            var self = this;

			if (event && event.target.tagName === 'A') {
				return;
			}

            if (self.reservation.consumption_type !=  consumption_type || self.reservation_prev.consumption_type != null ) {
                self.reservation.consumption_type = consumption_type;
				self.validateDynamicInputs();
            	// fill zone name
				let consumption_types = self.consumption_types;
				if(self.consumption_types != null && self.consumption_types.length > 0){
					consumption_types.map((elem,idx)=>{
						if(self.reservation.consumption_type == elem.id){
							self.reservation.consumption_type_name = elem.name;
						}
					});
				}

				//Start Hack campos dinámicos para Maido al seleccionar un tipo de consumo
				if (self.local_id == 2246 || self.local_id == 2179) {
					self.validateDynamicInputs();
				}
				//End Hack campos dinámicos para Maido al seleccionar un tipo de consumo

                if(self.optionsOrder == 1 && self.useZones == 1){
                    self.zones = [];
                    self.reservation.zone_id = null;
                    self.reservation.zone_name = null;
                    self.step = 8;
                    self.moveToStep(7);
                    await self.getPaxData("zones");
                    self.selectManualZone = true;

					if(self.bridgeZonesEnabled){
						self.selectManualZone = false;
						await self.selectZone(self.zones[0].id);
					} else if(self.zones != null && self.zones.length > 0 && self.zones.length == 1){
                        self.selectManualZone = false;
                        self.reservation.zone_name = self.zones[0].name_247;
                        self.step = 8;
                        self.moveToStep(7);
                        await self.selectZone(self.zones[0].id);
                    }

                    if(self.reservation_prev.zone_id != null && self.reservation_prev.zone_id != ""){
                        self.selectManualZone = true;
                        self.step = 8;
                        self.moveToStep(7);
                        await self.selectZone(self.reservation_prev.zone_id);
                    }
                }else{
                	self.step = 9;
                	self.moveToStep(7);
                	await self.getPaxData2();
                }

				if (self.step <= 5) {
					self.getRecommendedReservationLocals();
				}
            }

            await self.getGuarantee();
			self.resetShowDetail();
        },
		resetShowDetail() {
			var self = this;
			self.consumption_types.forEach(item => {
				item.showDetail = false;
			});
		},
        validatePayment(){
			var self = this;
			
			if(self.gateway_name == "culqi"){
				self.loading = true;
				if(typeof Culqi !== "undefined"){
                    //before creating the token we'll set a timeout that will wait for 10 seconds
                    //if theres neither a token or an error in the Culqi object then something has gone wrong
                    //we'll clear the interval and show an error message
                    setTimeout(function() {
                        if (self.processingReservation && Culqi.token == undefined && Culqi.error == undefined) {
                            clearInterval(self.ginterval);
                            self.processingReservation = false;
                            //show default error message
							self.errorMessage = 'Ha ocurrido un error al procesar el pago. Por favor, revise los datos de su tarjeta y vuelva a intentarlo.';
                        }
                    }, 10000);
					Culqi.token = undefined;
					Culqi.createToken();
				}
				//this.ginterval = setInterval(() => {
				// self.culqi();
				//}, 10000);
                //instead of doing setInterval we'll register the Culqi function to the window object
                window.culqi = this.culqi;
			} else if(self.gateway_name == "kushki"){
				self.loading = true;
				self.kushki();
			} else if(self.gateway_name == "culqi3ds") {
				self.loading = true;
				self.culqi3ds();
			} else if(self.gateway_name == "wompi") {
				self.loading = true;
				self.wompi();
			} else if(self.gateway_name == 'stripe') {
				self.loading = true;
				self.stripeCardSetup();
			}
        },
		backPreviewLastStep(){
			var self = this;

			if (self.reloadReturnPage) {
				location.reload();
				return false;
			}

			if (self.showBeforeTheMenu) {
				self.completeTheMenuValidation = false;
			} else {
				self.selectStep(9);
			}

			let reservationTopAnchor = document.getElementById("confirmReservationInfo");
			reservationTopAnchor.scrollIntoView({behavior: "smooth", block: "start"});
		},
		async validateTheMenu() {
			var self = this;

			self.loading = true;

			self.validateQuantity();

			if (self.dishesValidation) {
				
				/*if (self.dishesAmount == 0 && self.schedule_id == 35969) {
					
					await self.getGuarantee(35977);
					self.completeTheMenuValidation = true;
					self.reloadReturnPage = true;
				} else if (self.dishesAmount != 0 && self.schedule_id == 35977) {
					await self.getGuarantee(35969);
					self.validateQuantity();

					if (self.dishesValidation) {
						self.reloadReturnPage = true;
						self.completeTheMenuValidation = true;
					}
				} else if (self.dishesAmount >= 0 && self.dishesAmount < 3000 && self.schedule_id == 35976) {
					self.dishesAmount = 3000.00;
					self.dishesAmountFormato = self.paymentCurrency + parseFloat(self.dishesAmount).toFixed(2);

					self.totalAmount = self.warrantyAmount * 1.00 + self.tipAmount * 1.00 + self.dishesAmount * 1.00;
            		self.totalAmountFormato = self.paymentCurrency + ' ' + parseFloat(self.totalAmount).toFixed(2);
				
					self.completeTheMenuValidation = true;
				} else {
					self.completeTheMenuValidation = true;
				}*/

				//START HACK: Fixed minimum amount for the special cases
				let fixedMinimumAmount = 0;
				const validScheduleIds = [
					35976, 36336, 36337, 36338, 36339, 36340, 36341,
					36342, 36343, 36344, 36345, 36346, 36347
				]; // Valid schedules for the Private Area of Maido

				if (self.local_id == 2179 && validScheduleIds.includes(self.schedule_id)) {
					fixedMinimumAmount = 3000.00; // Maido privated amount
				} else if (self.reservation.consumption_type == 3322 || self.reservation.consumption_type == 3305) {
					fixedMinimumAmount = 1360.00; // Alqa pachamanca amount 340*4
				}

				if (self.dishesAmount >= 0 && self.dishesAmount < fixedMinimumAmount) {
					self.dishesAmount = fixedMinimumAmount;

					// dishes amount
					self.dishesAmount = self.fixedAmount * 1.00 + self.dishesAmount;
					self.dishesAmount = self.dishesAmount * 1.00;

					self.dishesAmountFormato = self.paymentCurrency + parseFloat(self.dishesAmount).toFixed(2);
					//tip amount
					self.tipAmount = (self.mountNew * 1.00 *(self.warrantyAmount * 1.00 + self.dishesAmount) / 100);
					self.tipAmountFormato = self.paymentCurrency + ' ' + parseFloat(self.tipAmount).toFixed(2);
					self.payment_tip = self.tipAmount;
					// total amount
					self.totalAmount = self.warrantyAmount * 1.00 + self.tipAmount * 1.00 + self.dishesAmount * 1.00;
					self.totalAmountFormato = self.paymentCurrency + ' ' + parseFloat(self.totalAmount).toFixed(2);

					self.reservation.payment_card_calculate = self.totalAmount;
					self.reservation.payment_card_tip = self.payment_tip;
				}
				//END HACK: Fixed minimum amount for the special cases

				self.completeTheMenuValidation = true;

				/*if (self.schedule_id == 35976) {
					//Habilitar politicas de privacidad maido
					self.extraCustomPolicyEnabled = true;
				}*/
			}

			self.loading = false;

			if (self.completeTheMenuValidation) {
				document.getElementById("page-header").scrollIntoView({behavior: "instant", block: "start"});

				if (self.reservation.zone_id == 4830) {
					
					if (self.language !== 'en') {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Política de Garantía de Reserva</div>

							Para confirmar su reserva, se solicitará una garantía de <b>S/185</b> por persona. Este monto solo se cobrará en los siguientes casos:

							- Si no se presenta a la reserva (no show).
							- Si cancela con menos de 24 horas de anticipación.
							- Si asisten menos personas de las que confirmó.
							
							Esto no es un Pago anticipado de reserva, usted deberá pagar el total de su consumo directamente a Maido.
							
							Le recordamos que contamos con una tolerancia de <b>10 minutos</b> para la llegada de todos los miembros del grupo. Pasado ese tiempo, la reserva se considerará como <b>no show</b> y se aplicará el cargo correspondiente a la tarjeta registrada.
							
							Gracias por su comprensión.
						`;
					} else {
						self.specialDishesPopupMessage = `<div style="display:block; text-align: center; color: #c40d3c; font-family: 'Manrope-SemiBold'; text-transform: uppercase;">Reservation Guarantee Policy</div>

							To confirm your reservation, a guarantee of <b>S/185</b> per person is required. This amount will only be charged in the following cases:
							
							- If you do not show up for your reservation (no-show).
							- If you cancel with less than 24 hours' notice.
							- If fewer guests attend than were originally confirmed.

							This is not a prepayment reservation, you must pay the total of your consumption directly to Maido.

							Please note that we allow a <b>10-minute grace period</b> for the full party to arrive. After this time, the reservation will be considered a <b>no-show</b>, and the guarantee will be charged to the card on file.
							
							Thank you for your understanding.
						`;
					}

					$('#specialDishesPopup').modal({backdrop: 'static', keyboard: false}, 'show');
				}
			} else {
				let reservationTopAnchor = document.getElementById("confirmReservationInfo");
				reservationTopAnchor.scrollIntoView({behavior: "smooth", block: "start"});
			}
		},
        async doReservation(){
            if(this.gateway_name == "culqi3ds"){
              await this.loadCorrespondingCulqiScriptSync('v4');
            } else if(this.gateway_name == "culqi"){
              await this.loadCorrespondingCulqiScriptSync('v2');
            }
            var self = this;
            self.loading = true;
            self.loadingMessage =  "Procesando la información proporcionada";
            self.processingReservation = true;
            console.log("doReservation - start -" +self.processingReservation);
            let dynamicF = self.dynamicFields;
      		self.dynamicInputs = [];
			dynamicF.map((elem,idx)=>{
				self.dynamicInputs.push({id:idx,value:elem});
			});
			self.reservation.dynamic_inputs = self.dynamicInputs;
			// special dishes
			let specialD = self.specialDishes;
      		let special_dishes = [];
			specialD.map((elem,idx)=>{
				special_dishes.push({id:idx,value:elem});
			});
			self.reservation.special_dishes = special_dishes;
            let validation = self.validateForm();
            //if we're on culqi3ds and we're yape validate is false
            //so we'll check the phone number and code and validate
            //in a corresponding way
            if(this.gateway_name == "culqi3ds" && this.isYape){
              //we'll get the element by the data-culqi attribute
              const phoneNumber = document.querySelector(
                `[data-culqi="yape[phone]"]`
              );
              const yapeCode = document.querySelector(
                `[data-culqi="yape[code]"]`
              );
              //phone number has to be numeric and 9 digits
              //while yape code has to be numeric and 6 digits
              //we'll check that
              
              if(phoneNumber && yapeCode){
                if(!/^\d{9}$/.test(phoneNumber.value)){
                  this.errorMessage = "El número ingresado no es válido. Por favor, ingrese un número de celular válido.";
                  validation = false;
                } else {
                  validation = true;
                }
                if(!/^\d{6}$/.test(yapeCode.value)){
                  this.errorMessage = "El código ingresado no es válido. Por favor, ingrese un código válido.";
                  validation = false;
                } else {
                  validation = true;
                }
              }
            }
            console.log("validation "+ validation);
            if(self.special_dishes.length > 0 && !self.completeTheMenuValidation){
            	self.validateQuantity();
            }
            if(validation && self.dishesValidation){
            	 console.log("hasPayment "+ self.hasPayment);
            	if(self.hasPayment && !self.blockForeignPayments){
					self.validatePayment();
            	}else{
            		await self.continueReservation();
            	}
            	self.loading = false;
            } else {
	            self.processingReservation = false;
	            self.loading = false;
	            var element = document.getElementById("confirmReservationInfo");
           		element.scrollIntoView({behavior: "smooth", block: "start"});
	            console.log("doReservation - end -" + self.processingReservation);
            }
		},
		async continueReservation(){
			var self = this;
			self.loading = true;
			if(self.reservation.id > 0){
				//await self.updateReservation();
			}else{
				await self.makeReservation();
			}
		},
		async makeReservation(){
			var self = this;
			self.loading = true;
			self.reservation.reserve_for_another = self.reservation.reserve_for_another ? 1 : 0;

			if(!self.selectManualConsumptionType){
				//self.reservation.consumption_type = null;
			}
			if(!self.selectManualZone){
				self.reservation.zone_id = null;
			}
			if(self.reservation.waitlist != null){
				self.reservation.from = "waitlist";
			}

			const reservationAllergies = self.reservation.allergies ? self.reservation.allergies.trim() : '';

			if ((self.local_id == 2433 || self.local_id == 2179) && reservationAllergies === '') {
				self.reservation.allergies = 'Ninguna';
			}

			self.reservation.type_consumption_id = self.reservation.consumption_type;
			self.reservation.politic_communication = self.reservation.politic_communication ? 1 : 0;
			self.reservation.agree_age = self.reservation.agree_age ? 1 : 0;
			self.loadingMessage = "Procesando la información proporcionada";
			window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v1/';
			window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token2 };
			window.axios.defaults.headers.common['Content-Type'] = 'application/json';
			window.axios.defaults.headers.common['Accept'] = 'application/json';

			const params = new URLSearchParams();
			params.append('language', self.language);

			
			
			if(this.fallingBack){
				self.reservation.payment_gateway = "izipay";
			}

			
			
			//if we're on wompi we'll add a waiting message telling the user that their payment is being processed
			if(this.gateway_name === 'wompi'){
				self.errorMessage = 'Estamos procesando tu pago con el banco, por favor espere.';
				setTimeout(()=>{
					const error_element = document.querySelector('#reservation .reservation section .section-information .information .error-message');
					if(error_element){
						console.log(error_element);
						error_element.style.backgroundColor = '#bf9817';
						console.log(error_element.style.backgroundColor);
					}
				},1);
			}

			var rs = await axios.post("locals/"+self.local_id+"/reservations",
				{
				...self.reservation,
				email_billing: self.reservation.document_type != '1' ? "" : self.reservation.email_billing,
				...(self.gateway_name === 'culqi3ds' ? { deviceId: this.deviceId } : {}),
				...(this.authenticated3DS ? { parameters3DS: this.parameters3DS } : {}),
				...(this.gateway_name === 'wompi' ? { acceptanceToken: this.wompi_acceptance_token } : {})
				}
      		,{
				params: params
			}).then(function (response) {

				if(self.gateway_name === 'wompi'){
					const original_background = '#da5f6a';
					self.errorMessage = '';
					setTimeout(()=>{
						const error_element = document.querySelector('#reservation .reservation section .section-information .information .error-message');
						if(error_element){
							error_element.style.backgroundColor = original_background;
						}
					},1);
				}
				//if the error message starts with Error_object then it's a parsable json object
				if(self.gateway_name === 'kushki' && response.data?.success === false && response.data?.data?.message.startsWith('Error_object')){
					//try catch since json parsing could technically fail
					try{
						//the object is after Error_object - 
						const errorObj = JSON.parse(response.data.data.message.replace('Error_object - ', ''));
						//now if we have a diners card we'll then and only then fallback, otherwise we'll show the error
						//for this we'll lowercase the brand and then check if it includes diners
						if(errorObj?.payment_brand?.toLowerCase().includes('diners')){
							self.fallback();
							return;
						}
						self.showFinishMessage = false;
						self.loading = false;
						self.processingReservation = false;
						self.errorMessage = errorObj.original_message;
					} catch(e){
						self.showFinishMessage = false;
						self.loading = false;
						self.processingReservation = false;
						self.errorMessage = 'Ha ocurrido un error inesperado';
					}
					return;
				}
				if(response.data?.success === false && response.data?.data?.message === "Card needs to be authenticated"){
					self.culqi3dsAuthentication();
					return;
				}
				self.reservation_info = response.data.data;
				// redirect when you use izipay
				if(self.gateway_name == "izipay"){
					//if we're falling back, wait for a few seconds before redirecting
					let izipayRedirectUrl = "/reservas/" + self.local_alias + "/pago-con-izipay/" + self.reservation_info.Id + "/"+ self.reservation_info.Hash;

					if (self.reservation.email == 'angelica.silva@cicciolinacuzco.com' && [2346, 2432, 2387, 2433].includes(self.local_id)) {
						izipayRedirectUrl = "/reservas/" + self.local_alias + "/confirm/" + self.reservation_info.Hash;
					}
					
					if(self.fallingBack){
						setTimeout(() => {
							location.href = izipayRedirectUrl;
						}, 7000);
					} else {
						location.href = izipayRedirectUrl;
					}
				} else {
					/* self.step = 11;

					self.showFinishMessage = true;
					self.reservation.id = self.reservation_info.Id;
					self.local_name = self.reservation_info.Local.Nombre;
					self.local_ubigeo = self.reservation_info.Local.Distrito;
					self.loading = false;
          			self.hasBeenPaid = self.hasPayment;
					self.hasPayment = false; */

					let lastReservationObject = {
						'name': self.reservation.name,
						'last_name': self.reservation.last_name,
						'email': self.reservation.email,
						'cellphone_only_number': self.reservation.cellphone_only_number,
					}

					let lastReservation = JSON.stringify(lastReservationObject);

					setMesaCookie('last_reservation', lastReservation, 4320); //6 meses dura la cookie

					self.reservation_info.FechaReserva =  moment(self.reservation_info.FechaReserva).format('ddd, D MMM');

					if(typeof fbq != "undefined"){
						console.log("Ejecuta fb_track reserva_exitosa");
						var script = document.createElement('script');
						script.type = 'text/javascript';
						script.innerText = "fbq('track', 'reserva_exitosa');";
						document.head.appendChild(script);
			        }

					const finishReservationUrl = "/reservas/" + self.local_alias + "/confirm/" + self.reservation_info.Hash + "?language=" + self.language;

					location.href = finishReservationUrl;

					/* let reservationTopAnchor = document.getElementById("reservation");
					reservationTopAnchor.scrollIntoView({behavior: "smooth", block: "start"}); */

					/*setTimeout(() => {
						const urlBase = window.location.host.toString();
						switch(urlBase){
							case 'cclarcomar.mesa247.pe':
								this.local = null;
								window.location.href = self.AgrupacionRedirect;
								break;
							default:
              					if(self.reservation_info.EsperaPago != undefined  && self.reservation_info.EsperaPago == 1 && self.reservation_info.RedirectUrl != undefined && self.reservation_info.RedirectUrl != ""){
               						window.location.href = response.RedirectUrl;
              					}else if(self.AgrupacionRedirect != null && self.AgrupacionRedirect != ''){
									window.location.href = self.AgrupacionRedirect;
								}else{
									console.log('No hay redirección');
								}
								break;
						}
					}, 30000);*/
				}
			}).catch(function (error) {
				if(self.gateway_name === 'wompi'){
					const error_element = document.querySelector('#reservation .reservation section .section-information .information .error-message');
					const original_background = '#da5f6a';
					setTimeout(()=>{
						if(error_element){
						error_element.style.backgroundColor = original_background;
						}
					},1);
				}
				if(self.gateway_name === 'culqi3ds') {
					//the object may come with success false and the message
					//that the card needs to be authenticated
					console.log(error.response);
					if(error.response?.data?.success === false && error.response?.data?.data?.message === "Card needs to be authenticated"){
						self.culqi3dsAuthentication();
						return;
					}
				}
				
                self.showFinishMessage = false;
				self.loading = false;
				self.processingReservation = false;
				self.errorMessage = error.response.data.message;
	            console.log("doReservation - end -" + self.processingReservation);

				if(self.shouldFallback()){
					self.fallback();
				}
			});
		},
		cleanFields(){
			var self = this;
			self.reservation.name = "";
			self.reservation.last_name = "";
			self.reservation.email = "";
			self.reservation.cellphone_only_number = "";
			self.reservation.reservation_type_id = null;
			self.reservation.comment = null;
			self.reservation.allergies = "";
		},
		cleanInfoFields() {
			var self = this;
			
			self.reservation.name = "";
			self.reservation.last_name = "";
			self.reservation.email = "";
		},
        async getPhoneCodes(forceLoadService = false){
      		var self = this;
      		self.loadingMessage = "Cargando";

			let url = 'util/phone-codes';
			const params = new URLSearchParams();

			/*
			if (!forceLoadService) {
			*/
			if (false) {
				url = `https://img.mesa247.pe/archivos/phone-codes-${self.language}.json`;

				window.axios.defaults.headers.common = {};
				window.axios.defaults.headers.common['Accept'] = 'application/json';
				window.axios.defaults.headers.common['Content-Type'] = 'application/json';

				params.append('rev', '2025-10-03-17');
			} else {
				window.axios.defaults.baseURL = 'https://homerestaurantesprod.mesa247.cloud/v3/';
				window.axios.defaults.headers.common = {'Authorization': "Bearer " + self.access_token};
				window.axios.defaults.headers.common['Accept'] = 'application/json';
				window.axios.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded';

				params.append('language', self.language);
				params.append('country_code', self.country_code);
			}
			
			var rs = await axios.get(url,{
			  params: params
			}).then(function (response) {
				self.phone_codes = response.data;
				self.loading = false;
			}).catch(function (error) {
                self.loading = false;
				console.log(error);

				if (forceLoadService !== true) {
					self.getPhoneCodes(true);
				}
			});
		},
		async signInFacebook(){
			var self = this;
			self.cleanInfoFields();
			self.loading = true;
			self.loadingMessage = "Obteniendo la información de sesión usando redes sociales";
			let tokenSocial = (new Date().valueOf() * 1000 ) + Math.floor(Math.random() * 9999) + 1000;
			var channel = 'facebook';
			var api_social = "https://apisocial.mesa247.pe/";
			var url= api_social+'facebook/login';
			var title = "Api Social";
			var w = 580;var h = 400;
			var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : window.screenX;
			var dualScreenTop = window.screenTop != undefined ? window.screenTop : window.screenY;
			var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
			var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
			var left = ((width / 2) - (w / 2)) + dualScreenLeft;
			var top = ((height / 2) - (h / 2)) + dualScreenTop;
			var origin = 'widget';
			var mdlSocial = window.open(url+'?token='+tokenSocial, 'apisocial', 'width=' + w + ', height=' + h + ', top=' + top + ', left=' + left+',toolbar=0,scrollbars=0resizable=0,location=1,menuBar=0');
			var interval = setInterval(() => {
				if(mdlSocial.closed) {
					clearInterval(interval);
					window.axios.defaults.baseURL = "https://apisocial.mesa247.pe/";
					window.axios.defaults.params = {};
					window.axios.defaults.headers.common['Content-Type'] = 'application/json';
					window.axios.defaults.headers.common['Accept'] = 'application/json';
					var rs = axios.get('facebook/info?soctoken='+tokenSocial).then(function(response) {
						self.reservation.name = response.data.Nombre;
						self.reservation.last_name = response.data.Apellido;
						self.reservation.email = response.data.Email;
						self.reservation.email_billing = response.data.Email;
						if(self.reservation.email == null){
							self.mainMessage = "Facebook no nos ha brindado tu email";
						}
						self.loading = false;
					}).catch(function (error) {
						console.log(error);
						self.loading = false;
					});
				}
			}, 2000);
		},
		async signInGoogle(){
			var self = this;
			self.cleanInfoFields();
			self.loading = true;
			self.loadingMessage = "Obteniendo la información de sesión usando redes sociales";
			let tokenSocial = ( new Date().valueOf() ) * 1000;
			tokenSocial += Math.floor(Math.random() * 9999) + 1000;
			var channel = 'google';
			var api_social ="https://apisocial.mesa247.pe/";
			var url= api_social+'google/login';
			var title = "Api Social";
			var w = 580;var h = 400;
			var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : window.screenX;
			var dualScreenTop = window.screenTop != undefined ? window.screenTop : window.screenY;
			var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
			var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
			var left = ((width / 2) - (w / 2)) + dualScreenLeft;
			var top = ((height / 2) - (h / 2)) + dualScreenTop;
			var origin = 'widget';
			var mdlSocial = window.open(url+'?token='+tokenSocial, 'apisocial', 'width=' + w + ', height=' + h + ', top=' + top + ', left=' + left+',toolbar=0,scrollbars=0resizable=0,location=1,menuBar=0');
			var interval = setInterval(() => {
				if(mdlSocial.closed) {
					clearInterval(interval);
					window.axios.defaults.baseURL = "https://apisocial.mesa247.pe/";
					window.axios.defaults.params = {};
					window.axios.defaults.headers.common['Content-Type'] = 'application/json';
					window.axios.defaults.headers.common['Accept'] = 'application/json';
					var rs = axios.get('google/info?soctoken='+tokenSocial).then(function(response) {
						self.reservation.name = response.data.Nombre;
						self.reservation.last_name = response.data.Apellido;
						self.reservation.email = response.data.Email;
						self.reservation.email_billing = response.data.Email;
						if(self.reservation.email == null){
							self.mainMessage = "Google no nos ha brindado tu email";
						}
						self.loading = false;
					}).catch(function (error) {
						self.mainMessage = error.data.message;
						self.loading = false;
					});
				}
			}, 2000);
		},

    getDishOptionText(dish,dishRange){
      if(dishRange == 0){
        return '';
      }
      const peopleText = dishRange === 1 ? "persona" : "personas";
      const price = parseFloat(dish.price) * dishRange;
      return dishRange + ' ' + peopleText + (price > 0 ? ' - ' + dish.currency + ' ' + this.formatPrice(price.toFixed(2)) : '');
    },
    
    formatPrice(price){
      const formatedPrice = price.replace(/\d(?=(\d{3})+\.)/g, '$&,');
      return formatedPrice;
    },

    initInstagramAlert() {
        var self = this;
        let userAgent = navigator.userAgent || navigator.vendor || window.opera;
        let isInstagram = ((userAgent.indexOf('Instagram') > -1) ? true : false) || false;
        self.isInstagram = isInstagram;
    },

    kushki() {
      const self = this;

	  	  const merchantKey = 'a4fc17af02a84cdc9d46ec0b4cbf109c';
	  
      //TODO: Payment attempt so users can correct info
      const kushki = new Kushki({
        merchantId: merchantKey,
        inTestEnvironment: false,
      });
      if(['T','P'].includes(self.payment_type)) {
        kushki.requestToken({
          amount: self.payment_type == 'T' ? self.dishesAmount: self.guarantee.amount,
          currency: !!this.guarantee.amount_currency_abr ? this.guarantee.amount_currency_abr : 'USD',
          card: {
            name: self.card.name,
            number: self.card.number,
            cvc: self.card.cvv,
            expiryMonth: self.card.expiration_month,
            expiryYear: self.card.expiration_year.slice(-2),
          },
        }, (response) => {
          if(response.error) {
			if(self.gateway_name === 'kushki' && self.country_code == 'CL') {
				self.loading = false;
				self.processingReservation = false;
				self.errorMessage = response.message;
			} else {
				self.fallback();
			}
          } else {
            self.token = response.token;
            self.saveCard();
          }
        }
        );
      } else {
        kushki.requestSubscriptionToken({
          card: {
            name: this.card.name,
            number: this.card.number,
            cvc: this.card.cvv,
            expiryMonth: this.card.expiration_month,
            expiryYear: this.card.expiration_year.slice(-2),
          },
          //TODO: Change this accordingly
          currency: !!this.guarantee.amount_currency_abr ? this.guarantee.amount_currency_abr : 'USD',
        }, (response) => {
          if(response.message) {
			if(self.gateway_name === 'kushki' && self.country_code == 'CL') {
				self.loading = false;
				self.processingReservation = false;
				self.errorMessage = response.message;
			} else {
			  //fallback to Izipay
              console.log('Kushki failed, falling back to Izipay');
              self.fallback();
			}
          } else {
            self.token = response.token;
            self.saveCard();
          }
        }
        );
      }
    },
    //Function to tell if we should fallback
    //logic is made by hand but ideally all transactions should fallback
    //and we should get a fallback gatway from the backend
    shouldFallback() {

		if(this.gateway_name === 'kushki' && this.country_code == 'CL') {
			return false;
		}

		if(this.local_id == 2348) {//demomesacolombia
			return ['culqi'].includes(this.gateway_name);
		}

		return ['kushki'].includes(this.gateway_name);
    },
    fallback() {
      //ideally here we'd set the gateway to the
      //fallback gateway the backend sends us to use
      //for now we'll just hardcode the gateways to fall back to
      this.fallingBack = true;
      this.errorMessage = 'Hubo un error en tus datos. Te estamos redirigiendo a un nuevo intento';
      setTimeout(() => {
        const error_element = document.querySelector('#reservation .reservation section .section-information .information .error-message');
        const original_background = '#da5f6a';
        const orange = 'rgb(204, 122, 0)';
        error_element.style.setProperty('background', orange);
        setTimeout(() => {
          error_element.style.background = original_background;
        }, 15000);
      }, 1);
      if(this.gateway_name === 'kushki') {
        this.gateway_name = 'izipay';
        //delete the cardhash so we don't try to use it again
        this.reservation.card_hash = null;
        this.hasPayment = false;
        this.doReservation();
      }
      else if(this.gateway_name === 'culqi') {
        this.gateway_name = 'izipay';
        this.reservation.card_hash = null;
        this.hasPayment = false;
        this.doReservation();
      }
    },
    isOldSafari() {
      //we'll have a failsafe so that if for whatever reason, WHATEVER REASON
      //we faill to parse then we return false
      try {
        const ua = navigator.userAgent;
        const isSafari = ua.indexOf('Safari') != -1 && ua.indexOf('Chrome') == -1;
        const version = ua.match(/Version\/([0-9]+)/);
        return isSafari && version && parseInt(version[1]) <= 15;
      } catch(e) {
        return false;
      }
    },
    loadCorrespondingCulqiScript(type,cb) {
      const culqijs4url = 'https://checkout.culqi.com/js/v4';
      const culqijs2url = 'https://checkout.culqi.com/v2';
      const culqiscript = document.createElement('script');
      if(type === 'v4') {
        culqiscript.src = culqijs4url;
      } else {
        culqiscript.src = culqijs2url;
      }
      culqiscript.onload = cb;
      document.head.appendChild(culqiscript);
    },
    async loadCorrespondingCulqiScriptSync(type) {
        const culqijs4url = 'https://checkout.culqi.com/js/v4';
        const culqijs2url = 'https://checkout.culqi.com/v2';
        const culqiScriptUrl = type === 'v4' ? culqijs4url : culqijs2url;
        const self = this;

        if(type === 'v4') {
          if(self.Culqi3DSScript) {
            window.Culqi = self.Culqi3DSScript;
            return;
          }
        } else {
          if(self.CulqiScript) {
            window.Culqi = self.CulqiScript;
            return;
          }
        }

        const loadScript = (url) => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        };

        try {
            await loadScript(culqiScriptUrl);
            if(type === 'v4') {
              self.Culqi3DSScript = window.Culqi;
            } else {
              self.CulqiScript = window.Culqi;
            }
        } catch (error) {
            console.error('Error loading script:', error);
            throw error; // Re-throw the error if necessary
        }
    },
    async initCulqi3ds() {
      Culqi.publicKey = 'pk_live_4d447c31381e706e';
      Culqi3DS.publicKey = 'pk_live_4d447c31381e706e';
      Culqi.settings({
        
        //either the guarantee's amount currency abreviation is valid
        //or we default to USD
        currency: 
          this.validCurrencyAbreviations.includes(this.guarantee.amount_currency_abr) ? 
            this.guarantee.amount_currency_abr : 'USD',
        amount: this.payment_type == 'T' ? this.dishesAmount: this.guarantee.amount,
        // since it's in céntimos we multiply by 100
        amount: this.payment_type == 't' ? this.dishesamount * 100: this.guarantee.amount * 100,
        
        
        title: 'MESA247',
      });
      Culqi.options({
        paymentMethods: {
          tarjeta: true,
          yape: true,
        },
      });
      Culqi.validationPaymentMethods();
      console.log(Culqi.paymentOptionsAvailable);
      this.culqi3dsPaymentOptions = Culqi.paymentOptionsAvailable;
      Culqi3DS.settings = {
        charge: {
          totalAmount: this.payment_type == 'T' ? this.dishesAmount * 100: this.guarantee.amount * 100,
          returnUrl: window.location.href,
          currency: 
            this.validCurrencyAbreviations.includes(this.guarantee.amount_currency_abr) ? 
              this.guarantee.amount_currency_abr : 'USD',
        },
        card: {
          
          //search instead the input with the id="card[email]"
          email: document.querySelector('#card\\[email\\]').value,
          cardNumber: this.card.number,
          cvv: this.card.cvv,
          expirationMonth: this.card.expiration_month,
          expirationYear: this.card.expiration_year,
        },
      };
      Culqi3DS.options = {
        showModal: false,
      };
     this.deviceId = await Culqi3DS.generateDevice();
    },
    async culqi3ds(){
      this.initCulqi3ds();
      //for now we'll attempt just card
      const self = this;
      window.culqi = () => {
        if (Culqi.token) {
          self.token = Culqi.token;
          
          self.saveCard();
        } else {
          console.log(`Error: ${Culqi.error}`);
          self.processingReservation = false;
          self.errorMessage = Culqi.error.user_message;
        }
      };
      
      //we'll test generating the token with culqi3ds
      if(this.isYape) {
        try{
          this.culqi3dsPaymentOptions.yape.generate();
        } catch(error) {
          console.log(error);
          self.processingReservation = false;
          self.errorMessage = 'Algo salió mal, por favor intenta nuevamente.';
        }
      } else {
        const response = await Culqi3DS.generateToken();
        if(response.error) {
          console.log(response.error);
          this.processingReservation = false;
          this.errorMessage = response.error.user_message;
        } else {
          this.token = response.token;
          this.saveCard();
        }
      }
    },
    addCulqi3dsEventListener(){
      const self = this;
      window.addEventListener( "message", function (event) {
        if(event.data?.source === "react-devtools-content-script"){
            return;
        }
        else if(event.origin !== window.location.origin){
          return;
        }
        if(event.data && 'parameters3DS' in event.data && event.data.parameters3DS){
          self.parameters3DS = event.data.parameters3DS;
          //after we get the parameters we can proceed to try to save the card again
          //here we need to add a conditional to either resave the card or continue with the reservation
          //so prepaid vs guarantee
          self.authenticated3DS = true;
          self.saveCard();
        }
        else if(event.data && 'error' in event.data && event.data.error){
          self.processingReservation = false;
          self.errorMessage = event.data.error;
        }
      },false);
    },
    async culqi3dsAuthentication(){
      this.addCulqi3dsEventListener();
      Culqi3DS.initAuthentication(this.token.id);
    },
		async stripeCardSetup() {
			let self = this;

			try {
				await self.ensureFreshClientSecretIfNeeded();

				const { setupIntent, error } = await self.stripe.object.confirmCardSetup(
					self.stripe.clientSecret,
					{
						payment_method: {
							card: self.stripe.cardNumberElement,
							billing_details: {
								name: [self.reservation.name, self.reservation.last_name]
									.filter(Boolean)
									.join(' ')
									.trim(),
								email: self.reservation.email || undefined,
								phone: self.reservation.cellphone_number || undefined,
							},
						},
					}
				);

				if (error) {

					if (error.code === 'setup_intent_unexpected_state') {
						const { setupIntent: si } = await self.stripe.object.retrieveSetupIntent(self.stripe.clientSecret);
						
						if (si && si.status === 'succeeded') {
							self.token = si.payment_method;
							self.stripe.lastSetupIntentId = si.id;
							self.saveCard();
							
							return;
						}
					}

					self.errors.card.number = false;
					self.errors.card.expiration_month = false;
					self.errors.card.expiration_year = false;
					self.errors.card.cvv = false;

					switch (error.code) {
						case 'incomplete_number':
						case 'invalid_number':
						self.errors.card.number = true;
						break;

						case 'incomplete_expiry':
						case 'invalid_expiry_year':
						case 'invalid_expiry_month':
						self.errors.card.expiration_month = true;
						self.errors.card.expiration_year = true;
						break;

						case 'incomplete_cvc':
						case 'invalid_cvc':
						self.errors.card.cvv = true;
						break;

						case 'card_declined':
						case 'processing_error':
						default:
						self.errors.card.number = true;
						self.errors.card.expiration_month = true;
						self.errors.card.expiration_year = true;
						self.errors.card.cvv = true;
						break;
					}
					
					console.warn('Stripe confirmCardSetup error:', error);
					self.loading = false;
					self.processingReservation = false;
					self.errorMessage = error.message || 'No se pudo validar la tarjeta.';
					
					return;
				}

				if (setupIntent.id !== self.stripe.setupIntentId) {
					self.loading = false;
					self.processingReservation = false;
					self.errorMessage = 'Se actualizó la sesión de tarjeta. Vuelve a intentarlo.';

					return;
				}

				self.token = setupIntent.payment_method;
				self.stripe.lastSetupIntentId = setupIntent.id;
				self.stripe.siStatus = 'succeeded';
				self.stripe.changedAfterSuccess = false;

				self.saveCard();
			} catch (e) {
				console.error('Fallo confirmCardSetup():', e);
				self.loading = false;
				self.processingReservation = false;
				self.errorMessage = 'No se pudo guardar la tarjeta. Inténtalo de nuevo.';
			}
		},
		async loadStripeScript() {
			let self = this;

			if (window.Stripe || self.stripe.scriptLoaded) return;

			return new Promise((resolve, reject) => {
				const script = document.createElement('script');
				script.src = 'https://js.stripe.com/v3/';
				script.async = true;
				
				const scriptTimeout = setTimeout(() => {
					reject(new Error('El script de Stripe tardó demasiado en cargar'));
				}, 10000); // 10secs of timeout
				
				script.onload = () => {
					clearTimeout(scriptTimeout);
					self.stripe.scriptLoaded = true;
					resolve();
				};
				script.onerror = (error) => {
					clearTimeout(scriptTimeout);
					reject(new Error('Error al cargar el script de Stripe'));
				};

				document.head.appendChild(script);
			});
		},
		async initStripeForm() {
			let self = this;
			
			if (self.stripe.ready && self.stripe.cardNumberElement && self.stripe.cardExpiryElement && self.stripe.cardCvcElement) {
				return;
			}
			
			self.stripe.initializing = true;
			self.stripe.ready = false;
			self.stripe.error = false;
			self.stripe.errorMessage = '';

			if (self.stripe.loadingTimeout) {
				clearTimeout(self.stripe.loadingTimeout);
			}

			self.stripe.loadingTimeout = setTimeout(() => {
				if (!self.stripe.ready && !self.stripe.error) {
					self.stripe.error = true;
					self.stripe.errorMessage = 'El formulario de pago tardó demasiado en cargar';
					console.error('Timeout inicializando Stripe');
				}
			}, 15000);

			try {
				await self.loadStripeScript();
				
				if (!self.stripe.object) {
					self.stripe.object = Stripe('');
				}
				
				if (!self.stripe.elements) {
					self.stripe.elements = self.stripe.object.elements();
				}

				window.axios.defaults.baseURL = "https://homerestaurantesprod.mesa247.cloud/v1/";
				window.axios.defaults.headers.common = {
					Authorization: "Bearer " + self.access_token,
					'Content-Type': 'application/json',
					Accept: 'application/json'
				};

				const res = await axios.post('/stripe/setup-intent', {});
				self.stripe.clientSecret = res.data.client_secret;
				self.stripe.setupIntentId = res.data.setup_intent_id;

				self.cleanupStripeElements({ unmountElements: true, clearDOM: false, resetState: false, resetStripeObjects: false });

				const style = {
					base: {
						color: '#ffffff',
						fontFamily: 'inherit',
						fontSize: '15px',
						'::placeholder': {
							color: '#aab7c4'
						}
					},
					invalid: {
						color: '#ff4d4f',
						iconColor: '#ff4d4f'
					}
				};

				self.stripe.cardNumberElement = self.stripe.elements.create('cardNumber', { style });
				self.stripe.cardExpiryElement = self.stripe.elements.create('cardExpiry', { style });
				self.stripe.cardCvcElement = self.stripe.elements.create('cardCvc', { style });

				if (self.stripe.loadingTimeout) {
					clearTimeout(self.stripe.loadingTimeout);
					self.stripe.loadingTimeout = null;
				}

				self.stripe.ready = true;
				await self.$nextTick();

				self.stripe.cardNumberElement.mount('#card-number');
				self.stripe.cardExpiryElement.mount('#card-expiry');
				self.stripe.cardCvcElement.mount('#card-cvc');

				self.stripe.siStatus = null;
				self.stripe.changedAfterSuccess = false;
				self.stripe.lastSetupIntentId = null;

				const changeHandler = (event) => {
					self.handleStripeChange(event);

					if (self.stripe.siStatus === 'succeeded') {
						self.stripe.changedAfterSuccess = true;
					}
				};

				self.stripe.cardNumberElement.on('change', changeHandler);
				self.stripe.cardExpiryElement.on('change', changeHandler);
				self.stripe.cardCvcElement.on('change', changeHandler);

				self.stripe.initializing = false;

			} catch (err) {
				console.error('Error inicializando Stripe:', err);
				
				if (self.stripe.loadingTimeout) {
					clearTimeout(self.stripe.loadingTimeout);
					self.stripe.loadingTimeout = null;
				}

				self.stripe.initializing = false;
				self.stripe.error = true;
				self.stripe.errorMessage = err.message || 'Error al inicializar el formulario de pago';
			}
		},
		cleanupStripeElements(options = {}) {
			let self = this;
			
			const {
				unmountElements = true,
				clearDOM = true,
				resetState = true,
				resetStripeObjects = false
			} = options;
			
			if (unmountElements) {
				['cardNumber', 'cardExpiry', 'cardCvc'].forEach(type => {
					if (self.stripe[type + 'Element']) {
						try {
							self.stripe[type + 'Element'].unmount();
						} catch (e) {
							console.warn('Error unmounting element:', e);
						}
						self.stripe[type + 'Element'] = null;
					}
				});
			}
			
			if (clearDOM) {
				const containers = ['#card-number', '#card-expiry', '#card-cvc'];
				containers.forEach(selector => {
					const container = document.querySelector(selector);
					if (container) {
						container.innerHTML = '';
					}
				});
			}
			
			if (resetState) {
				self.stripe.ready = false;
				self.stripe.initializing = false;
				self.stripe.error = false;
				self.stripe.errorMessage = '';
				self.stripe.scriptLoaded = false;
			}
			
			if (resetStripeObjects) {
				self.stripe.object = null;
				self.stripe.elements = null;
			}
		},
		async retryStripeInitialization() {
			let self = this;
			
			self.stripe.error = false;
			self.stripe.errorMessage = '';
			self.stripe.ready = false;
			
			self.cleanupStripeElements({ unmountElements: true, clearDOM: true, resetState: true, resetStripeObjects: true });
			
			try {
				await self.initStripeForm();
			} catch (err) {
				console.error('Error en reintento de Stripe:', err);
				self.stripe.error = true;
				self.stripe.errorMessage = 'Error al reintentar la carga del formulario';
			}
		},
		async ensureFreshClientSecretIfNeeded() {
			let self = this;

			const payload = {
				email: this.reservation.email,
				full_name: [this.reservation.name, this.reservation.last_name].filter(Boolean).join(' ').trim(),
				phone: this.reservation.cellphone_number || null,
				use_final_customer: true
			};

			window.axios.defaults.baseURL = "https://homerestaurantesprod.mesa247.cloud/v1/";
			window.axios.defaults.headers.common = {
				Authorization: "Bearer " + self.access_token,
				'Content-Type': 'application/json',
				Accept: 'application/json'
			};
			
			const res = await axios.post('/stripe/setup-intent', payload);

			self.stripe.clientSecret = res.data.client_secret;
			self.stripe.setupIntentId = res.data.setup_intent_id;
			self.stripe.siStatus = null;
			self.stripe.changedAfterSuccess = false;
			self.stripe.lastSetupIntentId = null;
		},
		handleStripeChange(event) {
			var self = this;
			
			const type = event.elementType;

			if (type === 'cardNumber') {
				self.errors.card.number = false;
			}

			if (type === 'cardExpiry') {
				self.errors.card.expiration_month = false;
				self.errors.card.expiration_year = false;
			}
			
			if (type === 'cardCvc') {
				self.errors.card.cvv = false;
			}

			if (event.error) {

				if (type === 'cardNumber') self.errors.card.number = true;

				if (type === 'cardExpiry') {
					self.errors.card.expiration_month = true;
					self.errors.card.expiration_year = true;
				}

				if (type === 'cardCvc') self.errors.card.cvv = true;
			}
		},
		highlightStripeError() {
			const errorContainer = document.querySelector('.stripe-error-container');
			
			if (errorContainer) {
				errorContainer.classList.add('stripe-error-highlight');
				
				setTimeout(() => {
					errorContainer.classList.remove('stripe-error-highlight');
				}, 3000);
				
				errorContainer.scrollIntoView({ 
					behavior: 'smooth', 
					block: 'center' 
				});
			}
		},
    async wompi() {
        const self = this;
        //if we have not accepted the terms we'll scroll and add wompi to errors
        if(!this.wompi_accepted){
          this.errors.wompi_accepted = true;
          document.getElementById('colombian_data_manipulation').scrollIntoView({behavior: "smooth", block: "start"});
          this.processingReservation = false;
          return;
        }
        await this.wompiAcceptanceToken();
        try{
          const response = await axios.post(
            this.wompi_url + "/tokens/cards",
            {
              "number": this.card.number,
              "cvc": this.card.cvv,
              "exp_month": this.card.expiration_month,
              "exp_year": this.card.expiration_year.slice(-2),
              //this has to be AT LEAST 5 CHARACTERS LONG according to wompi
              "card_holder": this.card.name,
            },
            {
              headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + this.wompi_public_key,
              }
            }
          );
          console.log(response);
          this.token = response.data.data.id;
          this.saveCard();
        } catch(error) {
          console.log(error);
          self.processingReservation = false;
          
          self.errorMessage = 'Algo salió mal, por favor intenta nuevamente.';
          
        }
    },
    async wompiAcceptanceToken() {
        const self = this;
        try{
          const response = await axios.get(this.wompi_url + "/merchants/" + this.wompi_public_key);
          console.log(response);
          this.wompi_acceptance_token = response.data.data.presigned_acceptance.acceptance_token;
        } catch(error) {
          console.log(error);
          self.processingReservation = false;
          self.errorMessage = 'error';
        }
    },
    }
});
</script>
	






</body>
</html>
